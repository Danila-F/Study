*       EB01 PWM MODEL FEATURES INCLUDE:
*
*   1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*   2 OUTPUT RESISTANCE AND CAPACITANCE
*   3 ACCURATE CATCH DIODE I V CHARACTERISTIC
*   4 ACCURATE RON AND VON
*   5 SCHMITT TRIGGER LOGIC INPUTS
*   6 EMITTER OUTPUT FOR CURRENT SENSE
*   7 ACCURATE SUPPLY RANGES
*   8 VCC UNDERVOLTAGE SENSING W HYSTERESIS
*   9 CYCLE BY CYCLE EDGE TRIGGERED SHUTDOWN
*
*****   SOME NOTES ON USING SPICE FOR PWM SIMULATION  *****
*
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 100, INCREASE
*  RELTOL TO 0.003 TO 0.01, INCREASE ABSTOL TO 1E-11 TO
*  1E-9, INCREASE GMIN TO 1E-11 TO 1E-7, INCREASE VNTOL
*  TO 1E-5 TO 1E-4, OR INCREASE CHGTOL TO 1E-11 TO 1E-9.
*  ANY OR ALL OF THESE SIMULATOR OPTIONS MAY BE REQUIRED
*  DEPENDING ON YOUR SIMULATOR. NEWER SIMULATORS USUALLY
*  REQUIRE FEWER OF THEM.
*
*  TO AID THE INITIAL TRANSIENT CONVERGANCE, SET UP THE
*  INITIAL VALUES OF HIN, LIN, AND SD AT ZERO VOLTS.
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM SIGNAL INPUT TO A FIXED DUTY FACTOR THAT IS KNOWN.
*  RUN A SIMULATION THAT HAS TIME FOR OUTPUT FILTER
*  SETTLING. IF THE OUTPUT VOLTAGE WANDERS AROUND RATHER
*  THAN STAYS SETTLED TO LESS THAN ONE PERCENT YOU SHOULD
*  REDUCE THE TIMESTEP MAX (TMAX) PARAMETER IN THE TRAN
*  LINE. THIS IS THE FOURTH TIME PARAMETER ON THAT LINE
*  AND IS OPTIONAL LIKE THE TSTART PARAMETER (THIRD TIME
*  PARAMETER ON THAT LINE). IF YOU ARE NOT USING TSTART
*  YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL RECOGNIZE
*  TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY SPICE 3
*  TMAX WILL USUALLY BE IN THE 500 TO 150 NS RANGE. FOR
*  PSPICE TMAX WILL USUALLY BE IN THE 250 TO 50 NS RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, RAMP HV AND/OR VDD UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST 10 MICROSECONDS OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES AND
*  CURRENTS FOR LATER SETTING OF NODESETS. LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*EB01 MODEL FOR PSPICE
*PINOUT ORDER VCC VDD HIN LIN SD VSS HV OUT E HVRTN
*PINOUT        1   2   3   4   5  6   7  8  9   10
.SUBCKT EB01_AM 1 2 3 4 5 6 7 8 9 10
RGN 23 0 1E15
R1 61 82 1E3
R2 27 49 50E3
R3 34 14 50E3
R4 61 49 1E3
R5 26 35 50E3
R6 82 21 50E3
I2 1 6 10E-3
R8 35 60 50E3
R9 34 11 50E3
R10 49 12 50E3
R11 61 28 1E3
R13 61 15 100E3
R14 15 13 100E3
R15 15 35 100E3
R16 61 18 100E3
R17 18 13 100E3
R18 18 34 100E3
R7 35 61 1E3
R12 34 61 1E3
SI1 35 13 3 15 SI1M
E4 13 0 6 0 1
R19 3 13 51E3
E3 23 13 61 5 1
C3 3 13 5E-12
R20 5 13 51E3
C4 5 13 5E-12
E5 61 0 2 0 1
Q1 82 14 13 Q1D
Q2 82 27 13 Q1D
Q3 49 21 13 Q1D
Q4 49 26 13 Q1D
Q5 28 12 13 Q1D
Q6 28 11 13 Q1D
Q7 28 60 13 Q1D
Q8 38 39 13 Q1D
Q9 28 30 13 Q1D
Q10 38 41 13 Q1D
Q11 43 45 13 Q1D
Q12 43 46 13 Q1D
Q13 44 53 13 Q1D
Q14 44 54 13 Q1D
Q15 44 55 13 Q1D
Q16 44 66 13 Q1D
S2 7 32 31 13 S2M
R55 78 42 10E6
R25 33 31 10E3
R59 32 25 10E6
R21 29 30 50E3
C5 31 13 24E-12
D5 33 31 D5M
R22 25 8 0.0198
D8 8 7 D8M
C1 7 36 150E-12
R23 36 32 1
R26 61 38 1E3
R27 41 43 50E3
R28 34 39 50E3
R29 61 43 1E3
R30 46 47 50E3
R31 38 45 50E3
D11 32 25 D11M
E7 33 13 63 13 1
R32 47 55 50E3
R33 34 54 50E3
R34 43 53 50E3
R35 61 44 1E3
SI2 34 13 23 18 SI1M
R36 47 61 1E3
R37 51 52 10E3
D18 78 42 D11M
C7 52 13 24E-12
D6 51 52 D5M
E8 51 13 71 13 1
SI3 47 13 4 57 SI1M
R38 61 57 100E3
R39 57 13 100E3
R40 57 47 100E3
D7 48 8 D7M
C8 8 48 180E-12
D12 48 62 D12M
M1 62 10 10 10 MOSN
R44 4 13 51E3
C2 4 13 5E-12
C9 50 10 2.8E-12
R42 8 48 120E3
R43 48 62 10E6
S3 29 61 81 13 S3M
R46 29 66 50E3
S4 8 78 52 13 S2M
C10 10 84 12E-12
R41 10 84 1E9
RN1 84 0 10
R45 50 62 3E3
R50 62 10 10E6
R47 42 9 0.0198
D16 9 8 D8M
C6 8 75 150E-12
R48 75 78 1
D13 63 64 D1M
D14 6 2 D14M
D15 67 63 D1M
V13 70 64 0.9
I1 2 6 10E-3
V16 67 13 0.9
E9 69 13 28 13 1
R51 69 63 1E3
V17 70 13 5
D17 71 72 D1M
D19 73 71 D1M
V18 74 72 0.9
V19 73 13 0.9
E10 76 13 44 13 1
R52 76 71 1E3
V22 74 13 5
R53 29 13 100E3
R60 1 0 1E9
R54 77 80 10E3
R56 77 81 385E3
CFB 77 81 1E-12
V23 80 13 8.4
R57 83 81 1E3
SC1 81 13 79 77 SI1M
V27 83 13 15
R58 1 79 10E3
C11 79 81 1E-12
.MODEL Q1D NPN (CJC=1E-12)
.MODEL D1M D (CJO=1E-12 TT=5E-9)
.MODEL D5M D
.MODEL D7M D (BV=12 CJO=540E-12 IBV=0.01 RS=0.25 TT=50E-9)
.MODEL D8M D (IS=2.645E-15 M=0.333 RS=0.083 VJ=0.75)
.MODEL D11M D (IS=6.452E-13 N=1.5)
.MODEL D12M D (CJO=1.2E-12 IS=1E-15 RS=1.0 TT=5E-9)
.MODEL D14M D (BV=12 CJO=25E-12 IBV=0.01 RS=0.25 TT=50E-9)
.MODEL MOSN NMOS (KP=1E-2 LAMBDA=1E-3 RD=4.5E3 RS=1.5E3 VTO=-3)
.MODEL S2M VSWITCH RON=0.01 ROFF=1E6 VON=2.5 VOFF=2.4
.MODEL S3M VSWITCH RON=1E3 ROFF=1E6 VON=8 VOFF=7
.MODEL SI1M VSWITCH RON=10 ROFF=100E3 VON=0.001 VOFF=0
.ENDS
*END OF MODEL EB01
**********
*       SA01 PWM MODEL FEATURES INCLUDE:
*
*   1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*   2 OUTPUT RESISTANCE AND CAPACITANCE
*   3 ACCURATE CATCH DIODE I V CHARACTERISTIC
*   4 ACCURATE RON TEMPERATURE COEFFICIENT
*   5 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*   6 DEADTIME BETWEEN SWITCH ON TIMES
*   7 INTERNAL ERROR AMPLIFIER WITH ACCURATE
*     BODE PLOT, SLEW, CMRR, INPUT AND OUTPUT
*     IMPEDANCES, INPUT BIAS AND OFFSET CURRENTS,
*     AND NON-SYMETRICAL OUTPUT CURRENT LIMIT
*   8 REFERENCE OUTPUT
*   9 REALISTIC REFERENCE OUTPUT IMPEDANCE
*  10 REFERENCE OUTPUT CURRENT LIMIT
*  11 ILIM / SHUTDOWN FUNCTIONS
*
*     NOTE: THERMAL SHUTDOWN IS NOT MODELED
*     NOTE: HIGH SIDE CURRENT LIMIT IS NOT MODELED
*
*       SOME NOTES ON USING SPICE FOR PWM SIMULATION
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 100, INCREASE
*  RELTOL TO 0.003 TO 0.01, INCREASE ABSTOL TO 1E-11 TO
*  1E-9, INCREASE GMIN TO 1E-11 TO 1E-7, INCREASE VNTOL
*  TO 1E-5 TO 1E-4, OR INCREASE CHGTOL TO 1E-11 TO 1E-9.
*  ANY OR ALL OF THESE SIMULATOR OPTIONS MAY BE REQUIRED
*  DEPENDING ON YOUR SIMULATOR. NEWER SIMULATORS USUALLY
*  REQUIRE FEWER OF THEM.
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM SIGNAL INPUT TO A FIXED VOLTAGE THAT IS EQUIVALENT
*  TO HALFWAY BETWEEN 50-50 DUTY FACTOR AND 100 PERCENT
*  DUTY FACTOR. RUN A SIMULATION THAT HAS TIME FOR OUTPUT
*  FILTER SETTLING. IF THE OUTPUT VOLTAGE WANDERS AROUND
*  RATHER THAN STAYS SETTLED TO LESS THAN ONE PERCENT YOU
*  SHOULD REDUCE THE TIMESTEP MAX (TMAX) PARAMETER IN THE
*  TRAN LINE. THIS IS THE FOURTH TIME PARAMETER ON THAT
*  LINE AND IS OPTIONAL LIKE THE TSTART PARAMETER (THIRD
*  TIME PARAMETER ON THAT LINE). IF YOU ARE NOT USING
*  TSTART YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL
*  RECOGNIZE TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY
*  SPICE 3 TMAX WILL USUALLY BE IN THE 500 TO 150 NS RANGE.
*  FOR PSPICE TMAX WILL USUALLY BE IN THE 250 TO 50 NS
*  RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, RAMP VCC AND VS UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST 10 MICROSECONDS OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES AND
*  CURRENTS FOR LATER SETTING OF NODESETS. LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*BEGIN MODEL SA01 FOR PSPICE
*PINOUT ORDER -IN +IN EA GND REF AOUT +VS ISEN BOUT SHDN
*PINOUT        1   2   3  4   5    6   7    8    9   10
.SUBCKT SA01_AM 1 2 3 4 5 6 7 8 9 10
RER1 50 0 1E9
RER2 38 0 1E9
RER3 57 0 1E9
RER4 79 0 1E9
E1 14 4 22 72 1
E4 29 4 72 26 1
R13 60 4 100
R14 30 22 13E3
R1 42 6 R1M 0.2
R2 11 9 R1M 0.2
R15 22 76 500
R16 76 26 500
R3 39 8 R3M 0.08
R4 63 8 R3M 0.08
D1 6 7 D1M
D4 74 75 D4M
R17 26 5 13E3
V5 30 4 0
D2 46 47 D4M
D3 48 46 D4M
S1 7 42 13 4 S1M
V15 27 4 12.6
S2 7 11 60 4 S1M
C4 7 34 450E-12
E9 16 4 24 25 1000
V7 72 4 5 PULSE 2.5 7.5 0 11.9U 11.9U 10N 23.82U
V9 28 4 0.1
C5 7 37 450E-12
C6 6 35 350E-12
C7 9 33 350E-12
R10 34 6 0.7
D5 8 6 D5M
D6 8 9 D5M
Q2 70 54 4 Q1M
R12 35 8 0.7
R18 37 9 0.7
R20 33 8 0.7
E3 40 4 50 76 1
E5 41 4 76 38 1
E7 43 4 41 4 -1
E8 44 4 40 4 -1
V2 38 4 7.45
V8 50 4 2.55
Q3 59 55 4 Q1M
Q4 59 51 4 Q1M
V14 27 73 0.9
V18 74 4 2.9
V19 75 1 1.5E-3
C10 24 4 1000E-12
R21 24 10 1E3
C17 2 4 2E-12
R22 46 16 1E3
V10 48 4 0.8
V11 47 0 4.1
D8 86 27 D4M
R23 28 25 1E3
R24 70 25 1E6
R25 70 49 1E3
R26 59 49 1E3
R27 52 25 100E3
R19 13 4 100
C8 70 52 5E-12
V13 56 4 5
Q1 70 53 4 Q1M
R43 2 4 300E6
R44 75 4 300E6
C18 75 4 2E-12
R28 53 46 50E3
R29 54 59 50E3
R30 55 15 50E3
R31 51 70 50E3
C9 53 4 1E-12
C11 51 4 1E-12
C12 55 4 1E-12
C13 54 4 1E-12
I2 27 58 60E-6
Q5 27 58 5 QON
Q6 4 65 58 QOP
V17 57 4 7.5
R33 5 4 42E3
R46 75 2 35E6
R35 23 4 1E6
S3 6 39 60 4 S1M
S7 49 15 72 4 S7M
V16 49 4 5
R36 15 4 500
D7 9 7 D1M
V23 68 4 0.8
V24 67 4 12
R34 69 65 1E3
C19 75 2 3E-12
G2 4 78 2 79 7E-5
C15 5 71 0.01E-6
D14 65 67 D4M
D15 4 87 D4M
D16 68 65 D4M
G1 4 69 57 5 0.01
R37 4 69 400E3
S4 9 63 13 4 S1M
C16 77 69 10E-12
R38 71 4 1
S5 23 31 44 4 S5M
S6 23 32 43 4 S5M
S9 31 13 41 4 S5M
S10 32 60 40 4 S5M
S11 56 23 70 4 S11M
S12 31 13 14 4 S5M
S13 32 60 29 4 S5M
R39 4 77 10E3
R47 78 4 2E9
E11 80 4 81 4 1.0
R48 78 81 7E3
C22 81 4 5E-12
G3 4 91 81 4 0.001
R49 91 4 1000
C23 91 4 10E-12
G4 4 82 91 4 0.001
R50 82 4 1E3
C24 82 4 3E-12
R51 2 83 1E9
R52 75 83 1E9
D9 75 73 D4M
D10 2 73 D4M
D11 74 2 D4M
G6 4 84 83 4 7E-6
R53 84 85 1
L3 85 4 1.6E-4
E12 75 79 84 4 1
D12 80 78 D4M
D13 78 80 D4M
V20 86 81 1.9
V21 81 87 0.8
R54 85 4 500
I6 27 88 11E-5
I7 89 4 50E-5
R55 3 90 25
Q23 27 82 89 QON
Q24 27 88 90 QON
Q26 4 82 88 QOP
Q27 4 89 90 QOP
R57 3 76 10
I1 4 1 0.5E-6
I3 4 2 0.4E-6
S8 62 12 61 4 S8M
R58 12 4 1E6
R59 7 4 1E6
I4 7 4 0.025
R60 70 61 100E3
S16 61 4 41 4 S16M
S17 61 4 40 4 S16M
V22 62 0 -1
GB2 4 7 VALUE = {V(12)*0.017*SQRT(SQRT(ABS(V(7))))}
.MODEL R1M RES (TC1=5.797E-3 TC2=3.768E-6)
.MODEL R3M RES (TC1=7.374E-3 TC2=2.598E-5)
.MODEL D1M D (IS=2E-18 M=0.333 N=1.61 RS=0.08 VJ=0.75)
.MODEL D4M D (BV=100 CJO=4E-12 IS=7E-09
+ M=0.45 N=2.0 RS=0.8 TT=6E-9 VJ=0.6V)
.MODEL D5M D (IS=3.274E-12 M=0.333 N=1 RS=0.0246 VJ=0.75)
.MODEL QON NPN
.MODEL QOP PNP
.MODEL Q1M NPN (IS=1.5E-15 CJC=1E-12 NC=1.7)
.MODEL S1M VSWITCH RON=0.06 ROFF=1E6 VON=2.55 VOFF=2.0
.MODEL S5M VSWITCH RON=0.1 ROFF=1E6 VON=0.001 VOFF=0
.MODEL S7M VSWITCH RON=5 ROFF=100E3 VON=5.1 VOFF=4.9
.MODEL S8M VSWITCH RON=1 ROFF=1E6 VON=2.65 VOFF=2.35
.MODEL S11M VSWITCH RON=0.1 ROFF=1E6 VON=2.51 VOFF=2.49
.MODEL S16M VSWITCH RON=10E3 ROFF=1E6 VON=0.001 VOFF=0
.ENDS
*END OF MODEL SA01
*************
*     SA01TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUTS
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 6 PIN NUMBERS CORRESPOND TO THE HARDWARE
* 7 A FLAG OUTPUT SHOWS INPUT VOLTAGE OUTSIDE THE MODULATION RANGE
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN AC SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).  
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION ALL THE WAY TO 0 OR 100% MODULATION, 
* WHICH IS NOT POSSIBLE WITH THE HARDWARE.
* 
* THE SHDN/FILTER FUNCTION IS NOT MODELED.
*
*BEGIN MODEL SA01TOOL FOR PSPICE.
*PINOUT ORDER -IN +IN EAOUT GND REF AOUT  VS ISENS BOUT SHDN
*PINOUT        1   2    3    4   5    6    7   8     9   10
.SUBCKT SA01TOOL_AM 1 2 3 4 5 6 7 8 9 10
* SET UP HIGH, LOW AND P-P RAMP VALUES
V123 123 0 7.5 
V125 125 0 2.5 
E124 124 0 123 125 1 
* S123 & S125 LIMIT MODULATOR DRIVE TO 0/100%
S123 129 123 3 123 SM1 
S125 125 129 125 3 SM1 
R129 3 129 10K 
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)
* E119 SHOWS ONLY INTEGRATOR VOLTAGE OUTSIDE MODULATION RANGE
E119 128 0 129 3 -1 
R128 128 10 10 
R110 10 0 1meg 
* 130 SERIES PARTS ARE THE NON-INVERTING OUT, 140 ARE INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 130 0 129 125 1 
E140 140 0 123 129 1 
* E131 & E141 GENERATE OUTPUTS; V(MODULATE)*PWM GAIN [VS/VP-P]
E131 131 0 VALUE={V(130)*V(7)/V(124)} 
E141 141 0 VALUE={V(140)*V(7)/V(124)} 
* R132 & 142 SET ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R132 131 6 .18 
R142 141 9 .18 
* E132 & E142 SENSE OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 0 @ VOUT=0 AND 1 @ VOUT=VS
E132 135 0 VALUE={(V(131)-V(6))*V(130)/V(124)} 
E142 145 0 VALUE={(V(141)-V(9))*V(140)/V(124)} 
* G135 & G145 REFLECT OUTPUT CURRENT INTO VSENSE PINS
G135 208 0 135 0 -5.556 
G145 208 0 145 0 -5.556 
VSENS 208 8 0 
* F125 REFLECTS CURRENT INTO VS PIN
F125 7 0 VSENS 1 
*
VREF 5 0 7.5 
R105 5 0 1meg 
*
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D130 6 7 D1M 
D131 0 6 D1M 
D140 9 7 D1M 
D141 0 9 D1M 
.MODEL D1M D (IS=2.832E-12 M=0.333 N=1.00 RS=0.043 VJ=0.75)
*
D120 1 99 D1N4148 
D122 0 1 D1N4148 
D121 2 99 D1N4148 
D123 0 2 D1N4148 
.MODEL D1N4148  D(IS=0.1P RS=16 CJO=2P TT=12N BV=100 IBV=0.1P)  
*
R104 4 0 1meg 
*
V103 99 0 12 
*
*X1 2 1 99 0 3 SA01ERR 
*PINOUT ORDER +IN -IN  +V -V OUT
*PINOUT        2   1   99  0  3
*.SUBCKT SAERR 2 1 99 0 3
I1 0 1 0.5E-6
I2 0 2 0.4E-6
V5 16 1 1.5E-3
D1 96 16 D2M 
D2 16 89 D2M
D3 2 89 D2M
D4 96 2 D2M
C1 2 0 2E-12
R1 2 0 300E6
R2 16 0 300E6
C2 16 0 2E-12
R3 16 2 35E6
C3 16 2 3E-12
V3 99 89 0.9
V4 96 0 2.9
D5 12 91 D2M
D6 91 12 D2M
I6 99 17 11E-5
I7 18 0 50E-5
G2 0 91 2 27 7E-5
R8 91 0 2E9
R18 25 0 500
R7 3 98 25
E1 12 0 13 0 1.0
R9 91 13 7E3
C6 13 0 5E-12
G3 0 14 13 0 0.001
R10 14 0 1000
C7 14 0 10E-12
G4 0 15 14 0 0.001
R11 15 0 1000
C8 15 0 3E-12
R14 2 24 1E9
R15 16 24 1E9
G6 0 26 24 0 7E-6
D8 34 99 D8M
V9 34 13 1.9
R16 26 25 1
L1 25 0 1.6E-4
E3 16 27 26 0 1
Q23 99 15 18 QON
Q24 99 17 98 QON
Q26 0 15 17 QOP
Q27 0 18 98 QOP
D15 0 36 D8M
V12 13 36 0.8
.MODEL QON NPN
.MODEL QOP PNP
.MODEL D8M D IS=1E-15
.MODEL D2M D CJO=4E-12 IS=7E-9 M=0.45 N=2
+ RS=0.8 TT=6E-9 VJ=0.6V
.ENDS
*END OF MODEL SA01TOOL
**********
*       SA03 PWM MODEL FEATURES INCLUDE:
*
*   1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*   2 OUTPUT RESISTANCE AND CAPACITANCE
*   3 ACCURATE CATCH DIODE I V CHARACTERISTIC
*   4 ACCURATE RON TEMPERATURE COEFFICIENT
*   5 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*   6 DEADTIME BETWEEN SWITCH ON TIMES
*   7 ACCURATE IQ ON THE VCC LINE
*   8 REDUCTION IN IQ VCC IN SHUTDOWN
*   9 INTERNAL CMOS BUFFER ON THE CLK IN PIN
*  10 ILIM / SHUTDOWN FUNCTIONS
*
*     NOTE: THERMAL SHUTDOWN IS NOT MODELED
*     NOTE: HIGH SIDE CURRENT LIMIT IS NOT MODELED
*
*       SOME NOTES ON USING SPICE FOR PWM SIMULATION
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 100, INCREASE
*  RELTOL TO 0.003 TO 0.01, INCREASE ABSTOL TO 1E-11 TO
*  1E-9, INCREASE GMIN TO 1E-11 TO 1E-7, INCREASE VNTOL
*  TO 1E-5 TO 1E-4, OR INCREASE CHGTOL TO 1E-11 TO 1E-9.
*  ANY OR ALL OF THESE SIMULATOR OPTIONS MAY BE REQUIRED
*  DEPENDING ON YOUR SIMULATOR. NEWER SIMULATORS USUALLY
*  REQUIRE FEWER OF THEM.
*
*  TO AID THE INITIAL TRANSIENT CONVERGANCE, SET UP THE
*  INITIAL VALUE OF CLOCK IN AS FOLLOWS:
*        IF PWM IN > 5V, CLOCK IN INITIAL = 5 VOLTS
*        IF PWM IN < 5V, CLOCK IN INITIAL = 0 VOLTS
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  THE CLOCK IS A GENERATOR STATEMENT INSIDE THE MODEL.
*  WHERE THE REAL PART HAS AN OSCILLATOR FOLLOWED BY A
*  DIGITAL DIVIDE BY TWO, THE MODEL HAS THE GENERATOR
*  AT HALF OF THE CLOCK FREQUENCY. IF YOU NEED TO SYNCH-
*  RONIZE THE PWM CLOCK TO AN EXTERNAL SOURCE, LOOK IN
*  YOUR SIMULATOR LIBRARY FOR A SIMPLE FAST RUNNING
*  BEHAVIORAL FREQUENCY DIVIDER OR DFLOP. BECAUSE THE
*  EXTENTIONS THAT ALLOW BEHAVIORAL MODELS VARY WIDELY
*  AMONG VENDORS NONE ARE INCLUDED HERE. AT THE BOTTOM
*  OF THIS LIBRARY FILE YOU WILL FIND A COMPONENT LEVEL
*  FREQUENCY DIVIDER SUBCIRCUIT (FDIV) WILL WORK WITH
*  ALL SIMULATORS. IT WORKS AT FIVE VOLTS (PROVIDE 5V
*  AND GROUND ON THE SUPPLIES OF FDIV) AND CAN PROVIDE
*  FREQUENCY DIVISION BY 2 TO GO BETWEEN YOUR EXTERNAL
*  SYNCH SIGNAL AND THE CLOCK INPUT OF THE PWM MODEL.
*  BECAUSE FDIV IS COMPONENT LEVEL IT IS SLOW AND WILL
*  EXTEND THE EXECUTION TIME BY AS MUCH AS 2 TO 1.
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM SIGNAL INPUT TO A FIXED VOLTAGE THAT IS EQUIVALENT
*  TO HALFWAY BETWEEN 50-50 DUTY FACTOR AND 100 PERCENT
*  DUTY FACTOR. RUN A SIMULATION THAT HAS TIME FOR OUTPUT
*  FILTER SETTLING. IF THE OUTPUT VOLTAGE WANDERS AROUND
*  RATHER THAN STAYS SETTLED TO LESS THAN ONE PERCENT YOU
*  SHOULD REDUCE THE TIMESTEP MAX (TMAX) PARAMETER IN THE
*  TRAN LINE. THIS IS THE FOURTH TIME PARAMETER ON THAT
*  LINE AND IS OPTIONAL LIKE THE TSTART PARAMETER (THIRD
*  TIME PARAMETER ON THAT LINE). IF YOU ARE NOT USING
*  TSTART YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL
*  RECOGNIZE TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY
*  SPICE 3 TMAX WILL USUALLY BE IN THE 500 TO 150 NS RANGE.
*  FOR PSPICE TMAX WILL USUALLY BE IN THE 250 TO 50 NS
*  RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, RAMP VCC AND VS UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST 10 MICROSECONDS OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES AND
*  CURRENTS FOR LATER SETTING OF NODESETS. LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*  BECAUSE THIS MODEL MUST BE CAPABLE OF RUNNING AT ANY
*  CLOCK RATE UP TO THE SPECIFICATION, THE MODEL MEASURES
*  THE CLOCK FREQUENCY AND FILTERS THE ANALOG RESULT AND
*  USES IT AS PART OF THE MODELING THAT CREATES THE
*  FREQUENCY DEPENDENT PART OF IQ(VSS). THE FILTER HAS A
*  TIME CONSTANT OF 300 USEC. DURING SHUTDOWN THE IQ(VSS)
*  IS SET TO A LOWER VALUE VIA THIS TIME CONSTANT AND
*  IQ(VCC) IS SET TO A LOWER VALUE WITH NO TIME CONSTANT.
*
*BEGIN MODEL SA03 FOR PSPICE
*PINOUT ORDER CKIN CKOUT +PWM -PWM GND ILIM ISENB BOUT +VS VCC AOUT ISENA
*PINOUT         1    2     3    4   5    6    7     8   9   10  11    12
.SUBCKT SA03_AM 1 2 3 4 5 6 7 8 9 10 11 12
V7 44 5 0 PULSE 0 5 0 10N 10N 22.22U 44.44U 
RE2 41 5 1E9
E1 14 5 23 4 1
D5 12 11 D1M 
R13 27 5 10
R42 5 14 1E9
R39 67 63 10E3
C17 63 5 28E-12
R46 27 13 10E3
C18 13 5 28E-12
R1 40 11 R1M 0.09
R2 19 8 R1M 0.09
R3 64 12 R1M 0.09
R4 39 7 R1M 0.09
D4 13 27 D2M 
D8 63 67 D2M 
R14 32 23 1E3
R37 23 27 143E9
E4 32 5 66 5 1
E3 5 31 41 27 -1
R43 44 2 100
C22 2 5 10E-12
V2 41 5 4.5
D1 11 9 D1M 
E9 16 5 65 25 1000
D6 7 8 D1M
D7 8 9 D1M
V9 28 5 0.1
C4 9 34 350E-12
C5 9 37 350E-12
C6 11 35 350E-12
C7 8 33 350E-12
R10 34 11 0.47
R12 35 12 0.47
R18 37 8 0.47
R20 33 7 0.47
S5 61 27 14 5 S5M  
C19 15 5 1000E-12
C20 29 5 2000E-12
R15 26 29 10
E13 43 5 42 38 1
R16 43 30 300
C21 30 5 1E-6
R17 3 15 50
R45 30 5 1E9
C10 65 5 1000E-12
R21 65 6 1E3
D2 46 47 DN
D3 48 46 DN
R22 46 16 1E3
V10 48 5 0.8
V11 47 0 4.1
R23 28 25 1E3
R24 57 25 1E6
R25 57 50 1E3
R26 59 50 1E3
R27 52 25 100E3
R19 60 5 1
C8 57 52 5E-12
V13 56 5 5
V8 22 5 2.5
Q1 57 53 5 QFN 
Q2 57 54 5 QFN 
Q3 59 55 5 QFN 
Q4 59 51 5 QFN 
R28 53 46 50E3
R29 54 59 50E3
R30 55 49 50E3
R31 51 57 50E3
C9 53 5 1E-12
C11 51 5 1E-12
C12 55 5 1E-12
C13 54 5 1E-12
R33 58 4 55E3
C15 4 5 470E-12
M1 49 62 5 5 M1M
M2 49 62 50 50 M2M
R34 62 1 50
C16 62 5 5E-12
E10 58 5 49 0 2
V12 50 5 5
R35 61 5 1E9
S7 26 42 22 13 S7M
S8 26 60 13 22 S7M
R36 66 5 10E6
R38 38 42 1
V4 38 5 10
G1 5 10 30 5 0.36
R40 10 69 500
S10 69 5 57 5 S1M
I2 10 5 0.05
GQ1 5 9 VALUE = {(-0.05)*((0.13+(V(9)/69))*(0.28+V(30)*(-1600)))}
R49 65 5 10E6
R51 15 66 50
R52 67 5 10
S1 9 40 13 5 S1M
S2 9 19 63 5 S1M
S3 11 64 63 5 S1M
S4 8 39 13 5 S1M
S6 67 31 57 5 S6M
S9 56 61 57 5 S1M
.MODEL R1M RES (TC1=7.374E-3 TC2=2.598E-5)
.MODEL QFN NPN (BF=100 NE=1.5 EG=1.11
+ IS=1.5E-15 NC=1.7 FC=0.5 CJC=1E-12)
.MODEL M1M NMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=2.25)
.MODEL M2M PMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=-2.25)
.MODEL S1M  VSWITCH RON=0.01 ROFF=1E6 VON=2.55 VOFF=2.0
.MODEL S5M  VSWITCH RON=1 ROFF=1E3 VON=0.001 VOFF=0
.MODEL S6M  VSWITCH RON=0.1 ROFF=1E4 VON=2.51 VOFF=0
.MODEL S7M  VSWITCH RON=1 ROFF=1E5 VON=0.1 VOFF=0
.MODEL D1M D (IS=6.365E-12 M=0.333 N=1.00 RS=0.02685 VJ=0.75)
.MODEL D2M D (IS=1.68E-08 M=0.333 N=1.89 RS=0.452 VJ=0.75)
.MODEL DN D (BV=100 CJO=4E-12 IS=7E-9 M=0.45 N=2 RS=0.8 TT=6E-9 VJ=0.6)
.ENDS
*END OF MODEL SA03
*************
*     SA03TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUTS
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 6 PIN NUMBERS CORRESPOND TO THE HARDWARE
* 7 A FLAG OUTPUT SHOWS INPUT VOLTAGE OUTSIDE THE MODULATION RANGE
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN AC SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).  
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION ALL THE WAY TO 0 OR 100% MODULATION, 
* WHICH IS NOT POSSIBLE WITH THE HARDWARE.
* 
* THE ILIM/SHDN FUNCTION IS NOT MODELED.
*
*BEGIN MODEL SA03TOOL FOR PSPICE.
*PINS CLKIN CLKOUT +PWM -PWM GND ILIM/SDN ISENB BOUT VS VCC AOUT ISENA
*PINS   1      2     3    4   5      6      7     8   9  10  11    12
.SUBCKT SA03TOOL_AM 1 2 3 4 5 6 7 8 9 10 11 12
* R110 & C110 DUPLICATE HARDWARE
R110 3 127 50
C110 127 0 .01U
* SET UP HIGH, LOW AND P-P RAMP VALUES
E124 124 0 123 125 1 
V123 123 0 7 
V125 125 0 3 
* S123 & S125 LIMIT MODULATOR DRIVE TO 0/100%
S123 129 123 127 123 SM1 
S125 125 129 125 127 SM1 
R129 127 129 10K 
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)
* E119 SHOWS ONLY INTEGRATOR VOLTAGE OUTSIDE MODULATION RANGE
E119 128 0 129 127 -1 
R128 128 6 10 
R6 3 0 1meg 
* 130 SERIES PARTS ARE THE NON-INVERTING OUT, 140 ARE INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 130 0 129 125 1 
E140 140 0 123 129 1 
* E131 & E141 GENERATE OUTPUTS; V(MODULATE)*PWM GAIN [VS/VP-P]
E141 141 0 VALUE={V(140)*V(9)/V(124)} 
E131 131 0 VALUE={V(130)*V(9)/V(124)} 
* R132 & 142 SET ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R132 131 11 .114 
R142 141 8 .114 
* E132 & E142 SENSE OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 0 @ VOUT=0 AND 1 @ VOUT=VS
E132 135 0 VALUE={(V(131)-V(11))*V(130)/V(124)} 
E142 145 0 VALUE={(V(141)-V(8))*V(140)/V(124)}
* G135 & G145 REFLECT OUTPUT CURRENT INTO VSENSE PINS
G135 208 0 135 0 -8.772
G145 212 0 145 0 -8.772
V135 208 7 0 
V145 212 12 0 
* F135 & F145 REFLECT CURRENT INTO VS PIN
F135 9 0 V135 1 
F145 9 0 V145 1 
* 
R1 1 0 1meg 
R2 2 0 1meg 
R4 4 0 1meg 
R5 5 0 1meg 
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D130 11 9 D1M 
D131 0 11 D1M 
D140 8 9 D1M 
D141 0 8 D1M 
.MODEL D1M D (IS=2.832E-12 M=0.333 N=1.00 RS=0.043 VJ=0.75)
*
D120 127 10 D1N4148 
D121 0 127 D1N4148
.MODEL D1N4148  D(IS=0.1P RS=16 CJO=2P TT=12N BV=100 IBV=0.1P)  
.ENDS
*END OF MODEL SA03TOOL
**********
*       SA04 PWM MODEL FEATURES INCLUDE:
*
*   1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*   2 OUTPUT RESISTANCE AND CAPACITANCE
*   3 ACCURATE CATCH DIODE I V CHARACTERISTIC
*   4 ACCURATE RON TEMPERATURE COEFFICIENT
*   5 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*   6 DEADTIME BETWEEN SWITCH ON TIMES
*   7 ACCURATE IQ ON THE VCC LINE
*   8 REDUCTION IN IQ VCC IN SHUTDOWN
*   9 INTERNAL CMOS BUFFER ON THE CLK IN PIN
*  10 ILIM / SHUTDOWN FUNCTIONS
*
*     NOTE: THERMAL SHUTDOWN IS NOT MODELED
*     NOTE: HIGH SIDE CURRENT LIMIT IS NOT MODELED
*
*       SOME NOTES ON USING SPICE FOR PWM SIMULATION
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 100, INCREASE
*  RELTOL TO 0.003 TO 0.01, INCREASE ABSTOL TO 1E-11 TO
*  1E-9, INCREASE GMIN TO 1E-11 TO 1E-7, INCREASE VNTOL
*  TO 1E-5 TO 1E-4, OR INCREASE CHGTOL TO 1E-11 TO 1E-9.
*  ANY OR ALL OF THESE SIMULATOR OPTIONS MAY BE REQUIRED
*  DEPENDING ON YOUR SIMULATOR. NEWER SIMULATORS USUALLY
*  REQUIRE FEWER OF THEM.
*
*  TO AID THE INITIAL TRANSIENT CONVERGANCE, SET UP THE
*  INITIAL VALUE OF CLOCK IN AS FOLLOWS:
*        IF PWM IN > 5V, CLOCK IN INITIAL = 5 VOLTS
*        IF PWM IN < 5V, CLOCK IN INITIAL = 0 VOLTS
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  THE CLOCK IS A GENERATOR STATEMENT INSIDE THE MODEL.
*  WHERE THE REAL PART HAS AN OSCILLATOR FOLLOWED BY A
*  DIGITAL DIVIDE BY TWO, THE MODEL HAS THE GENERATOR
*  AT HALF OF THE CLOCK FREQUENCY. IF YOU NEED TO SYNCH-
*  RONIZE THE PWM CLOCK TO AN EXTERNAL SOURCE, LOOK IN
*  YOUR SIMULATOR LIBRARY FOR A SIMPLE FAST RUNNING
*  BEHAVIORAL FREQUENCY DIVIDER OR DFLOP. BECAUSE THE
*  EXTENTIONS THAT ALLOW BEHAVIORAL MODELS VARY WIDELY
*  AMONG VENDORS NONE ARE INCLUDED HERE. AT THE BOTTOM
*  OF THIS LIBRARY FILE YOU WILL FIND A COMPONENT LEVEL
*  FREQUENCY DIVIDER SUBCIRCUIT (FDIV) WILL WORK WITH
*  ALL SIMULATORS. IT WORKS AT FIVE VOLTS (PROVIDE 5V
*  AND GROUND ON THE SUPPLIES OF FDIV) AND CAN PROVIDE
*  FREQUENCY DIVISION BY 2 TO GO BETWEEN YOUR EXTERNAL
*  SYNCH SIGNAL AND THE CLOCK INPUT OF THE PWM MODEL.
*  BECAUSE FDIV IS COMPONENT LEVEL IT IS SLOW AND WILL
*  EXTEND THE EXECUTION TIME BY AS MUCH AS 2 TO 1.
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM SIGNAL INPUT TO A FIXED VOLTAGE THAT IS EQUIVALENT
*  TO HALFWAY BETWEEN 50-50 DUTY FACTOR AND 100 PERCENT
*  DUTY FACTOR. RUN A SIMULATION THAT HAS TIME FOR OUTPUT
*  FILTER SETTLING. IF THE OUTPUT VOLTAGE WANDERS AROUND
*  RATHER THAN STAYS SETTLED TO LESS THAN ONE PERCENT YOU
*  SHOULD REDUCE THE TIMESTEP MAX (TMAX) PARAMETER IN THE
*  TRAN LINE. THIS IS THE FOURTH TIME PARAMETER ON THAT
*  LINE AND IS OPTIONAL LIKE THE TSTART PARAMETER (THIRD
*  TIME PARAMETER ON THAT LINE). IF YOU ARE NOT USING
*  TSTART YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL
*  RECOGNIZE TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY
*  SPICE 3 TMAX WILL USUALLY BE IN THE 500 TO 150 NS RANGE.
*  FOR PSPICE TMAX WILL USUALLY BE IN THE 250 TO 50 NS
*  RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, RAMP VCC AND VS UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST 10 MICROSECONDS OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES AND
*  CURRENTS FOR LATER SETTING OF NODESETS. LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*  BECAUSE THIS MODEL MUST BE CAPABLE OF RUNNING AT ANY
*  CLOCK RATE UP TO THE SPECIFICATION, THE MODEL MEASURES
*  THE CLOCK FREQUENCY AND FILTERS THE ANALOG RESULT AND
*  USES IT AS PART OF THE MODELING THAT CREATES THE
*  FREQUENCY DEPENDENT PART OF IQ(VSS). THE FILTER HAS A
*  TIME CONSTANT OF 300 USEC. DURING SHUTDOWN THE IQ(VSS)
*  IS SET TO A LOWER VALUE VIA THIS TIME CONSTANT AND
*  IQ(VCC) IS SET TO A LOWER VALUE WITH NO TIME CONSTANT.
*
*BEGIN MODEL SA04 FOR PSPICE
*PINOUT ORDER CKIN CKOUT +PWM -PWM GND ILIM ISENB BOUT +VS VCC AOUT ISENA
*PINOUT         1    2     3    4   5    6    7     8   9   10  11    12
.SUBCKT SA04_AM 1 2 3 4 5 6 7 8 9 10 11 12
V7 44 5 0 PULSE 0 5 0 10N 10N 22.22U 44.44U
RE2 41 5 1E9
E1 14 5 23 4 1
D5 12 11 D1M 
R13 27 5 10
R42 5 14 1E9
R39 67 63 10E3
C17 63 5 28E-12
R46 27 13 10E3
C18 13 5 28E-12
R1 40 11 R1M 0.121
R2 19 8 R1M 0.121
R3 64 12 R1M 0.121
R4 39 7 R1M 0.121
D4 13 27 D2M 
D8 63 67 D2M 
R14 32 23 1E3
R37 23 27 143E9
E4 32 5 66 5 1
E3 5 31 41 27 -1
R43 44 2 100
C22 2 5 10E-12
V2 41 5 4.5
D1 11 9 D1M 
E9 16 5 65 25 1000
D6 7 8 D1M
D7 8 9 D1M
V9 28 5 0.1
C4 9 34 220E-12
C5 9 37 220E-12
C6 11 35 220E-12
C7 8 33 220E-12
R10 34 11 0.70
R12 35 12 0.70
R18 37 8 0.70
R20 33 7 0.70
S5 61 27 14 5 S5M
C19 15 5 1000E-12
C20 29 5 2000E-12
R15 26 29 10
E13 43 5 42 38 1
R16 43 30 300
C21 30 5 1E-6
R17 3 15 50
R45 30 5 1E9
C10 65 5 1000E-12
R21 65 6 1E3
D2 46 47 DN
D3 48 46 DN
R22 46 16 1E3
V10 48 5 0.8
V11 47 0 4.1
R23 28 25 1E3
R24 57 25 1E6
R25 57 50 1E3
R26 59 50 1E3
R27 52 25 100E3
R19 60 5 1
C8 57 52 5E-12
V13 56 5 5
V8 22 5 2.5
Q1 57 53 5 QFN
Q2 57 54 5 QFN
Q3 59 55 5 QFN
Q4 59 51 5 QFN
R28 53 46 50E3
R29 54 59 50E3
R30 55 49 50E3
R31 51 57 50E3
C9 53 5 1E-12
C11 51 5 1E-12
C12 55 5 1E-12
C13 54 5 1E-12
R33 58 4 55E3
C15 4 5 470E-12
M1 49 62 5 5 M1M
M2 49 62 50 50 M2M
R34 62 1 50
C16 62 5 5E-12
E10 58 5 49 0 2
V12 50 5 5
R35 61 5 1E9
S7 26 42 22 13 S7M
S8 26 60 13 22 S7M
R36 66 5 10E6
R38 38 42 1
V4 38 5 10
G1 5 10 30 5 0.36
R40 10 69 500
S10 69 5 57 5 S1M
I2 10 5 0.05
GQ1 5 9 VALUE = {(-0.05)*((0.29+(V(9)/175))*(0.1+V(30)*(-2000)))}
R49 65 5 10E6
R51 15 66 50
R52 67 5 10
S1 9 40 13 5 S1M
S2 9 19 63 5 S1M
S3 11 64 63 5 S1M
S4 8 39 13 5 S1M
S6 67 31 57 5 S6M
S9 56 61 57 5 S1M
.MODEL R1M RES (TC1=7.374E-3 TC2=2.598E-5)
.MODEL QFN NPN (BF=100 NE=1.5 EG=1.11
+ IS=1.5E-15 NC=1.7 FC=0.5 CJC=1E-12)
.MODEL M1M NMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=2.25)
.MODEL M2M PMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=-2.25)
.MODEL S1M  VSWITCH RON=0.01 ROFF=1E6 VON=2.55 VOFF=2.0
.MODEL S5M  VSWITCH RON=1 ROFF=1E3 VON=0.001 VOFF=0
.MODEL S6M  VSWITCH RON=0.1 ROFF=1E4 VON=2.51 VOFF=0
.MODEL S7M  VSWITCH RON=1 ROFF=1E5 VON=0.1 VOFF=0
.MODEL D1M D (IS=5.414E-12 M=0.333 N=1.00 RS=0.0348 VJ=0.75)
.MODEL D2M D (IS=1.68E-08 M=0.333 N=1.89 RS=0.452 VJ=0.75)
.MODEL DN D (BV=100 CJO=4E-12 IS=7E-9 M=0.45 N=2 RS=0.8 TT=6E-9 VJ=0.6)
.ENDS
*END OF MODEL SA04
*************
*     SA04TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUTS
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 6 PIN NUMBERS CORRESPOND TO THE HARDWARE
* 7 A FLAG OUTPUT SHOWS INPUT VOLTAGE OUTSIDE THE MODULATION RANGE
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN AC SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).  
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION ALL THE WAY TO 0 OR 100% MODULATION, 
* WHICH IS NOT POSSIBLE WITH THE HARDWARE.
* 
* THE ILIM/SHDN FUNCTION IS NOT MODELED.
*
*BEGIN MODEL SA04TOOL FOR PSPICE.
*PINS CLKIN CLKOUT +PWM -PWM GND ILIM/SDN ISENB BOUT VS VCC AOUT ISENA
*PINS   1      2     3    4   5      6      7     8   9  10  11    12
.SUBCKT SA04TOOL_AM 1 2 3 4 5 6 7 8 9 10 11 12
* R110 & C110 DUPLICATE HARDWARE
R110 3 127 50
C110 127 0 .01U
* SET UP HIGH, LOW AND P-P RAMP VALUES
E124 124 0 123 125 1 
V123 123 0 7 
V125 125 0 3 
* S123 & S125 LIMIT MODULATOR DRIVE TO 0/100%
S123 129 123 127 123 SM1 
S125 125 129 125 127 SM1 
R129 127 129 10K 
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)
* E119 SHOWS ONLY INTEGRATOR VOLTAGE OUTSIDE MODULATION RANGE
E119 128 0 129 127 -1 
R128 128 6 10 
R6 3 0 1meg 
* 130 SERIES PARTS ARE THE NON-INVERTING OUT, 140 ARE INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 130 0 129 125 1 
E140 140 0 123 129 1 
* E131 & E141 GENERATE OUTPUTS; V(MODULATE)*PWM GAIN [VS/VP-P]
E141 141 0 VALUE={V(140)*V(9)/V(124)} 
E131 131 0 VALUE={V(130)*V(9)/V(124)} 
* R132 & 142 SET ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R132 131 11 .16 
R142 141 8 .16 
* E132 & E142 SENSE OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 0 @ VOUT=0 AND 1 @ VOUT=VS
E132 135 0 VALUE={(V(131)-V(11))*V(130)/V(124)} 
E142 145 0 VALUE={(V(141)-V(8))*V(140)/V(124)}
* G135 & G145 REFLECT OUTPUT CURRENT INTO VSENSE PINS
G135 208 0 135 0 -6.25 
G145 212 0 145 0 -6.25 
V135 208 7 0 
V145 212 12 0 
* F135 & F145 REFLECT CURRENT INTO VS PIN
F135 9 0 V135 1 
F145 9 0 V145 1 
* 
R1 1 0 1meg 
R2 2 0 1meg 
R4 4 0 1meg 
R5 5 0 1meg 
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D130 11 9 D1M 
D131 0 11 D1M 
D140 8 9 D1M 
D141 0 8 D1M 
.MODEL D1M D (IS=2.832E-12 M=0.333 N=1.00 RS=0.043 VJ=0.75)
*
D120 127 10 D1N4148 
D121 0 127 D1N4148
.MODEL D1N4148  D(IS=0.1P RS=16 CJO=2P TT=12N BV=100 IBV=0.1P)  
.ENDS
*END OF MODEL SA04TOOL
************
*       SA06 PWM MODEL FEATURES INCLUDE:
*
*   1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*   2 OUTPUT RESISTANCE AND CAPACITANCE
*   3 ACCURATE CATCH DIODE I V CHARACTERISTIC
*   4 ACCURATE RON TEMPERATURE COEFFICIENT
*   5 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*   6 DEADTIME BETWEEN SWITCH ON TIMES
*   7 ACCURATE IQ ON THE VCC LINE
*   8 REDUCTION IN IQ VCC IN SHUTDOWN
*   9 INTERNAL CMOS BUFFER ON THE CLK IN PIN
*  10 ILIM / SHUTDOWN FUNCTIONS
*
*     NOTE: THERMAL SHUTDOWN IS NOT MODELED
*     NOTE: HIGH SIDE CURRENT LIMIT IS NOT MODELED
*
*       SOME NOTES ON USING SPICE FOR PWM SIMULATION
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 100, INCREASE
*  RELTOL TO 0.003 TO 0.01, INCREASE ABSTOL TO 1E-11 TO
*  1E-9, INCREASE GMIN TO 1E-11 TO 1E-7, INCREASE VNTOL
*  TO 1E-5 TO 1E-4, OR INCREASE CHGTOL TO 1E-11 TO 1E-9.
*  ANY OR ALL OF THESE SIMULATOR OPTIONS MAY BE REQUIRED
*  DEPENDING ON YOUR SIMULATOR. NEWER SIMULATORS USUALLY
*  REQUIRE FEWER OF THEM.
*
*  TO AID THE INITIAL TRANSIENT CONVERGANCE, SET UP THE
*  INITIAL VALUE OF CLOCK IN AS FOLLOWS:
*        IF PWM IN > 5V, CLOCK IN INITIAL = 5 VOLTS
*        IF PWM IN < 5V, CLOCK IN INITIAL = 0 VOLTS
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  THE CLOCK IS A GENERATOR STATEMENT INSIDE THE MODEL.
*  WHERE THE REAL PART HAS AN OSCILLATOR FOLLOWED BY A
*  DIGITAL DIVIDE BY TWO, THE MODEL HAS THE GENERATOR
*  AT HALF OF THE CLOCK FREQUENCY. IF YOU NEED TO SYNCH-
*  RONIZE THE PWM CLOCK TO AN EXTERNAL SOURCE, LOOK IN
*  YOUR SIMULATOR LIBRARY FOR A SIMPLE FAST RUNNING
*  BEHAVIORAL FREQUENCY DIVIDER OR DFLOP. BECAUSE THE
*  EXTENTIONS THAT ALLOW BEHAVIORAL MODELS VARY WIDELY
*  AMONG VENDORS NONE ARE INCLUDED HERE. AT THE BOTTOM
*  OF THIS LIBRARY FILE YOU WILL FIND A COMPONENT LEVEL
*  FREQUENCY DIVIDER SUBCIRCUIT (FDIV) WILL WORK WITH
*  ALL SIMULATORS. IT WORKS AT FIVE VOLTS (PROVIDE 5V
*  AND GROUND ON THE SUPPLIES OF FDIV) AND CAN PROVIDE
*  FREQUENCY DIVISION BY 2 TO GO BETWEEN YOUR EXTERNAL
*  SYNCH SIGNAL AND THE CLOCK INPUT OF THE PWM MODEL.
*  BECAUSE FDIV IS COMPONENT LEVEL IT IS SLOW AND WILL
*  EXTEND THE EXECUTION TIME BY AS MUCH AS 2 TO 1.
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM SIGNAL INPUT TO A FIXED VOLTAGE THAT IS EQUIVALENT
*  TO HALFWAY BETWEEN 50-50 DUTY FACTOR AND 100 PERCENT
*  DUTY FACTOR. RUN A SIMULATION THAT HAS TIME FOR OUTPUT
*  FILTER SETTLING. IF THE OUTPUT VOLTAGE WANDERS AROUND
*  RATHER THAN STAYS SETTLED TO LESS THAN ONE PERCENT YOU
*  SHOULD REDUCE THE TIMESTEP MAX (TMAX) PARAMETER IN THE
*  TRAN LINE. THIS IS THE FOURTH TIME PARAMETER ON THAT
*  LINE AND IS OPTIONAL LIKE THE TSTART PARAMETER (THIRD
*  TIME PARAMETER ON THAT LINE). IF YOU ARE NOT USING
*  TSTART YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL
*  RECOGNIZE TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY
*  SPICE 3 TMAX WILL USUALLY BE IN THE 500 TO 150 NS RANGE.
*  FOR PSPICE TMAX WILL USUALLY BE IN THE 250 TO 50 NS
*  RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, RAMP VCC AND VS UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST 10 MICROSECONDS OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES AND
*  CURRENTS FOR LATER SETTING OF NODESETS. LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*  BECAUSE THIS MODEL MUST BE CAPABLE OF RUNNING AT ANY
*  CLOCK RATE UP TO THE SPECIFICATION, THE MODEL MEASURES
*  THE CLOCK FREQUENCY AND FILTERS THE ANALOG RESULT AND
*  USES IT AS PART OF THE MODELING THAT CREATES THE
*  FREQUENCY DEPENDENT PART OF IQ(VSS). THE FILTER HAS A
*  TIME CONSTANT OF 300 USEC. DURING SHUTDOWN THE IQ(VSS)
*  IS SET TO A LOWER VALUE VIA THIS TIME CONSTANT AND
*  IQ(VCC) IS SET TO A LOWER VALUE WITH NO TIME CONSTANT.
*
*BEGIN MODEL SA06 FOR PSPICE
*PINOUT ORDER CKIN CKOUT +PWM -PWM GND ILIM ISENB BOUT +VS VCC AOUT ISENA
*PINOUT ORDER   1    2     3    4   5    6    7    8    9  10   11   12
.SUBCKT SA06_AM 1 2 3 4 5 6 7 8 9 10 11 12
V7 44 5 0 PULSE 0 5 0 10N 10N 22.22U 44.44U
RE2 41 5 1E9
E1 14 5 23 4 1
D5 12 11 D1M 
R13 27 5 10
R42 5 14 1E9
R39 67 63 10E3
C17 63 5 28E-12
R46 27 13 10E3
C18 13 5 28E-12
R1 40 11 R1M 0.59
R2 19 8 R1M 0.59
R3 64 12 R1M 0.59
R4 39 7 R1M 0.59
D4 13 27 D2M 
D8 63 67 D2M 
R14 32 23 1E3
R37 23 27 143E9
E4 32 5 66 5 1
E3 5 31 41 27 -1
R43 44 2 100
C22 2 5 10E-12
V2 41 5 4.5
D1 11 9 D1M 
E9 16 5 65 25 1000
D6 7 8 D1M
D7 8 9 D1M
V9 28 5 0.1
C4 9 34 120E-12
C5 9 37 120E-12
C6 11 35 120E-12
C7 8 33 120E-12
R10 34 11 1.4
R12 35 12 1.4
R18 37 8 1.4
R20 33 7 1.4
S5 61 27 14 5 S5M  
C19 15 5 1000E-12
C20 29 5 2000E-12
R15 26 29 10
E13 43 5 42 38 1
R16 43 30 300
C21 30 5 1E-6
R17 3 15 50
R45 30 5 1E9
C10 65 5 1000E-12
R21 65 6 1E3
D2 46 47 DN
D3 48 46 DN
R22 46 16 1E3
V10 48 5 0.8
V11 47 0 4.1
R23 28 25 1E3
R24 57 25 1E6
R25 57 50 1E3
R26 59 50 1E3
R27 52 25 100E3
R19 60 5 1
C8 57 52 5E-12
V13 56 5 5
V8 22 5 2.5
Q1 57 53 5 QFN 
Q2 57 54 5 QFN 
Q3 59 55 5 QFN 
Q4 59 51 5 QFN 
R28 53 46 50E3
R29 54 59 50E3
R30 55 49 50E3
R31 51 57 50E3
C9 53 5 1E-12
C11 51 5 1E-12
C12 55 5 1E-12
C13 54 5 1E-12
R33 58 4 55E3
C15 4 5 470E-12
M1 49 62 5 5 M1M 
M2 49 62 50 50 M2M 
R34 62 1 50
C16 62 5 5E-12
E10 58 5 49 0 2
V12 50 5 5
R35 61 5 1E9
S7 26 42 22 13 S7M  
S8 26 60 13 22 S7M  
R36 66 5 10E6
R38 38 42 1
V4 38 5 10
G1 5 10 30 5 0.36
R40 10 69 500
S10 69 5 57 5 S1M
I2 10 5 0.05
GQ1 5 9 VALUE = {(-0.09)*((0.55+(V(9)/625))*(0.1+V(30)*(-2000)))}
R49 65 5 10E6
R51 15 66 50
R52 67 5 10
S1 9 40 13 5 S1M  
S2 9 19 63 5 S1M  
S3 11 64 63 5 S1M  
S4 8 39 13 5 S1M  
S6 67 31 57 5 S6M  
S9 56 61 57 5 S1M  
.MODEL R1M RES (TC1=7.374E-3 TC2=2.598E-5)
.MODEL QFN NPN (BF=100 NE=1.5 EG=1.11
+ IS=1.5E-15 NC=1.7 FC=0.5 CJC=1E-12)
.MODEL M1M NMOS CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=2.25
.MODEL M2M PMOS CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=-2.25
.MODEL S1M  VSWITCH RON=0.01 ROFF=1E6 VON=2.55 VOFF=2.0
.MODEL S5M  VSWITCH RON=1 ROFF=1E3 VON=0.001 VOFF=0
.MODEL S6M  VSWITCH RON=0.1 ROFF=1E4 VON=2.51 VOFF=0
.MODEL S7M  VSWITCH RON=1 ROFF=1E5 VON=0.1 VOFF=0
.MODEL D1M D (IS=4.118E-12 M=0.333 N=1.00 RS=0.0608 VJ=0.75)
.MODEL D2M D (IS=1.68E-08 M=0.333 N=1.89 RS=0.452 VJ=0.75)
.MODEL DN D (BV=100 CJO=4E-12 IS=7E-9 M=0.45 N=2 RS=0.8 TT=6E-9 VJ=0.6)
.ENDS
*END OF MODEL SA06
*************
*     SA06TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUTS
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 6 PIN NUMBERS CORRESPOND TO THE HARDWARE
* 7 A FLAG OUTPUT SHOWS INPUT VOLTAGE OUTSIDE THE MODULATION RANGE
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN AC SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).  
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION ALL THE WAY TO 0 OR 100% MODULATION, 
* WHICH IS NOT POSSIBLE WITH THE HARDWARE.
* 
* THE ILIM/SHDN FUNCTION IS NOT MODELED.
*
*BEGIN MODEL SA06TOOL FOR PSPICE.
*PINS CLKIN CLKOUT +PWM -PWM GND ILIM/SDN ISENB BOUT VS VCC AOUT ISENA
*PINS   1      2     3    4   5      6      7     8   9  10  11    12
.SUBCKT SA06TOOL_AM 1 2 3 4 5 6 7 8 9 10 11 12
* R110 & C110 DUPLICATE HARDWARE
R110 3 127 50
C110 127 0 .01U
* SET UP HIGH, LOW AND P-P RAMP VALUES
E124 124 0 123 125 1 
V123 123 0 7 
V125 125 0 3 
* S123 & S125 LIMIT MODULATOR DRIVE TO 0/100%
S123 129 123 127 123 SM1 
S125 125 129 125 127 SM1 
R129 127 129 10K 
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)
* E119 SHOWS ONLY INTEGRATOR VOLTAGE OUTSIDE MODULATION RANGE
E119 128 0 129 127 -1 
R128 128 6 10 
R6 3 0 1meg 
* 130 SERIES PARTS ARE THE NON-INVERTING OUT, 140 ARE INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 130 0 129 125 1 
E140 140 0 123 129 1 
* E131 & E141 GENERATE OUTPUTS; V(MODULATE)*PWM GAIN [VS/VP-P]
E141 141 0 VALUE={V(140)*V(9)/V(124)} 
E131 131 0 VALUE={V(130)*V(9)/V(124)} 
* R132 & 142 SET ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R132 131 11 .735 
R142 141 8 .735 
* E132 & E142 SENSE OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 0 @ VOUT=0 AND 1 @ VOUT=VS
E132 135 0 VALUE={(V(131)-V(11))*V(130)/V(124)} 
E142 145 0 VALUE={(V(141)-V(8))*V(140)/V(124)}
* G135 & G145 REFLECT OUTPUT CURRENT INTO VSENSE PINS
G135 208 0 135 0 -1.361
G145 212 0 145 0 -1.361
V135 208 7 0 
V145 212 12 0 
* F135 & F145 REFLECT CURRENT INTO VS PIN
F135 9 0 V135 1 
F145 9 0 V145 1 
* 
R1 1 0 1meg 
R2 2 0 1meg 
R4 4 0 1meg 
R5 5 0 1meg 
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D130 11 9 D1M 
D131 0 11 D1M 
D140 8 9 D1M 
D141 0 8 D1M 
.MODEL D1M D (IS=2.832E-12 M=0.333 N=1.00 RS=0.043 VJ=0.75)
*
D120 127 10 D1N4148 
D121 0 127 D1N4148
.MODEL D1N4148  D(IS=0.1P RS=16 CJO=2P TT=12N BV=100 IBV=0.1P)  
.ENDS
*END OF MODEL SA06TOOL
************
*       SA07 PWM MODEL FEATURES INCLUDE:
*
*   1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*   2 OUTPUT RESISTANCE AND CAPACITANCE
*   3 ACCURATE CATCH DIODE I V CHARACTERISTIC
*   4 ACCURATE RON TEMPERATURE COEFFICIENT
*   5 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*   6 DEADTIME BETWEEN SWITCH ON TIMES
*   7 INTERNAL ERROR AMPLIFIER WITH ACCURATE
*     BODE PLOT, SLEW, CMRR, INPUT AND OUTPUT
*     IMPEDANCES, INPUT BIAS AND OFFSET CURRENTS,
*     AND NON-SYMETRICAL OUTPUT CURRENT LIMIT
*   8 REFERENCE OUTPUT
*   9 REALISTIC REFERENCE OUTPUT IMPEDANCE
*  10 REFERENCE OUTPUT CURRENT LIMIT
*  11 ILIM / SHUTDOWN FUNCTIONS
*
*     NOTE: THERMAL SHUTDOWN IS NOT MODELED
*     NOTE: HIGH SIDE CURRENT LIMIT IS NOT MODELED
*
*       SOME NOTES ON USING SPICE FOR PWM SIMULATION
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 100, INCREASE
*  RELTOL TO 0.003 TO 0.01, INCREASE ABSTOL TO 1E-11 TO
*  1E-9, INCREASE GMIN TO 1E-11 TO 1E-7, INCREASE VNTOL
*  TO 1E-5 TO 1E-4, OR INCREASE CHGTOL TO 1E-11 TO 1E-9.
*  ANY OR ALL OF THESE SIMULATOR OPTIONS MAY BE REQUIRED
*  DEPENDING ON YOUR SIMULATOR. NEWER SIMULATORS USUALLY
*  REQUIRE FEWER OF THEM.
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM SIGNAL INPUT TO A FIXED VOLTAGE THAT IS EQUIVALENT
*  TO HALFWAY BETWEEN 50-50 DUTY FACTOR AND 100 PERCENT
*  DUTY FACTOR. RUN A SIMULATION THAT HAS TIME FOR OUTPUT
*  FILTER SETTLING. IF THE OUTPUT VOLTAGE WANDERS AROUND
*  RATHER THAN STAYS SETTLED TO LESS THAN ONE PERCENT YOU
*  SHOULD REDUCE THE TIMESTEP MAX (TMAX) PARAMETER IN THE
*  TRAN LINE. THIS IS THE FOURTH TIME PARAMETER ON THAT
*  LINE AND IS OPTIONAL LIKE THE TSTART PARAMETER (THIRD
*  TIME PARAMETER ON THAT LINE). IF YOU ARE NOT USING
*  TSTART YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL
*  RECOGNIZE TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY
*  SPICE 3 TMAX WILL USUALLY BE IN THE 500 TO 150 NS RANGE.
*  FOR PSPICE TMAX WILL USUALLY BE IN THE 250 TO 50 NS
*  RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, RAMP VCC AND VS UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST 10 MICROSECONDS OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES AND
*  CURRENTS FOR LATER SETTING OF NODESETS. LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*BEGIN MODEL SA07 FOR PSPICE
*PINS 5V -INT +INT INTO +PWM -PWM GND VCC ISA AO VS BO ISB ILIM CIN CO
*PINS  1   2    3    4    5    6   7   10  11 12 13 14  15  16   17 18
.SUBCKT SA07_AM 1 2 3 4 5 6 7 10 11 12 13 14 15 16 17 18
V7 21 7 5 PULSE 5 0 0 10N 10N 1U 2U
RX1 55 0 1E9
RX2 75 0 1E9
RX3 102 0 1E9
RX4 2 0 1E9
RX5 3 0 1E9
RX6 4 0 1E9
RX7 5 0 1E9
RX8 6 0 1E9
RX9 17 0 1E9
V13 48 7 5
D1 12 13 D1M
D5 11 12 D1M
D6 15 14 D1M
D7 14 13 D1M
E9 27 7 28 29 1000
V9 30 7 0.1
C10 28 7 1E-9
R21 28 16 1E3
D2 32 33 D1N
D3 34 32 D1N
CI1 2 7 3E-12
CI2 3 7 3E-12
R22 32 27 1E3
V10 34 7 0.8
V11 33 0 4.1
R23 30 29 1E3
R24 35 29 1E6
R25 35 36 1E3
R26 37 36 1E3
R27 38 29 100E3
C8 35 38 5E-12
R1 100 12 R1M 0.29
R2 95 14 R1M 0.29
R3 66 11 R1M 0.29
R4 57 15 R1M 0.29
C4 13 23 75E-12
C5 13 24 75E-12
C6 12 25 75E-12
C7 14 22 75E-12
R10 23 12 2.8
R12 25 11 2.8
R18 24 14 2.8
R20 22 15 2.8
Q1 35 39 7 Q1M
Q2 35 40 7 Q1M
Q3 37 41 7 Q1M
Q4 37 42 7 Q1M
R28 39 32 50E3
R29 40 37 50E3
R30 41 43 50E3
R31 42 35 50E3
C9 39 7 1E-12
C11 42 7 1E-12
C12 41 7 1E-12
C13 40 7 1E-12
R33 45 6 8.9E3
C15 6 7 100E-12
M1 43 47 7 7 M1M
M2 43 47 36 36 M2M
R34 47 17 1600
C16 47 7 5E-12
E10 45 7 43 7 1
V12 36 7 5
R35 26 7 1E9
E1 49 7 50 6 10
R13 51 7 10
R42 7 49 1E9
R39 52 46 10E3
C17 46 7 6.2E-12
R46 51 71 10E3
C18 71 7 6.2E-12
D4 71 51 D4M
D8 46 52 D4M
R14 53 50 1E3
R37 50 51 143E9
E3 7 54 55 51 -1
V2 55 7 4.5
S5 26 51 49 7 S5M
C19 56 7 0.01E-6
E4 53 7 56 7 1
C20 60 7 500E-12
R15 59 60 10
E13 62 7 61 63 1
R16 62 64 300
C21 64 7 0.1E-6
R45 64 7 1E9
R19 65 7 1
V8 58 7 2.5
S7 59 61 58 71 S7M
S8 59 65 71 58 S7M
R38 63 61 1
V4 63 7 10
G1 7 10 64 7 10.5
I2 10 7 0.01
R43 21 18 100
C22 18 7 10E-12
GQ1 7 13 VALUE={(-0.09)*((0.02+(v(13)/40.8))*(0.02+v(64)*(-339)))}
R49 28 7 10E6
R17 5 56 100
R52 52 7 10
R53 10 69 1200
S10 7 69 35 7 S10M
V20 70 2 0.7E-3
R59 72 73 35E6
G3 7 74 73 75 6E-5
R60 74 7 600E6
E2 76 7 77 7 1.0
R61 74 77 34E3
C26 77 7 1E-12
G5 7 78 77 7 0.001
R62 78 7 1000
C27 78 7 9.7E-12
G7 7 79 78 7 0.001
R63 79 7 1000
C28 79 7 4E-12
R65 73 81 1E9
R66 72 81 1E9
G8 7 82 81 7 1E-3
R67 82 83 1
L3 83 7 3E-5
E5 72 75 82 7 1
E12 107 7 1 7 1
V22 84 85 0.62
V17 107 80 0
V23 77 87 0.62
R68 83 7 50
I3 80 88 250E-6
I4 89 7 250E-6
R69 4 90 40
Q5 80 79 89 QON
Q6 80 88 90 QON
Q7 7 79 88 QOP
Q8 7 89 90 QOP
E7 86 7 91 7 -1
E8 85 77 91 7 -1
F1 10 7 V17 1
I5 7 91 2.7E-5
Q9 92 93 94 QI1
I7 93 94 2E-5
Q10 72 3 96 Q6M
Q11 73 70 97 Q6M
R72 92 96 135
R73 92 97 135
R74 72 7 200
R75 73 7 200
V26 98 94 2
E11 80 98 91 7 -1
I19 94 70 10E-9
I6 10 99 60E-6
Q24 10 99 1 QON
Q26 7 101 99 QOP
V15 102 7 5
R40 1 7 16E3
V16 103 7 0.8
R54 104 101 1E3
C23 1 105 0.01E-6
G2 7 104 102 1 0.01
R56 7 104 400E3
C24 106 104 10E-12
R57 7 106 10E3
R58 105 7 1
S1 52 54 35 7 S1M
S2 48 26 35 7 S2M
S3 13 100 71 7 S3M
S4 12 66 46 7 S3M
S6 13 95 46 7 S3M
S9 14 57 71 7 S3M
D15 84 80 D15M
D17 86 87 D15M
D18 91 7 D15M
D19 76 74 D15M
D20 74 76 D15M
D21 101 10 D15M
D22 103 101 D15M
.MODEL R1M RES (TC1=7.374E-3 TC2=2.598E-5)
.MODEL S1M VSWITCH RON=0.1 ROFF=1E3 VON=2.75 VOFF=2.5
.MODEL S2M VSWITCH RON=0.1 ROFF=1E6 VON=2.75 VOFF=2.5
.MODEL S3M VSWITCH RON=0.01 ROFF=1E6 VON=2.5 VOFF=2
.MODEL S5M VSWITCH RON=1 ROFF=1E3 VON=0.001 VOFF=0
.MODEL S7M VSWITCH RON=1 ROFF=100E3 VON=0.15 VOFF=0.05
.MODEL S10M VSWITCH RON=0.01 ROFF=1E6 VON=2.5 VOFF=2
.MODEL QI1 PNP
.MODEL QOP PNP
.MODEL QON NPN
.MODEL Q1M NPN (CJC=1E-12)
.MODEL Q6M PNP (BF=12000)
.MODEL M1M NMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50 RS=50 VTO=2.25)
.MODEL M2M PMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50 RS=50 VTO=-2.25)
.MODEL D4M D (CJO=2E-12 IS=1E-15 M=0.33 RS=0.5 TT=10E-9)
.MODEL D1N D (IS=1E-15)
.MODEL D15M D (IS=1E-15)
.MODEL D1M D (CJO=5E-12 IS=6.792E-13 M=0.33 N=1 RS=0.3226 VJ=0.75)
.ENDS
*END OF MODEL SA07
*************
*     SA07TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUTS
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 6 PIN NUMBERS CORRESPOND TO THE HARDWARE
* 7 A FLAG OUTPUT SHOWS INPUT VOLTAGE OUTSIDE THE MODULATION RANGE
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN AC SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).  
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION ALL THE WAY TO 0 OR 100% MODULATION, 
* WHICH IS NOT POSSIBLE WITH THE HARDWARE.
* 
* THE SHDN/FILTER FUNCTION IS NOT MODELED,PIN IS OVER MODULATION FLAG.
*
*BEGIN MODEL SA07TOOL FOR PSPICE.
*PINS 5V -INT +INT INTO +PWM -PWM GND VCC ISA AO VS BO ISB ILIM CIN CO
*PINS  1   2    3    4    5    6   7   10  11 12 13 14  15  16   17 18
.SUBCKT SA07TOOL_AM 1 2 3 4 5 6 7 10 11 12 13 14 15 16 17 18
* SET UP HIGH, LOW AND P-P RAMP VALUES
V123 123 0 3.75
V125 125 0 1.25
E124 124 0 123 125 1 
* S123 & S125 LIMIT MODULATOR DRIVE TO 0/100%
S123 129 123 108 123 SM1 
S125 125 129 125 108 SM1 
R129 108 129 10K 
*R108 & C108 ARE REAL PARTS IN SA07.
R108 5 108 100
C108 108 0 .01E-6
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)
* E119 SHOWS ONLY INTEGRATOR VOLTAGE OUTSIDE MODULATION RANGE
E119 128 0 129 108 -1 
R128 128 16 10 
R116 16 0 1MEG 
* 130 SERIES PARTS ARE THE NON-INVERTING OUT, 140 ARE INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 130 0 129 125 1 
E140 140 0 123 129 1 
* E131 & E141 GENERATE OUTPUTS; V(MODULATE)*PWM GAIN [VS/VP-P]
E131 131 0 VALUE={V(130)*V(13)/V(124)} 
E141 141 0 VALUE={V(140)*V(13)/V(124)} 
* R132 & 142 SET ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R132 131 12 .386 
R142 141 14 .386 
* E132 & E142 SENSE OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 0 @ VOUT=0 AND 1 @ VOUT=VS
E132 135 0 VALUE={(V(131)-V(12))*V(130)/V(124)} 
E142 145 0 VALUE={(V(141)-V(14))*V(140)/V(124)} 
* G135 & G145 REFLECT OUTPUT CURRENT INTO VSENSE PINS
G135 215 0 135 0 -2.591
G145 211 0 145 0 -2.591
V135 215 15 0 
V145 211 11 0 
* F135 & F145 REFLECT CURRENT INTO VS PIN
F135 13 0 V135 1 
F145 13 0 V145 1 
*
VREF 1 0 5 
R101 1 0 1MEG 
*
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D130 12 13 D1M 
D131 0 12 D1M 
D140 14 13 D1M 
D141 0 14 D1M 
.MODEL D1M D (CJO=5E-12 IS=6.792E-13 M=0.33 N=1 RS=0.3226 VJ=0.75)
*
D120 2 1 D1N4148 
D122 0 2 D1N4148 
D121 1 3 D1N4148 
D123 0 3 D1N4148 
.MODEL D1N4148  D(IS=0.1P RS=16 CJO=2P TT=12N BV=100 IBV=0.1P)  
*
R106 6 0 1MEG
R107 7 0 1MEG 
R110 10 0 1MEG 
R117 17 0 1MEG 
R118 18 0 1MEG 
*
* SA07 ERROR AMP
* PINOUT +IN -IN +V -V OUT
* PINOUT  3   2   1  0  4
*.SUBCKT EA07 3 2 1 0 4
E5 51 0 55 0 -1
E6 61 62 55 0 -1
D1 55 0 DE1
I3 0 55 2.7E-5
Q5 56 57 58 QI1
I4 57 58 2E-5
Q6 52 2 53 Q6M
Q7 50 28 54 Q6M
R7 56 53 135
R8 56 54 135
R9 52 0 200
R10 50 0 200
V13 28 3 0.7E-3
R6 52 50 35E6
G1 0 22 50 60 -6E-5
R12 22 0 600E6
E2 21 0 62 0 1.0
R13 22 62 34E3
C11 62 0 1E-12
G5 0 23 62 0 0.001
R19 23 0 1E3
C12 23 0 9.7E-12
V12 59 58 2
G7 0 24 23 0 0.001
R20 24 0 1000
C13 24 0 4E-12
R22 50 19 1E9
R23 52 19 1E9
G8 0 20 19 0 1E-3
R24 20 27 1
L3 27 0 3E-5
E4 52 60 20 0 1
D9 25 1 DE1
V15 25 61 0.62
D10 51 26 DE1
V16 62 26 0.62
D14 21 22 DE1
D16 22 21 DE1
R25 27 0 50
I1 1 31 250E-6
I2 30 0 250E-6
R26 4 29 40
Q1 1 24 30 QON
Q2 1 31 29 QON
Q3 0 24 31 QOP
Q4 0 30 29 QOP
E9 1 59 55 0 -1
I19 58 28 10E-9
.MODEL QON NPN
.MODEL QOP PNP
.MODEL QI1 PNP
.MODEL Q6M PNP (BF=12E3)
.MODEL DE1 D (IS=1E-15)
.ENDS
*END OF SA07 ERROR AMP
*END OF MODEL SA07TOOL
**********
*       SA08 PWM MODEL FEATURES INCLUDE:
*
*   1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*   2 OUTPUT RESISTANCE AND CAPACITANCE
*   3 ACCURATE CATCH DIODE I V CHARACTERISTIC
*   4 ACCURATE RON AND VON
*   5 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*   6 DEADTIME BETWEEN SWITCH ON TIMES
*   7 ACCURATE IQ ON THE VCC LINE
*   8 REDUCTION IN IQ VCC IN SHUTDOWN
*   9 INTERNAL CMOS BUFFER ON THE CLK IN PIN
*  10 ILIM / SHUTDOWN FUNCTIONS
*
*     NOTE: THIS MODEL DOES NOT SUPPORT THE FLAG PIN
*     NOTE: THERMAL SHUTDOWN IS NOT MODELED
*     NOTE: HIGH SIDE CURRENT LIMIT IS NOT MODELED
*
*****   SOME NOTES ON USING SPICE FOR PWM SIMULATION  *****
*
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 100, INCREASE
*  RELTOL TO 0.003 TO 0.01, INCREASE ABSTOL TO 1E-11 TO
*  1E-9, INCREASE GMIN TO 1E-11 TO 1E-7, INCREASE VNTOL
*  TO 1E-5 TO 1E-4, OR INCREASE CHGTOL TO 1E-11 TO 1E-9.
*  ANY OR ALL OF THESE SIMULATOR OPTIONS MAY BE REQUIRED
*  DEPENDING ON YOUR SIMULATOR. NEWER SIMULATORS USUALLY
*  REQUIRE FEWER OF THEM.
*
*  TO AID THE INITIAL TRANSIENT CONVERGANCE, SET UP THE
*  INITIAL VALUE OF CLOCK IN AS FOLLOWS:
*        IF PWM IN > 5V, CLOCK IN INITIAL = 5 VOLTS
*        IF PWM IN < 5V, CLOCK IN INITIAL = 0 VOLTS
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  THE CLOCK IS A GENERATOR STATEMENT INSIDE THE MODEL.
*  WHERE THE REAL PART HAS AN OSCILLATOR FOLLOWED BY A
*  DIGITAL DIVIDE BY TWO, THE MODEL HAS THE GENERATOR
*  AT HALF OF THE CLOCK FREQUENCY. IF YOU NEED TO SYNCH-
*  RONIZE THE PWM CLOCK TO AN EXTERNAL SOURCE, LOOK IN
*  YOUR SIMULATOR LIBRARY FOR A SIMPLE FAST RUNNING
*  BEHAVIORAL FREQUENCY DIVIDER OR DFLOP. BECAUSE THE
*  EXTENTIONS THAT ALLOW BEHAVIORAL MODELS VARY WIDELY
*  AMONG VENDORS NONE ARE INCLUDED HERE. AT THE BOTTOM
*  OF THIS LIBRARY FILE YOU WILL FIND A COMPONENT LEVEL
*  FREQUENCY DIVIDER SUBCIRCUIT (FDIV) WILL WORK WITH
*  ALL SIMULATORS. IT WORKS AT FIVE VOLTS (PROVIDE 5V
*  AND GROUND ON THE SUPPLIES OF FDIV) AND CAN PROVIDE
*  FREQUENCY DIVISION BY 2 TO GO BETWEEN YOUR EXTERNAL
*  SYNCH SIGNAL AND THE CLOCK INPUT OF THE PWM MODEL.
*  BECAUSE FDIV IS COMPONENT LEVEL IT IS SLOW AND WILL
*  EXTEND THE EXECUTION TIME BY AS MUCH AS 2 TO 1.
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM SIGNAL INPUT TO A FIXED VOLTAGE THAT IS EQUIVALENT
*  TO HALFWAY BETWEEN 50-50 DUTY FACTOR AND 100 PERCENT
*  DUTY FACTOR. RUN A SIMULATION THAT HAS TIME FOR OUTPUT
*  FILTER SETTLING. IF THE OUTPUT VOLTAGE WANDERS AROUND
*  RATHER THAN STAYS SETTLED TO LESS THAN ONE PERCENT YOU
*  SHOULD REDUCE THE TIMESTEP MAX (TMAX) PARAMETER IN THE
*  TRAN LINE. THIS IS THE FOURTH TIME PARAMETER ON THAT
*  LINE AND IS OPTIONAL LIKE THE TSTART PARAMETER (THIRD
*  TIME PARAMETER ON THAT LINE). IF YOU ARE NOT USING
*  TSTART YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL
*  RECOGNIZE TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY
*  SPICE 3 TMAX WILL USUALLY BE IN THE 500 TO 150 NS RANGE.
*  FOR PSPICE TMAX WILL USUALLY BE IN THE 250 TO 50 NS
*  RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, RAMP VCC AND VS UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST 10 MICROSECONDS OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES AND
*  CURRENTS FOR LATER SETTING OF NODESETS. LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*  BECAUSE THIS MODEL MUST BE CAPABLE OF RUNNING AT ANY
*  CLOCK RATE UP TO THE SPECIFICATION, THE MODEL MEASURES
*  THE CLOCK FREQUENCY AND FILTERS THE ANALOG RESULT AND
*  USES IT AS PART OF THE MODELING THAT CREATES THE
*  FREQUENCY DEPENDENT PART OF IQ(VSS). THE FILTER HAS A
*  TIME CONSTANT OF 300 USEC. DURING SHUTDOWN THE IQ(VSS)
*  IS SET TO A LOWER VALUE VIA THIS TIME CONSTANT AND
*  IQ(VCC) IS SET TO A LOWER VALUE WITH NO TIME CONSTANT.
*
*BEGIN MODEL SA08 FOR PSPICE
*PINOUT ORDER CKIN CKOUT PWM GND ILIM ISENB BOUT +VS VCC AOUT ISENA
*PINOUT         1    2    3   5    6    7     8   9   10  11    12
.SUBCKT SA08_AM 1 2 3 5 6 7 8 9 10 11 12
V7 44 5 0 PULSE 0 5 0 10N 10N 22.22U 44.44U
RE2 41 5 1E9
E1 14 5 23 15 1
D5 12 11 D1M
R13 27 5 10
R42 5 14 1E9
R39 67 63 10E3
C17 63 5 28E-12
R46 27 13 10E3
C18 13 5 28E-12
R1 40 11 0.085
R2 19 8 0.085
R3 64 12 0.085
R4 39 7 0.085
D4 13 27 D2M
D8 63 67 D2M
R14 32 23 1E3
R37 23 27 143E9
E4 32 5 68 5 1
E3 5 31 41 27 -1
R43 44 2 100
C22 2 5 10E-12
V2 41 5 4.5
D1 11 9 D1M
E9 16 5 65 25 1000
D6 7 8 D1M
D7 8 9 D1M
V9 28 5 0.1
C4 9 34 300E-12
C5 9 37 300E-12
C6 11 35 300E-12
C7 8 33 300E-12
R10 34 11 0.7
R12 35 12 0.7
R18 37 8 0.7
R20 33 7 0.7
S5 61 27 14 5 S5M
C19 66 5 1000E-12
C20 29 5 2000E-12
R15 26 29 10
E13 43 5 42 38 1
R16 43 30 300
C21 30 5 1E-6
R45 30 5 1E9
C10 65 5 1000E-12
R21 65 6 1E3
D2 46 47 DN
D3 48 46 DN
R22 46 16 1E3
V10 48 5 0.8
V11 47 0 4.1
R23 28 25 1E3
R24 57 25 1E6
R25 57 50 1E3
R26 59 50 1E3
R27 52 25 100E3
R19 60 5 1
C8 57 52 5E-12
V13 56 5 5
V8 22 5 2.5
Q1 57 53 5 QFN
Q2 57 54 5 QFN
Q3 59 55 5 QFN
Q4 59 51 5 QFN
R28 53 46 50E3
R29 54 59 50E3
R30 55 49 50E3
R31 51 57 50E3
C9 53 5 1E-12
C11 51 5 1E-12
C12 55 5 1E-12
C13 54 5 1E-12
R33 58 15 55E3
C15 15 5 470E-12
M1 49 62 5 5 M1M
M2 49 62 50 50 M2M
R34 62 1 50
C16 62 5 5E-12
E10 58 5 49 0 2
V12 50 5 5
R35 61 5 1E9
S7 26 42 22 13 S7M
S8 26 60 13 22 S7M
R36 68 5 10E6
R38 38 42 1
V4 38 5 10
G1 5 10 30 5 0.36
R40 10 69 500
S10 69 5 57 5 S1M
I2 10 5 0.05
GQ1 5 9 VALUE = {(-0.09)*((0.6+(V(9)/600))*(0.45+V(30)*(-1000)))}
R49 65 5 10E6
R51 66 68 50
R52 3 66 50
R53 67 5 10
VD1 9 71 0.85
VD2 9 72 0.85
VD3 11 73 0.85
VD4 8 74 0.85
S1 71 40 13 5 S1M
S2 72 19 63 5 S1M
S3 73 64 63 5 S1M
S4 74 39 13 5 S1M
S6 67 31 57 5 S6M
S9 56 61 57 5 S1M
.MODEL QFN NPN (BF=100 NE=1.5 EG=1.11
+ IS=1.5E-15 NC=1.7 FC=0.5 CJC=1E-12)
.MODEL M1M NMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=2.25)
.MODEL M2M PMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=-2.25)
.MODEL S1M VSWITCH RON=0.01 ROFF=1E6 VON=2.55 VOFF=2.0
.MODEL S5M VSWITCH RON=1 ROFF=1E3 VON=0.001 VOFF=0
.MODEL S6M VSWITCH RON=0.1 ROFF=1E4 VON=2.91 VOFF=2.5
.MODEL S7M VSWITCH RON=1 ROFF=1E5 VON=0.1 VOFF=0
.MODEL D1M D (IS=2.645E-15 M=0.333 N=1.00 RS=0.086 VJ=0.75)
.MODEL D2M D (IS=1.68E-08 M=0.333 N=1.89 RS=0.452 VJ=0.75)
.MODEL DN D (BV=100 CJO=4E-12 IS=7E-09 M=0.45 N=2 RS=0.8 TT=6E-9 VJ=0.6)
.ENDS
*END OF MODEL SA08
*************
*     SA08TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUTS
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 6 PIN NUMBERS CORRESPOND TO THE HARDWARE
* 7 A FLAG OUTPUT SHOWS INPUT VOLTAGE OUTSIDE THE MODULATION RANGE
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN AC SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).  
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION ALL THE WAY TO 0 OR 100% MODULATION, 
* WHICH IS NOT POSSIBLE WITH THE HARDWARE.
* 
* THE ILIM/SHDN FUNCTION IS NOT MODELED.
*
*BEGIN MODEL SA08TOOL FOR PSPICE.
*PINS CLKIN CLKOUT +PWM GND ILIM/SDN ISENB BOUT VS VCC AOUT ISENA
*PINS   1      2     3   5      6      7     8   9  10  11    12
.SUBCKT SA08TOOL_AM 1 2 3 5 6 7 8 9 10 11 12
* R110 & C110 DUPLICATE HARDWARE
R110 3 127 50
C110 127 0 .01U
* SET UP HIGH, LOW AND P-P RAMP VALUES
E124 124 0 123 125 1 
V123 123 0 7 
V125 125 0 3 
* S123 & S125 LIMIT MODULATOR DRIVE TO 0/100%
S123 129 123 127 123 SM1 
S125 125 129 125 127 SM1 
R129 127 129 10K 
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)
* E119 SHOWS ONLY INTEGRATOR VOLTAGE OUTSIDE MODULATION RANGE
E119 128 0 129 127 -1 
R128 128 6 10 
R6 3 0 1meg 
* 130 SERIES PARTS ARE THE NON-INVERTING OUT, 140 ARE INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 130 0 129 125 1 
E140 140 0 123 129 1 
* E131 & E141 GENERATE OUTPUTS; V(MODULATE)*PWM GAIN [VS/VP-P]
E141 141 0 VALUE={V(140)*V(9)/V(124)} 
E131 131 0 VALUE={V(130)*V(9)/V(124)} 
* R132 & 142 SET ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R132 131 11 .1375 
R142 141 8 .1375 
* E132 & E142 SENSE OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 0 @ VOUT=0 AND 1 @ VOUT=VS
E132 135 0 VALUE={(V(131)-V(11))*V(130)/V(124)} 
E142 145 0 VALUE={(V(141)-V(8))*V(140)/V(124)} 
* G135 & G145 REFLECT OUTPUT CURRENT INTO VSENSE PINS
G135 208 0 135 0 -7.273
G145 212 0 145 0 -7.273
V135 208 7 0 
V145 212 12 0 
* F135 & F145 REFLECT CURRENT INTO VS PIN
F135 9 0 V135 1 
F145 9 0 V145 1 
* 
R1 1 0 1meg 
R2 2 0 1meg 
R5 5 0 1meg 
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D130 11 9 D1M 
D131 0 11 D1M 
D140 8 9 D1M 
D141 0 8 D1M 
.MODEL D1M D (IS=2.832E-12 M=0.333 N=1.00 RS=0.043 VJ=0.75)
*
D120 127 10 D1N4148 
D121 0 127 D1N4148
.MODEL D1N4148  D(IS=0.1P RS=16 CJO=2P TT=12N BV=100 IBV=0.1P)  
.ENDS
*END OF MODEL SA08TOOL
**********
*       SA12 PWM MODEL FEATURES INCLUDE:
*
*   1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*   2 OUTPUT RESISTANCE AND CAPACITANCE
*   3 ACCURATE CATCH DIODE I V CHARACTERISTIC
*   4 ACCURATE RON TEMPERATURE COEFFICIENT
*   5 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*   6 DEADTIME BETWEEN SWITCH ON TIMES
*   7 ACCURATE IQ ON THE VCC LINE
*   8 REDUCTION IN IQ VCC IN SHUTDOWN
*   9 INTERNAL CMOS BUFFER ON THE CLK IN PIN
*  10 ILIM / SHUTDOWN FUNCTIONS
*
*     NOTE: THERMAL SHUTDOWN IS NOT MODELED
*     NOTE: HIGH SIDE CURRENT LIMIT IS NOT MODELED
*
*       SOME NOTES ON USING SPICE FOR PWM SIMULATION
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 100, INCREASE
*  RELTOL TO 0.003 TO 0.01, INCREASE ABSTOL TO 1E-11 TO
*  1E-9, INCREASE GMIN TO 1E-11 TO 1E-7, INCREASE VNTOL
*  TO 1E-5 TO 1E-4, OR INCREASE CHGTOL TO 1E-11 TO 1E-9.
*  ANY OR ALL OF THESE SIMULATOR OPTIONS MAY BE REQUIRED
*  DEPENDING ON YOUR SIMULATOR. NEWER SIMULATORS USUALLY
*  REQUIRE FEWER OF THEM.
*
*  TO AID THE INITIAL TRANSIENT CONVERGANCE, SET UP THE
*  INITIAL VALUE OF CLOCK IN AS FOLLOWS:
*        IF PWM IN > 5V, CLOCK IN INITIAL = 5 VOLTS
*        IF PWM IN < 5V, CLOCK IN INITIAL = 0 VOLTS
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  THE CLOCK IS A GENERATOR STATEMENT INSIDE THE MODEL.
*  WHERE THE REAL PART HAS AN OSCILLATOR FOLLOWED BY A
*  DIGITAL DIVIDE BY TWO, THE MODEL HAS THE GENERATOR
*  AT HALF OF THE CLOCK FREQUENCY. IF YOU NEED TO SYNCH-
*  RONIZE THE PWM CLOCK TO AN EXTERNAL SOURCE, LOOK IN
*  YOUR SIMULATOR LIBRARY FOR A SIMPLE FAST RUNNING
*  BEHAVIORAL FREQUENCY DIVIDER OR DFLOP. BECAUSE THE
*  EXTENTIONS THAT ALLOW BEHAVIORAL MODELS VARY WIDELY
*  AMONG VENDORS NONE ARE INCLUDED HERE. AT THE BOTTOM
*  OF THIS LIBRARY FILE YOU WILL FIND A COMPONENT LEVEL
*  FREQUENCY DIVIDER SUBCIRCUIT (FDIV) WILL WORK WITH
*  ALL SIMULATORS. IT WORKS AT FIVE VOLTS (PROVIDE 5V
*  AND GROUND ON THE SUPPLIES OF FDIV) AND CAN PROVIDE
*  FREQUENCY DIVISION BY 2 TO GO BETWEEN YOUR EXTERNAL
*  SYNCH SIGNAL AND THE CLOCK INPUT OF THE PWM MODEL.
*  BECAUSE FDIV IS COMPONENT LEVEL IT IS SLOW AND WILL
*  EXTEND THE EXECUTION TIME BY AS MUCH AS 2 TO 1.
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM SIGNAL INPUT TO A FIXED VOLTAGE THAT IS EQUIVALENT
*  TO HALFWAY BETWEEN 50-50 DUTY FACTOR AND 100 PERCENT
*  DUTY FACTOR. RUN A SIMULATION THAT HAS TIME FOR OUTPUT
*  FILTER SETTLING. IF THE OUTPUT VOLTAGE WANDERS AROUND
*  RATHER THAN STAYS SETTLED TO LESS THAN ONE PERCENT YOU
*  SHOULD REDUCE THE TIMESTEP MAX (TMAX) PARAMETER IN THE
*  TRAN LINE. THIS IS THE FOURTH TIME PARAMETER ON THAT
*  LINE AND IS OPTIONAL LIKE THE TSTART PARAMETER (THIRD
*  TIME PARAMETER ON THAT LINE). IF YOU ARE NOT USING
*  TSTART YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL
*  RECOGNIZE TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY
*  SPICE 3 TMAX WILL USUALLY BE IN THE 500 TO 150 NS RANGE.
*  FOR PSPICE TMAX WILL USUALLY BE IN THE 250 TO 50 NS
*  RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, RAMP VCC AND VS UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST 10 MICROSECONDS OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES AND
*  CURRENTS FOR LATER SETTING OF NODESETS. LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*  BECAUSE THIS MODEL MUST BE CAPABLE OF RUNNING AT ANY
*  CLOCK RATE UP TO THE SPECIFICATION, THE MODEL MEASURES
*  THE CLOCK FREQUENCY AND FILTERS THE ANALOG RESULT AND
*  USES IT AS PART OF THE MODELING THAT CREATES THE
*  FREQUENCY DEPENDENT PART OF IQ(VSS). THE FILTER HAS A
*  TIME CONSTANT OF 300 USEC. DURING SHUTDOWN THE IQ(VSS)
*  IS SET TO A LOWER VALUE VIA THIS TIME CONSTANT AND
*  IQ(VCC) IS SET TO A LOWER VALUE WITH NO TIME CONSTANT.
*
*BEGIN MODEL SA12 FOR PSPICE
*PINOUT ORDER CKIN CKOUT +PWM -PWM GND ILIM ISENB BOUT +VS VCC AOUT ISENA
*PINOUT         1    2     3    4   5    6    7     8   9   10  11    12
.SUBCKT SA12_AM 1 2 3 4 5 6 7 8 9 10 11 12
V7 44 5 0 PULSE 0 5 0 10N 10N 2.5U 5U 
RE2 41 5 1E9
E1 14 5 23 4 1
D5 12 11 D5M
R13 27 5 10
R42 5 14 1E9
R39 67 63 10E3
C17 63 5 28E-12
R46 27 13 10E3
C18 13 5 28E-12
R1 40 11 R1M 0.49
R2 19 8 R1M 0.49
R3 64 12 R1M 0.49
R4 39 7 R1M 0.49
D4 13 27 D2M 
D8 63 67 D2M 
R14 32 23 1E3
R37 23 27 143E9
E4 32 5 66 5 1
E3 5 31 41 27 -1
R43 44 2 100
C22 2 5 10E-12
V2 41 5 4.5
D1 11 9 D1M
E9 16 5 65 25 1000
D6 7 8 D1M
D7 8 9 D1M
V9 28 5 0.1
C4 9 34 225E-12
C5 9 37 225E-12
C6 11 35 225E-12
C7 8 33 225E-12
R10 34 11 0.93
R12 35 12 0.93
R18 37 8 0.93
R20 33 7 0.93
S5 61 27 14 5 S5M
C19 15 5 1000E-12
C20 29 5 2000E-12
R15 26 29 10
E13 43 5 42 38 1
R16 43 30 300
C21 30 5 1E-6
R17 3 15 50
R45 30 5 1E9
C10 65 5 1000E-12
R21 65 6 1E3
D2 46 47 DN
D3 48 46 DN
R22 46 16 1E3
V10 48 5 0.8
V11 47 0 4.1
R23 28 25 1E3
R24 57 25 1E6
R25 57 50 1E3
R26 59 50 1E3
R27 52 25 100E3
R19 60 5 1
C8 57 52 5E-12
V13 56 5 5
V8 22 5 2.5
Q1 57 53 5 QFN
Q2 57 54 5 QFN
Q3 59 55 5 QFN
Q4 59 51 5 QFN
R28 53 46 50E3
R29 54 59 50E3
R30 55 49 50E3
R31 51 57 50E3
C9 53 5 1E-12
C11 51 5 1E-12
C12 55 5 1E-12
C13 54 5 1E-12
R33 58 4 28.1E3
C15 4 5 102E-12
M1 49 62 5 5 M1M
M2 49 62 50 50 M2M
R34 62 1 50
C16 62 5 5E-12
E10 58 5 49 0 2
V12 50 5 5
R35 61 5 1E9
S7 26 42 22 13 S7M
S8 26 60 13 22 S7M
R36 66 5 10E6
R38 38 42 1
V4 38 5 10
G1 5 10 30 5 0.36
R40 10 69 500
S10 69 5 57 5 S1M
I2 10 5 0.05
GQ1 5 9 VALUE = {(-0.2)*((0.4+(V(9)/200))*(0.1+V(30)*(-225)))}
R49 65 5 10E6
R51 15 66 50
R52 67 5 10
S1 9 40 13 5 S1M
S2 9 19 63 5 S1M
S3 11 64 63 5 S1M
S4 8 39 13 5 S1M
S6 67 31 57 5 S6M
S9 56 61 57 5 S1M
.MODEL R1M RES (TC1=7.374E-3 TC2=2.598E-5)
.MODEL QFN NPN (BF=100 NE=1.5 EG=1.11
+ IS=1.5E-15 NC=1.7 FC=0.5 CJC=1E-12)
.MODEL M1M NMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=2.25)
.MODEL M2M PMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=-2.25)
.MODEL S1M  VSWITCH RON=0.01 ROFF=1E6 VON=2.55 VOFF=2.0
.MODEL S5M  VSWITCH RON=1 ROFF=1E3 VON=0.001 VOFF=0
.MODEL S6M  VSWITCH RON=0.1 ROFF=1E4 VON=2.51 VOFF=0
.MODEL S7M  VSWITCH RON=1 ROFF=1E5 VON=0.1 VOFF=0
.MODEL D1M D (IS=2.832E-12 M=0.333 N=1.00 RS=0.043 VJ=0.75)
.MODEL D2M D (IS=1.68E-08 M=0.333 N=1.89 RS=0.452 VJ=0.75)
.MODEL D5M D (IS=2.832E-12 M=0.333 N=1.00 RS=0.043 VJ=0.75)
.MODEL DN D (BV=100 CJO=4E-12 IS=7E-9 M=0.45 N=2 RS=0.8 TT=6E-9 VJ=0.6)
.ENDS
*END OF MODEL SA12
*************
*     SA12TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUTS
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 6 PIN NUMBERS CORRESPOND TO THE HARDWARE
* 7 A FLAG OUTPUT SHOWS INPUT VOLTAGE OUTSIDE THE MODULATION RANGE
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN AC SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).  
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION ALL THE WAY TO 0 OR 100% MODULATION, 
* WHICH IS NOT POSSIBLE WITH THE HARDWARE.
* 
* THE ILIM/SHDN FUNCTION IS NOT MODELED.
*
*BEGIN MODEL SA12TOOL FOR PSPICE.
*PINS CLKIN CLKOUT +PWM -PWM GND ILIM/SDN ISENB BOUT VS VCC AOUT ISENA
*PINS   1      2     3    4   5      6      7     8   9  10  11    12
.SUBCKT SA12TOOL_AM 1 2 3 4 5 6 7 8 9 10 11 12
* R110 & C110 DUPLICATE HARDWARE
R110 3 127 50
C110 127 0 .001U
* SET UP HIGH, LOW AND P-P RAMP VALUES
E124 124 0 123 125 1 
V123 123 0 7 
V125 125 0 3 
* S123 & S125 LIMIT MODULATOR DRIVE TO 0/100%
S123 129 123 127 123 SM1 
S125 125 129 125 127 SM1 
R129 127 129 10K 
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)
* E119 SHOWS ONLY INTEGRATOR VOLTAGE OUTSIDE MODULATION RANGE
E119 128 0 129 127 -1 
R128 128 6 10 
R6 3 0 1meg 
* 130 SERIES PARTS ARE THE NON-INVERTING OUT, 140 ARE INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 130 0 129 125 1 
E140 140 0 123 129 1 
* E131 & E141 GENERATE OUTPUTS; V(MODULATE)*PWM GAIN [VS/VP-P]
E141 141 0 VALUE={V(140)*V(9)/V(124)} 
E131 131 0 VALUE={V(130)*V(9)/V(124)} 
* R132 & 142 SET ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R132 131 11 .305 
R142 141 8 .305 
* E132 & E142 SENSE OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 0 @ VOUT=0 AND 1 @ VOUT=VS
E132 135 0 VALUE={(V(131)-V(11))*V(130)/V(124)} 
E142 145 0 VALUE={(V(141)-V(8))*V(140)/V(124)}
* G135 & G145 REFLECT OUTPUT CURRENT INTO VSENSE PINS
G135 208 0 135 0 -3.2787
G145 212 0 145 0 -3.2787
V135 208 7 0 
V145 212 12 0 
* F135 & F145 REFLECT CURRENT INTO VS PIN
F135 9 0 V135 1 
F145 9 0 V145 1 
* 
R1 1 0 1meg 
R2 2 0 1meg 
R4 4 0 1meg 
R5 5 0 1meg 
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D130 11 9 D1M 
D131 0 11 D1M 
D140 8 9 D1M 
D141 0 8 D1M 
.MODEL D1M D (IS=2.832E-12 M=0.333 N=1.00 RS=0.043 VJ=0.75)
*
D120 127 10 D1N4148 
D121 0 127 D1N4148
.MODEL D1N4148  D(IS=0.1P RS=16 CJO=2P TT=12N BV=100 IBV=0.1P)  
.ENDS
*END OF MODEL SA12TOOL
**********
*       SA13 PWM MODEL FEATURES INCLUDE:
*
*   1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*   2 OUTPUT RESISTANCE AND CAPACITANCE
*   3 ACCURATE CATCH DIODE I V CHARACTERISTIC
*   4 ACCURATE RON TEMPERATURE COEFFICIENT
*   5 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*   6 DEADTIME BETWEEN SWITCH ON TIMES
*   7 ACCURATE IQ ON THE VCC LINE
*   8 REDUCTION IN IQ VCC IN SHUTDOWN
*   9 INTERNAL CMOS BUFFER ON THE CLK IN PIN
*  10 ILIM / SHUTDOWN FUNCTIONS
*
*     NOTE: THERMAL SHUTDOWN IS NOT MODELED
*     NOTE: HIGH SIDE CURRENT LIMIT IS NOT MODELED
*
*       SOME NOTES ON USING SPICE FOR PWM SIMULATION
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 100, INCREASE
*  RELTOL TO 0.003 TO 0.01, INCREASE ABSTOL TO 1E-11 TO
*  1E-9, INCREASE GMIN TO 1E-11 TO 1E-7, INCREASE VNTOL
*  TO 1E-5 TO 1E-4, OR INCREASE CHGTOL TO 1E-11 TO 1E-9.
*  ANY OR ALL OF THESE SIMULATOR OPTIONS MAY BE REQUIRED
*  DEPENDING ON YOUR SIMULATOR. NEWER SIMULATORS USUALLY
*  REQUIRE FEWER OF THEM.
*
*  TO AID THE INITIAL TRANSIENT CONVERGANCE, SET UP THE
*  INITIAL VALUE OF CLOCK IN AS FOLLOWS:
*        IF PWM IN > 5V, CLOCK IN INITIAL = 5 VOLTS
*        IF PWM IN < 5V, CLOCK IN INITIAL = 0 VOLTS
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  THE CLOCK IS A GENERATOR STATEMENT INSIDE THE MODEL.
*  WHERE THE REAL PART HAS AN OSCILLATOR FOLLOWED BY A
*  DIGITAL DIVIDE BY TWO, THE MODEL HAS THE GENERATOR
*  AT HALF OF THE CLOCK FREQUENCY. IF YOU NEED TO SYNCH-
*  RONIZE THE PWM CLOCK TO AN EXTERNAL SOURCE, LOOK IN
*  YOUR SIMULATOR LIBRARY FOR A SIMPLE FAST RUNNING
*  BEHAVIORAL FREQUENCY DIVIDER OR DFLOP. BECAUSE THE
*  EXTENTIONS THAT ALLOW BEHAVIORAL MODELS VARY WIDELY
*  AMONG VENDORS NONE ARE INCLUDED HERE. AT THE BOTTOM
*  OF THIS LIBRARY FILE YOU WILL FIND A COMPONENT LEVEL
*  FREQUENCY DIVIDER SUBCIRCUIT (FDIV) WILL WORK WITH
*  ALL SIMULATORS. IT WORKS AT FIVE VOLTS (PROVIDE 5V
*  AND GROUND ON THE SUPPLIES OF FDIV) AND CAN PROVIDE
*  FREQUENCY DIVISION BY 2 TO GO BETWEEN YOUR EXTERNAL
*  SYNCH SIGNAL AND THE CLOCK INPUT OF THE PWM MODEL.
*  BECAUSE FDIV IS COMPONENT LEVEL IT IS SLOW AND WILL
*  EXTEND THE EXECUTION TIME BY AS MUCH AS 2 TO 1.
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM SIGNAL INPUT TO A FIXED VOLTAGE THAT IS EQUIVALENT
*  TO HALFWAY BETWEEN 50-50 DUTY FACTOR AND 100 PERCENT
*  DUTY FACTOR. RUN A SIMULATION THAT HAS TIME FOR OUTPUT
*  FILTER SETTLING. IF THE OUTPUT VOLTAGE WANDERS AROUND
*  RATHER THAN STAYS SETTLED TO LESS THAN ONE PERCENT YOU
*  SHOULD REDUCE THE TIMESTEP MAX (TMAX) PARAMETER IN THE
*  TRAN LINE. THIS IS THE FOURTH TIME PARAMETER ON THAT
*  LINE AND IS OPTIONAL LIKE THE TSTART PARAMETER (THIRD
*  TIME PARAMETER ON THAT LINE). IF YOU ARE NOT USING
*  TSTART YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL
*  RECOGNIZE TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY
*  SPICE 3 TMAX WILL USUALLY BE IN THE 500 TO 150 NS RANGE.
*  FOR PSPICE TMAX WILL USUALLY BE IN THE 250 TO 50 NS
*  RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, RAMP VCC AND VS UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST 10 MICROSECONDS OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES AND
*  CURRENTS FOR LATER SETTING OF NODESETS. LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*  BECAUSE THIS MODEL MUST BE CAPABLE OF RUNNING AT ANY
*  CLOCK RATE UP TO THE SPECIFICATION, THE MODEL MEASURES
*  THE CLOCK FREQUENCY AND FILTERS THE ANALOG RESULT AND
*  USES IT AS PART OF THE MODELING THAT CREATES THE
*  FREQUENCY DEPENDENT PART OF IQ(VSS). THE FILTER HAS A
*  TIME CONSTANT OF 300 USEC. DURING SHUTDOWN THE IQ(VSS)
*  IS SET TO A LOWER VALUE VIA THIS TIME CONSTANT AND
*  IQ(VCC) IS SET TO A LOWER VALUE WITH NO TIME CONSTANT.
*
*BEGIN MODEL SA13 FOR PSPICE
*PINOUT ORDER CKIN CKOUT +PWM -PWM SGND SHTDN PGND  OUT +VS VCC
*PINOUT         1    2     3    4    5    6     7    8   9   10
.SUBCKT SA13_AM 1 2 3 4 5 6 7 8 9 10
V7 44 5 0 PULSE 0 5 0 10N 10N 22.22U 44.44U
RE2 41 5 1E9
E1 14 5 23 4 1
D5 7 8 D1M
R13 27 5 10
R42 5 14 1E9
R39 67 63 10E3
C17 63 5 28E-12
R46 27 13 10E3
C18 13 5 28E-12
R1 40 8 R1M 0.09
R3 64 7 R1M 0.09
D4 13 27 D2M
D8 63 67 D2M
R14 32 23 1E3
R37 23 27 143E9
E4 32 5 68 5 1
E3 5 31 41 27 -1
R43 44 2 100
C22 2 5 10E-12
V2 41 5 4.5
D1 8 9 D1M
E9 16 5 65 25 1000
V9 28 5 0.1
C4 9 34 350E-12
C6 8 35 350E-12
R10 34 8 0.47
R12 35 7 0.47
S5 61 27 14 5 S5M
C19 66 5 1000E-12
C20 29 5 2000E-12
R15 26 29 10
E13 43 5 42 38 1
R16 43 30 300
C21 30 5 1E-6
R45 30 5 1E9
C10 65 5 1000E-12
R21 65 6 1E3
D2 46 47 DN
D3 48 46 DN
R22 46 16 1E3
V10 48 5 0.8
V11 47 0 4.1
R23 28 25 1E3
R24 57 25 1E6
R25 57 50 1E3
R26 59 50 1E3
R27 52 25 100E3
R19 60 5 1
C8 57 52 5E-12
V13 56 5 5
V8 22 5 2.5
Q1 57 53 5 QFN
Q2 57 54 5 QFN
Q3 59 55 5 QFN
Q4 59 51 5 QFN
R28 53 46 50E3
R29 54 59 50E3
R30 55 49 50E3
R31 51 57 50E3
C9 53 5 1E-12
C11 51 5 1E-12
C12 55 5 1E-12
C13 54 5 1E-12
R33 58 4 55E3
C15 4 5 470E-12
M1 49 62 5 5 M1M
M2 49 62 50 50 M2M
R34 62 1 50
C16 62 5 5E-12
E10 58 5 49 0 2
V12 50 5 5
R35 61 5 1E9
S7 26 42 22 13 S7M
S8 26 60 13 22 S7M
R36 68 5 10E6
R38 38 42 1
V4 38 5 10
G1 5 10 30 5 0.36
R40 10 69 500
S10 69 5 57 5 S1M
I2 10 5 0.05
GQ1 5 9 VALUE = {(-0.025)*((0.13+(V(9)/69))*(0.28+V(30)*(-1600)))}
R49 65 5 10E6
R51 66 68 50
R52 3 66 50
R53 67 5 10
VD1 9 71 0
VD3 8 73 0
S1 71 40 63 5 S1M
S3 73 64 13 5 S1M
S6 67 31 57 5 S6M
S9 56 61 57 5 S1M
.MODEL R1M RES (TC1=7.374E-3 TC2=2.598E-5)
.MODEL QFN NPN (BF=100 NE=1.5 EG=1.11
+ IS=1.5E-15 NC=1.7 FC=0.5 CJC=1E-12)
.MODEL M1M NMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=2.25)
.MODEL M2M PMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=-2.25)
.MODEL S1M VSWITCH RON=0.01 ROFF=1E6 VON=2.55 VOFF=2.0
.MODEL S5M VSWITCH RON=1 ROFF=1E3 VON=0.001 VOFF=0
.MODEL S6M VSWITCH RON=0.1 ROFF=1E4 VON=2.91 VOFF=2.5
.MODEL S7M VSWITCH RON=1 ROFF=1E5 VON=0.1 VOFF=0
.MODEL D1M D (IS=6.365E-12 M=0.333 N=1.00 RS=0.02685 VJ=0.75)
.MODEL D2M D (IS=1.68E-08 M=0.333 N=1.89 RS=0.452 VJ=0.75)
.MODEL DN D (BV=100 CJO=4E-12 IS=7E-09 M=0.45 N=2 RS=0.8 TT=6E-9 VJ=0.6)
.ENDS
*END OF MODEL SA13
*************
*     SA13TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUTS
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 6 PIN NUMBERS CORRESPOND TO THE HARDWARE
* 7 A FLAG OUTPUT SHOWS INPUT VOLTAGE OUTSIDE THE MODULATION RANGE
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN AC SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).  
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION ALL THE WAY TO 0 OR 100% MODULATION, 
* WHICH IS NOT POSSIBLE WITH THE HARDWARE.
* 
* THE ILIM/SHDN FUNCTION IS NOT MODELED.
*
*BEGIN MODEL SA13TOOL FOR PSPICE.
*PINS CLKIN CLKOUT +PWM -PWM SIGGND SHDN PWRGND OUT VS VCC 
*PINS   1      2     3    4     5     6     7    8   9  10  
.SUBCKT SA13TOOL_AM 1 2 3 4 5 6 7 8 9 10 
* R110 & C110 DUPLICATE HARDWARE
R110 3 127 50
C110 127 0 .01U
* SET UP HIGH, LOW AND P-P RAMP VALUES
E124 124 0 123 125 1 
V123 123 0 7 
V125 125 0 3 
* S123 & S125 LIMIT MODULATOR DRIVE TO 0/100%
S123 129 123 127 123 SM1 
S125 125 129 125 127 SM1 
R129 127 129 10K 
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)
* E119 SHOWS ONLY INTEGRATOR VOLTAGE OUTSIDE MODULATION RANGE
E119 128 0 129 127 -1 
R128 128 6 10 
R6 3 0 1meg 
* 130 SERIES PARTS ARE THE NON-INVERTING OUT, 140 ARE INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 130 0 129 125 1 
E140 140 0 123 129 1 
* E141 GENERATES OUTPUT; V(MODULATE)*PWM GAIN [VS/VP-P]
E141 141 0 VALUE={V(140)*V(9)/V(124)} 
* R142 SETS ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R142 141 8 .114 
* E142 SENSES OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 1 @ VOUT=0 AND 0 @ VOUT=VS
E142 145 0 VALUE={(V(141)-V(8))*V(130)/V(124)} 
* G145 REFLECTS OUTPUT CURRENT INTO VSENSE PINS
G145 212 0 145 0 8.772
V145 212 7 0 
* F145 REFLECTS CURRENT INTO VS PIN
F145 9 0 V145 -1 
* 
R1 1 0 1meg 
R2 2 0 1meg 
R4 4 0 1meg 
R5 5 0 1meg 
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D140 8 9 D1M 
D141 0 8 D1M 
.MODEL D1M D (IS=2.832E-12 M=0.333 N=1.00 RS=0.043 VJ=0.75)
*
D120 127 10 D1N4148 
D121 0 127 D1N4148
.MODEL D1N4148  D(IS=0.1P RS=16 CJO=2P TT=12N BV=100 IBV=0.1P)  
.ENDS
*END OF MODEL SA13TOOL
**********
*       SA14 PWM MODEL FEATURES INCLUDE:
*
*   1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*   2 OUTPUT RESISTANCE AND CAPACITANCE
*   3 ACCURATE CATCH DIODE I V CHARACTERISTIC
*   4 ACCURATE RON TEMPERATURE COEFFICIENT
*   5 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*   6 DEADTIME BETWEEN SWITCH ON TIMES
*   7 ACCURATE IQ ON THE VCC LINE
*   8 REDUCTION IN IQ VCC IN SHUTDOWN
*   9 INTERNAL CMOS BUFFER ON THE CLK IN PIN
*  10 ILIM / SHUTDOWN FUNCTIONS
*
*     NOTE: THERMAL SHUTDOWN IS NOT MODELED
*     NOTE: HIGH SIDE CURRENT LIMIT IS NOT MODELED
*
*       SOME NOTES ON USING SPICE FOR PWM SIMULATION
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 100, INCREASE
*  RELTOL TO 0.003 TO 0.01, INCREASE ABSTOL TO 1E-11 TO
*  1E-9, INCREASE GMIN TO 1E-11 TO 1E-7, INCREASE VNTOL
*  TO 1E-5 TO 1E-4, OR INCREASE CHGTOL TO 1E-11 TO 1E-9.
*  ANY OR ALL OF THESE SIMULATOR OPTIONS MAY BE REQUIRED
*  DEPENDING ON YOUR SIMULATOR. NEWER SIMULATORS USUALLY
*  REQUIRE FEWER OF THEM.
*
*  TO AID THE INITIAL TRANSIENT CONVERGANCE, SET UP THE
*  INITIAL VALUE OF CLOCK IN AS FOLLOWS:
*        IF PWM IN > 5V, CLOCK IN INITIAL = 5 VOLTS
*        IF PWM IN < 5V, CLOCK IN INITIAL = 0 VOLTS
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  THE CLOCK IS A GENERATOR STATEMENT INSIDE THE MODEL.
*  WHERE THE REAL PART HAS AN OSCILLATOR FOLLOWED BY A
*  DIGITAL DIVIDE BY TWO, THE MODEL HAS THE GENERATOR
*  AT HALF OF THE CLOCK FREQUENCY. IF YOU NEED TO SYNCH-
*  RONIZE THE PWM CLOCK TO AN EXTERNAL SOURCE, LOOK IN
*  YOUR SIMULATOR LIBRARY FOR A SIMPLE FAST RUNNING
*  BEHAVIORAL FREQUENCY DIVIDER OR DFLOP. BECAUSE THE
*  EXTENTIONS THAT ALLOW BEHAVIORAL MODELS VARY WIDELY
*  AMONG VENDORS NONE ARE INCLUDED HERE. AT THE BOTTOM
*  OF THIS LIBRARY FILE YOU WILL FIND A COMPONENT LEVEL
*  FREQUENCY DIVIDER SUBCIRCUIT (FDIV) WILL WORK WITH
*  ALL SIMULATORS. IT WORKS AT FIVE VOLTS (PROVIDE 5V
*  AND GROUND ON THE SUPPLIES OF FDIV) AND CAN PROVIDE
*  FREQUENCY DIVISION BY 2 TO GO BETWEEN YOUR EXTERNAL
*  SYNCH SIGNAL AND THE CLOCK INPUT OF THE PWM MODEL.
*  BECAUSE FDIV IS COMPONENT LEVEL IT IS SLOW AND WILL
*  EXTEND THE EXECUTION TIME BY AS MUCH AS 2 TO 1.
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM SIGNAL INPUT TO A FIXED VOLTAGE THAT IS EQUIVALENT
*  TO HALFWAY BETWEEN 50-50 DUTY FACTOR AND 100 PERCENT
*  DUTY FACTOR. RUN A SIMULATION THAT HAS TIME FOR OUTPUT
*  FILTER SETTLING. IF THE OUTPUT VOLTAGE WANDERS AROUND
*  RATHER THAN STAYS SETTLED TO LESS THAN ONE PERCENT YOU
*  SHOULD REDUCE THE TIMESTEP MAX (TMAX) PARAMETER IN THE
*  TRAN LINE. THIS IS THE FOURTH TIME PARAMETER ON THAT
*  LINE AND IS OPTIONAL LIKE THE TSTART PARAMETER (THIRD
*  TIME PARAMETER ON THAT LINE). IF YOU ARE NOT USING
*  TSTART YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL
*  RECOGNIZE TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY
*  SPICE 3 TMAX WILL USUALLY BE IN THE 500 TO 150 NS RANGE.
*  FOR PSPICE TMAX WILL USUALLY BE IN THE 250 TO 50 NS
*  RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, RAMP VCC AND VS UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST 10 MICROSECONDS OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES AND
*  CURRENTS FOR LATER SETTING OF NODESETS. LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*  BECAUSE THIS MODEL MUST BE CAPABLE OF RUNNING AT ANY
*  CLOCK RATE UP TO THE SPECIFICATION, THE MODEL MEASURES
*  THE CLOCK FREQUENCY AND FILTERS THE ANALOG RESULT AND
*  USES IT AS PART OF THE MODELING THAT CREATES THE
*  FREQUENCY DEPENDENT PART OF IQ(VSS). THE FILTER HAS A
*  TIME CONSTANT OF 300 USEC. DURING SHUTDOWN THE IQ(VSS)
*  IS SET TO A LOWER VALUE VIA THIS TIME CONSTANT AND
*  IQ(VCC) IS SET TO A LOWER VALUE WITH NO TIME CONSTANT.
*
*BEGIN MODEL SA14 FOR PSPICE
*PINOUT ORDER CKIN CKOUT +PWM -PWM SGND SHTDN PGND  OUT +VS VCC
*PINOUT         1    2     3    4    5    6     7    8   9   10
.SUBCKT SA14_AM 1 2 3 4 5 6 7 8 9 10
V7 44 5 0 PULSE 0 5 0 10N 10N 22.22U 44.44U
RE2 41 5 1E9
E1 14 5 23 4 1
D5 7 8 D1M
R13 27 5 10
R42 5 14 1E9
R39 67 63 10E3
C17 63 5 28E-12
R46 27 13 10E3
C18 13 5 28E-12
R1 40 8 R1M 0.121
R3 64 7 R1M 0.121
D4 13 27 D2M
D8 63 67 D2M
R14 32 23 1E3
R37 23 27 143E9
E4 32 5 68 5 1
E3 5 31 41 27 -1
R43 44 2 100
C22 2 5 10E-12
V2 41 5 4.5
D1 8 9 D1M
E9 16 5 65 25 1000
V9 28 5 0.1
C4 9 34 220E-12
C6 8 35 220E-12
R10 34 8 0.70
R12 35 7 0.70
S5 61 27 14 5 S5M
C19 66 5 1000E-12
C20 29 5 2000E-12
R15 26 29 10
E13 43 5 42 38 1
R16 43 30 300
C21 30 5 1E-6
R45 30 5 1E9
C10 65 5 1000E-12
R21 65 6 1E3
D2 46 47 DN
D3 48 46 DN
R22 46 16 1E3
V10 48 5 0.8
V11 47 0 4.1
R23 28 25 1E3
R24 57 25 1E6
R25 57 50 1E3
R26 59 50 1E3
R27 52 25 100E3
R19 60 5 1
C8 57 52 5E-12
V13 56 5 5
V8 22 5 2.5
Q1 57 53 5 QFN
Q2 57 54 5 QFN
Q3 59 55 5 QFN
Q4 59 51 5 QFN
R28 53 46 50E3
R29 54 59 50E3
R30 55 49 50E3
R31 51 57 50E3
C9 53 5 1E-12
C11 51 5 1E-12
C12 55 5 1E-12
C13 54 5 1E-12
R33 58 4 55E3
C15 4 5 470E-12
M1 49 62 5 5 M1M
M2 49 62 50 50 M2M
R34 62 1 50
C16 62 5 5E-12
E10 58 5 49 0 2
V12 50 5 5
R35 61 5 1E9
S7 26 42 22 13 S7M
S8 26 60 13 22 S7M
R36 68 5 10E6
R38 38 42 1
V4 38 5 10
G1 5 10 30 5 0.36
R40 10 69 500
S10 69 5 57 5 S1M
I2 10 5 0.05
GQ1 5 9 VALUE = {(-0.025)*((0.29+(V(9)/175))*(0.1+V(30)*(-2000)))}
R49 65 5 10E6
R51 66 68 50
R52 3 66 50
R53 67 5 10
VD1 9 71 0
VD3 8 73 0
S1 71 40 63 5 S1M
S3 73 64 13 5 S1M
S6 67 31 57 5 S6M
S9 56 61 57 5 S1M
.MODEL R1M RES (TC1=7.374E-3 TC2=2.598E-5)
.MODEL QFN NPN (BF=100 NE=1.5 EG=1.11
+ IS=1.5E-15 NC=1.7 FC=0.5 CJC=1E-12)
.MODEL M1M NMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=2.25)
.MODEL M2M PMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=-2.25)
.MODEL S1M VSWITCH RON=0.01 ROFF=1E6 VON=2.55 VOFF=2.0
.MODEL S5M VSWITCH RON=1 ROFF=1E3 VON=0.001 VOFF=0
.MODEL S6M VSWITCH RON=0.1 ROFF=1E4 VON=2.91 VOFF=2.5
.MODEL S7M VSWITCH RON=1 ROFF=1E5 VON=0.1 VOFF=0
.MODEL D1M D (IS=5.414E-12 M=0.333 N=1.00 RS=0.0348 VJ=0.75)
.MODEL D2M D (IS=1.68E-08 M=0.333 N=1.89 RS=0.452 VJ=0.75)
.MODEL DN D (BV=100 CJO=4E-12 IS=7E-09 M=0.45 N=2 RS=0.8 TT=6E-9 VJ=0.6)
.ENDS
*END OF MODEL SA14
*************
*     SA14TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUTS
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 6 PIN NUMBERS CORRESPOND TO THE HARDWARE
* 7 A FLAG OUTPUT SHOWS INPUT VOLTAGE OUTSIDE THE MODULATION RANGE
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN AC SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).  
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION ALL THE WAY TO 0 OR 100% MODULATION, 
* WHICH IS NOT POSSIBLE WITH THE HARDWARE.
* 
* THE ILIM/SHDN FUNCTION IS NOT MODELED.
*
*BEGIN MODEL SA14TOOL FOR PSPICE.
*PINS CLKIN CLKOUT +PWM -PWM SIGGND SHDN PWRGND OUT VS VCC 
*PINS   1      2     3    4     5     6     7    8   9  10  
.SUBCKT SA14TOOL_AM 1 2 3 4 5 6 7 8 9 10 
* R110 & C110 DUPLICATE HARDWARE
R110 3 127 50
C110 127 0 .01U
* SET UP HIGH, LOW AND P-P RAMP VALUES
E124 124 0 123 125 1 
V123 123 0 7 
V125 125 0 3 
* S123 & S125 LIMIT MODULATOR DRIVE TO 0/100%
S123 129 123 127 123 SM1 
S125 125 129 125 127 SM1 
R129 127 129 10K 
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)
* E119 SHOWS ONLY INTEGRATOR VOLTAGE OUTSIDE MODULATION RANGE
E119 128 0 129 127 -1 
R128 128 6 10 
R6 3 0 1meg 
* 130 SERIES PARTS ARE THE NON-INVERTING OUT, 140 ARE INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 130 0 129 125 1 
E140 140 0 123 129 1 
* E141 GENERATES OUTPUT; V(MODULATE)*PWM GAIN [VS/VP-P]
E141 141 0 VALUE={V(140)*V(9)/V(124)} 
* R142 SETS ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R142 141 8 .16 
* E142 SENSES OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 1 @ VOUT=0 AND 0 @ VOUT=VS
E142 145 0 VALUE={(V(141)-V(8))*V(130)/V(124)} 
* G145 REFLECTS OUTPUT CURRENT INTO VSENSE PINS
G145 212 0 145 0 6.25 
V145 212 7 0 
* F145 REFLECTS CURRENT INTO VS PIN
F145 9 0 V145 -1 
* 
R1 1 0 1meg 
R2 2 0 1meg 
R4 4 0 1meg 
R5 5 0 1meg 
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D140 8 9 D1M 
D141 0 8 D1M 
.MODEL D1M D (IS=2.832E-12 M=0.333 N=1.00 RS=0.043 VJ=0.75)
*
D120 127 10 D1N4148 
D121 0 127 D1N4148
.MODEL D1N4148  D(IS=0.1P RS=16 CJO=2P TT=12N BV=100 IBV=0.1P)  
.ENDS
*END OF MODEL SA14TOOL
************
*       SA16 PWM MODEL FEATURES INCLUDE:
*
*   1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*   2 OUTPUT RESISTANCE AND CAPACITANCE
*   3 ACCURATE CATCH DIODE I V CHARACTERISTIC
*   4 ACCURATE RON TEMPERATURE COEFFICIENT
*   5 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*   6 DEADTIME BETWEEN SWITCH ON TIMES
*   7 ACCURATE IQ ON THE VCC LINE
*   8 REDUCTION IN IQ VCC IN SHUTDOWN
*   9 INTERNAL CMOS BUFFER ON THE CLK IN PIN
*  10 ILIM / SHUTDOWN FUNCTIONS
*
*     NOTE: THERMAL SHUTDOWN IS NOT MODELED
*     NOTE: HIGH SIDE CURRENT LIMIT IS NOT MODELED
*
*       SOME NOTES ON USING SPICE FOR PWM SIMULATION
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 100, INCREASE
*  RELTOL TO 0.003 TO 0.01, INCREASE ABSTOL TO 1E-11 TO
*  1E-9, INCREASE GMIN TO 1E-11 TO 1E-7, INCREASE VNTOL
*  TO 1E-5 TO 1E-4, OR INCREASE CHGTOL TO 1E-11 TO 1E-9.
*  ANY OR ALL OF THESE SIMULATOR OPTIONS MAY BE REQUIRED
*  DEPENDING ON YOUR SIMULATOR. NEWER SIMULATORS USUALLY
*  REQUIRE FEWER OF THEM.
*
*  TO AID THE INITIAL TRANSIENT CONVERGANCE, SET UP THE
*  INITIAL VALUE OF CLOCK IN AS FOLLOWS:
*        IF PWM IN > 5V, CLOCK IN INITIAL = 5 VOLTS
*        IF PWM IN < 5V, CLOCK IN INITIAL = 0 VOLTS
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  THE CLOCK IS A GENERATOR STATEMENT INSIDE THE MODEL.
*  WHERE THE REAL PART HAS AN OSCILLATOR FOLLOWED BY A
*  DIGITAL DIVIDE BY TWO, THE MODEL HAS THE GENERATOR
*  AT HALF OF THE CLOCK FREQUENCY. IF YOU NEED TO SYNCH-
*  RONIZE THE PWM CLOCK TO AN EXTERNAL SOURCE, LOOK IN
*  YOUR SIMULATOR LIBRARY FOR A SIMPLE FAST RUNNING
*  BEHAVIORAL FREQUENCY DIVIDER OR DFLOP. BECAUSE THE
*  EXTENTIONS THAT ALLOW BEHAVIORAL MODELS VARY WIDELY
*  AMONG VENDORS NONE ARE INCLUDED HERE. AT THE BOTTOM
*  OF THIS LIBRARY FILE YOU WILL FIND A COMPONENT LEVEL
*  FREQUENCY DIVIDER SUBCIRCUIT (FDIV) WILL WORK WITH
*  ALL SIMULATORS. IT WORKS AT FIVE VOLTS (PROVIDE 5V
*  AND GROUND ON THE SUPPLIES OF FDIV) AND CAN PROVIDE
*  FREQUENCY DIVISION BY 2 TO GO BETWEEN YOUR EXTERNAL
*  SYNCH SIGNAL AND THE CLOCK INPUT OF THE PWM MODEL.
*  BECAUSE FDIV IS COMPONENT LEVEL IT IS SLOW AND WILL
*  EXTEND THE EXECUTION TIME BY AS MUCH AS 2 TO 1.
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM SIGNAL INPUT TO A FIXED VOLTAGE THAT IS EQUIVALENT
*  TO HALFWAY BETWEEN 50-50 DUTY FACTOR AND 100 PERCENT
*  DUTY FACTOR. RUN A SIMULATION THAT HAS TIME FOR OUTPUT
*  FILTER SETTLING. IF THE OUTPUT VOLTAGE WANDERS AROUND
*  RATHER THAN STAYS SETTLED TO LESS THAN ONE PERCENT YOU
*  SHOULD REDUCE THE TIMESTEP MAX (TMAX) PARAMETER IN THE
*  TRAN LINE. THIS IS THE FOURTH TIME PARAMETER ON THAT
*  LINE AND IS OPTIONAL LIKE THE TSTART PARAMETER (THIRD
*  TIME PARAMETER ON THAT LINE). IF YOU ARE NOT USING
*  TSTART YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL
*  RECOGNIZE TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY
*  SPICE 3 TMAX WILL USUALLY BE IN THE 500 TO 150 NS RANGE.
*  FOR PSPICE TMAX WILL USUALLY BE IN THE 250 TO 50 NS
*  RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, RAMP VCC AND VS UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST 10 MICROSECONDS OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES AND
*  CURRENTS FOR LATER SETTING OF NODESETS. LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*  BECAUSE THIS MODEL MUST BE CAPABLE OF RUNNING AT ANY
*  CLOCK RATE UP TO THE SPECIFICATION, THE MODEL MEASURES
*  THE CLOCK FREQUENCY AND FILTERS THE ANALOG RESULT AND
*  USES IT AS PART OF THE MODELING THAT CREATES THE
*  FREQUENCY DEPENDENT PART OF IQ(VSS). THE FILTER HAS A
*  TIME CONSTANT OF 300 USEC. DURING SHUTDOWN THE IQ(VSS)
*  IS SET TO A LOWER VALUE VIA THIS TIME CONSTANT AND
*  IQ(VCC) IS SET TO A LOWER VALUE WITH NO TIME CONSTANT.
*
*BEGIN MODEL SA16 FOR PSPICE
*PINOUT ORDER CKIN CKOUT +PWM -PWM SGND SHTDN PGND  OUT +VS VCC
*PINOUT ORDER   1    2     3    4    5    6     7    8   9   10
.SUBCKT SA16_AM 1 2 3 4 5 6 7 8 9 10
V7 44 5 0 PULSE 0 5 0 10N 10N 22.22U 44.44U
RE2 41 5 1E9
E1 14 5 23 4 1
D5 7 8 D1M
R13 27 5 10
R42 5 14 1E9
R39 67 63 10E3
C17 63 5 28E-12
R46 27 13 10E3
C18 13 5 28E-12
R1 40 8 R1M 0.59
R3 64 7 R1M 0.59
D4 13 27 D2M
D8 63 67 D2M
R14 32 23 1E3
R37 23 27 143E9
E4 32 5 68 5 1
E3 5 31 41 27 -1
R43 44 2 100
C22 2 5 10E-12
V2 41 5 4.5
D1 8 9 D1M
E9 16 5 65 25 1000
V9 28 5 0.1
C4 9 34 120E-12
C6 8 35 120E-12
R10 34 8 1.4
R12 35 7 1.4
S5 61 27 14 5 S5M
C19 66 5 1000E-12
C20 29 5 2000E-12
R15 26 29 10
E13 43 5 42 38 1
R16 43 30 300
C21 30 5 1E-6
R45 30 5 1E9
C10 65 5 1000E-12
R21 65 6 1E3
D2 46 47 DN
D3 48 46 DN
R22 46 16 1E3
V10 48 5 0.8
V11 47 0 4.1
R23 28 25 1E3
R24 57 25 1E6
R25 57 50 1E3
R26 59 50 1E3
R27 52 25 100E3
R19 60 5 1
C8 57 52 5E-12
V13 56 5 5
V8 22 5 2.5
Q1 57 53 5 QFN
Q2 57 54 5 QFN
Q3 59 55 5 QFN
Q4 59 51 5 QFN
R28 53 46 50E3
R29 54 59 50E3
R30 55 49 50E3
R31 51 57 50E3
C9 53 5 1E-12
C11 51 5 1E-12
C12 55 5 1E-12
C13 54 5 1E-12
R33 58 4 55E3
C15 4 5 470E-12
M1 49 62 5 5 M1M
M2 49 62 50 50 M2M
R34 62 1 50
C16 62 5 5E-12
E10 58 5 49 0 2
V12 50 5 5
R35 61 5 1E9
S7 26 42 22 13 S7M
S8 26 60 13 22 S7M
R36 68 5 10E6
R38 38 42 1
V4 38 5 10
G1 5 10 30 5 0.36
R40 10 69 500
S10 69 5 57 5 S1M
I2 10 5 0.05
GQ1 5 9 VALUE = {(-0.045)*((0.55+(V(9)/625))*(0.1+V(30)*(-2000)))}
R49 65 5 10E6
R51 66 68 50
R52 3 66 50
R53 67 5 10
VD1 9 71 0
VD3 8 73 0
S1 71 40 63 5 S1M
S3 73 64 13 5 S1M
S6 67 31 57 5 S6M
S9 56 61 57 5 S1M
.MODEL R1M RES (TC1=7.374E-3 TC2=2.598E-5)
.MODEL QFN NPN (BF=100 NE=1.5 EG=1.11
+ IS=1.5E-15 NC=1.7 FC=0.5 CJC=1E-12)
.MODEL M1M NMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=2.25)
.MODEL M2M PMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=-2.25)
.MODEL S1M VSWITCH RON=0.01 ROFF=1E6 VON=2.55 VOFF=2.0
.MODEL S5M VSWITCH RON=1 ROFF=1E3 VON=0.001 VOFF=0
.MODEL S6M VSWITCH RON=0.1 ROFF=1E4 VON=2.91 VOFF=2.5
.MODEL S7M VSWITCH RON=1 ROFF=1E5 VON=0.1 VOFF=0
.MODEL D1M D (IS=4.118E-12 M=0.333 N=1.00 RS=0.0608 VJ=0.75)
.MODEL D2M D (IS=1.68E-08 M=0.333 N=1.89 RS=0.452 VJ=0.75)
.MODEL DN D (BV=100 CJO=4E-12 IS=7E-09 M=0.45 N=2 RS=0.8 TT=6E-9 VJ=0.6)
.ENDS
*END OF MODEL SA16
*************
*     SA16TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUTS
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 6 PIN NUMBERS CORRESPOND TO THE HARDWARE
* 7 A FLAG OUTPUT SHOWS INPUT VOLTAGE OUTSIDE THE MODULATION RANGE
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN AC SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).  
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION ALL THE WAY TO 0 OR 100% MODULATION, 
* WHICH IS NOT POSSIBLE WITH THE HARDWARE.
* 
* THE ILIM/SHDN FUNCTION IS NOT MODELED.
*
*BEGIN MODEL SA16TOOL FOR PSPICE.
*PINS CLKIN CLKOUT +PWM -PWM SIGGND SHDN PWRGND OUT VS VCC 
*PINS   1      2     3    4     5     6     7    8   9  10  
.SUBCKT SA16TOOL_AM 1 2 3 4 5 6 7 8 9 10 
* R110 & C110 DUPLICATE HARDWARE
R110 3 127 50
C110 127 0 .01U
* SET UP HIGH, LOW AND P-P RAMP VALUES
E124 124 0 123 125 1 
V123 123 0 7 
V125 125 0 3 
* S123 & S125 LIMIT MODULATOR DRIVE TO 0/100%
S123 129 123 127 123 SM1 
S125 125 129 125 127 SM1 
R129 127 129 10K 
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)
* E119 SHOWS ONLY INTEGRATOR VOLTAGE OUTSIDE MODULATION RANGE
E119 128 0 129 127 -1 
R128 128 6 10 
R6 3 0 1meg 
* 130 SERIES PARTS ARE THE NON-INVERTING OUT, 140 ARE INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 130 0 129 125 1 
E140 140 0 123 129 1 
* E141 GENERATES OUTPUT; V(MODULATE)*PWM GAIN [VS/VP-P]
E141 141 0 VALUE={V(140)*V(9)/V(124)} 
* R142 SETS ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R142 141 8 .735
* E142 SENSES OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 1 @ VOUT=0 AND 0 @ VOUT=VS
E142 145 0 VALUE={(V(141)-V(8))*V(130)/V(124)} 
* G145 REFLECTS OUTPUT CURRENT INTO VSENSE PINS
G145 212 0 145 0 1.361
V145 212 7 0 
* F145 REFLECTS CURRENT INTO VS PIN
F145 9 0 V145 -1 
* 
R1 1 0 1meg 
R2 2 0 1meg 
R4 4 0 1meg 
R5 5 0 1meg 
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D140 8 9 D1M 
D141 0 8 D1M 
.MODEL D1M D (IS=2.832E-12 M=0.333 N=1.00 RS=0.043 VJ=0.75)
*
D120 127 10 D1N4148 
D121 0 127 D1N4148
.MODEL D1N4148  D(IS=0.1P RS=16 CJO=2P TT=12N BV=100 IBV=0.1P)  
.ENDS
*END OF MODEL SA16TOOL
**********
*       SA18 PWM MODEL FEATURES INCLUDE:
*
*   1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*   2 OUTPUT RESISTANCE AND CAPACITANCE
*   3 ACCURATE CATCH DIODE I V CHARACTERISTIC
*   4 ACCURATE RON AND VON
*   5 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*   6 DEADTIME BETWEEN SWITCH ON TIMES
*   7 ACCURATE IQ ON THE VCC LINE
*   8 REDUCTION IN IQ VCC IN SHUTDOWN
*   9 INTERNAL CMOS BUFFER ON THE CLK IN PIN
*  10 ILIM / SHUTDOWN FUNCTIONS
*
*     NOTE: THERMAL SHUTDOWN IS NOT MODELED
*     NOTE: HIGH SIDE CURRENT LIMIT IS NOT MODELED
*
*       SOME NOTES ON USING SPICE FOR PWM SIMULATION
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 100, INCREASE
*  RELTOL TO 0.003 TO 0.01, INCREASE ABSTOL TO 1E-11 TO
*  1E-9, INCREASE GMIN TO 1E-11 TO 1E-7, INCREASE VNTOL
*  TO 1E-5 TO 1E-4, OR INCREASE CHGTOL TO 1E-11 TO 1E-9.
*  ANY OR ALL OF THESE SIMULATOR OPTIONS MAY BE REQUIRED
*  DEPENDING ON YOUR SIMULATOR. NEWER SIMULATORS USUALLY
*  REQUIRE FEWER OF THEM.
*
*  TO AID THE INITIAL TRANSIENT CONVERGANCE, SET UP THE
*  INITIAL VALUE OF CLOCK IN AS FOLLOWS:
*        IF PWM IN > 5V, CLOCK IN INITIAL = 5 VOLTS
*        IF PWM IN < 5V, CLOCK IN INITIAL = 0 VOLTS
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  THE CLOCK IS A GENERATOR STATEMENT INSIDE THE MODEL.
*  WHERE THE REAL PART HAS AN OSCILLATOR FOLLOWED BY A
*  DIGITAL DIVIDE BY TWO, THE MODEL HAS THE GENERATOR
*  AT HALF OF THE CLOCK FREQUENCY. IF YOU NEED TO SYNCH-
*  RONIZE THE PWM CLOCK TO AN EXTERNAL SOURCE, LOOK IN
*  YOUR SIMULATOR LIBRARY FOR A SIMPLE FAST RUNNING
*  BEHAVIORAL FREQUENCY DIVIDER OR DFLOP. BECAUSE THE
*  EXTENTIONS THAT ALLOW BEHAVIORAL MODELS VARY WIDELY
*  AMONG VENDORS NONE ARE INCLUDED HERE. AT THE BOTTOM
*  OF THIS LIBRARY FILE YOU WILL FIND A COMPONENT LEVEL
*  FREQUENCY DIVIDER SUBCIRCUIT (FDIV) WILL WORK WITH
*  ALL SIMULATORS. IT WORKS AT FIVE VOLTS (PROVIDE 5V
*  AND GROUND ON THE SUPPLIES OF FDIV) AND CAN PROVIDE
*  FREQUENCY DIVISION BY 2 TO GO BETWEEN YOUR EXTERNAL
*  SYNCH SIGNAL AND THE CLOCK INPUT OF THE PWM MODEL.
*  BECAUSE FDIV IS COMPONENT LEVEL IT IS SLOW AND WILL
*  EXTEND THE EXECUTION TIME BY AS MUCH AS 2 TO 1.
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM SIGNAL INPUT TO A FIXED VOLTAGE THAT IS EQUIVALENT
*  TO HALFWAY BETWEEN 50-50 DUTY FACTOR AND 100 PERCENT
*  DUTY FACTOR. RUN A SIMULATION THAT HAS TIME FOR OUTPUT
*  FILTER SETTLING. IF THE OUTPUT VOLTAGE WANDERS AROUND
*  RATHER THAN STAYS SETTLED TO LESS THAN ONE PERCENT YOU
*  SHOULD REDUCE THE TIMESTEP MAX (TMAX) PARAMETER IN THE
*  TRAN LINE. THIS IS THE FOURTH TIME PARAMETER ON THAT
*  LINE AND IS OPTIONAL LIKE THE TSTART PARAMETER (THIRD
*  TIME PARAMETER ON THAT LINE). IF YOU ARE NOT USING
*  TSTART YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL
*  RECOGNIZE TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY
*  SPICE 3 TMAX WILL USUALLY BE IN THE 500 TO 150 NS RANGE.
*  FOR PSPICE TMAX WILL USUALLY BE IN THE 250 TO 50 NS
*  RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, RAMP VCC AND VS UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST 10 MICROSECONDS OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES AND
*  CURRENTS FOR LATER SETTING OF NODESETS. LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*  BECAUSE THIS MODEL MUST BE CAPABLE OF RUNNING AT ANY
*  CLOCK RATE UP TO THE SPECIFICATION, THE MODEL MEASURES
*  THE CLOCK FREQUENCY AND FILTERS THE ANALOG RESULT AND
*  USES IT AS PART OF THE MODELING THAT CREATES THE
*  FREQUENCY DEPENDENT PART OF IQ(VSS). THE FILTER HAS A
*  TIME CONSTANT OF 300 USEC. DURING SHUTDOWN THE IQ(VSS)
*  IS SET TO A LOWER VALUE VIA THIS TIME CONSTANT AND
*  IQ(VCC) IS SET TO A LOWER VALUE WITH NO TIME CONSTANT.
*
*BEGIN MODEL SA18 FOR PSPICE
*PINOUT ORDER CKIN CKOUT PWM SGND SHTDN PGND  OUT +VS VCC
*PINOUT         1    2    3    5    6     7    8   9   10
.SUBCKT SA18_AM 1 2 3 5 6 7 8 9 10
V7 44 5 0 PULSE 0 5 0 10N 10N 22.22U 44.44U
RE2 41 5 1E9
E1 14 5 23 15 1
D5 7 8 D1M
R13 27 5 10
R42 5 14 1E9
R39 67 63 10E3
C17 63 5 28E-12
R46 27 13 10E3
C18 13 5 28E-12
R1 40 8 0.085
R3 64 7 0.085
D4 13 27 D2M
D8 63 67 D2M
R14 32 23 1E3
R37 23 27 143E9
E4 32 5 68 5 1
E3 5 31 41 27 -1
R43 44 2 100
C22 2 5 10E-12
V2 41 5 4.5
D1 8 9 D1M
E9 16 5 65 25 1000
V9 28 5 0.1
C4 9 34 300E-12
C6 8 35 300E-12
R10 34 8 0.7
R12 35 7 0.7
S5 61 27 14 5 S5M
C19 66 5 1000E-12
C20 29 5 2000E-12
R15 26 29 10
E13 43 5 42 38 1
R16 43 30 300
C21 30 5 1E-6
R45 30 5 1E9
C10 65 5 1000E-12
R21 65 6 1E3
D2 46 47 DN
D3 48 46 DN
R22 46 16 1E3
V10 48 5 0.8
V11 47 0 4.1
R23 28 25 1E3
R24 57 25 1E6
R25 57 50 1E3
R26 59 50 1E3
R27 52 25 100E3
R19 60 5 1
C8 57 52 5E-12
V13 56 5 5
V8 22 5 2.5
Q1 57 53 5 QFN
Q2 57 54 5 QFN
Q3 59 55 5 QFN
Q4 59 51 5 QFN
R28 53 46 50E3
R29 54 59 50E3
R30 55 49 50E3
R31 51 57 50E3
C9 53 5 1E-12
C11 51 5 1E-12
C12 55 5 1E-12
C13 54 5 1E-12
R33 58 15 55E3
C15 15 5 470E-12
M1 49 62 5 5 M1M
M2 49 62 50 50 M2M
R34 62 1 50
C16 62 5 5E-12
E10 58 5 49 0 2
V12 50 5 5
R35 61 5 1E9
S7 26 42 22 13 S7M
S8 26 60 13 22 S7M
R36 68 5 10E6
R38 38 42 1
V4 38 5 10
G1 5 10 30 5 0.36
R40 10 69 500
S10 69 5 57 5 S1M
I2 10 5 0.05
GQ1 5 9 VALUE = {(-0.045)*((0.6+(V(9)/600))*(0.45+V(30)*(-1000)))}
R49 65 5 10E6
R51 66 68 50
R52 3 66 50
R53 67 5 10
VD1 9 71 0.85
VD3 8 73 0.85
S1 71 40 63 5 S1M
S3 73 64 13 5 S1M
S6 67 31 57 5 S6M
S9 56 61 57 5 S1M
.MODEL QFN NPN (BF=100 NE=1.5 EG=1.11
+ IS=1.5E-15 NC=1.7 FC=0.5 CJC=1E-12)
.MODEL M1M NMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=2.25)
.MODEL M2M PMOS (CBD=17E-12 CBS=17E-12 CGBO=26E-9
+ CGDO=18E-9 CGSO=20E-9 IS=31E-15 KP=4.3E-3 RD=50
+ RS=50 VTO=-2.25)
.MODEL S1M VSWITCH RON=0.01 ROFF=1E6 VON=2.55 VOFF=2.0
.MODEL S5M VSWITCH RON=1 ROFF=1E3 VON=0.001 VOFF=0
.MODEL S6M VSWITCH RON=0.1 ROFF=1E4 VON=2.91 VOFF=2.5
.MODEL S7M VSWITCH RON=1 ROFF=1E5 VON=0.1 VOFF=0
.MODEL D1M D (IS=2.645E-15 M=0.333 N=1.00 RS=0.086 VJ=0.75)
.MODEL D2M D (IS=1.68E-08 M=0.333 N=1.89 RS=0.452 VJ=0.75)
.MODEL DN D (BV=100 CJO=4E-12 IS=7E-09 M=0.45 N=2 RS=0.8 TT=6E-9 VJ=0.6)
.ENDS
*END OF MODEL SA18
*************
*     SA18TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUTS
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 6 PIN NUMBERS CORRESPOND TO THE HARDWARE
* 7 A FLAG OUTPUT SHOWS INPUT VOLTAGE OUTSIDE THE MODULATION RANGE
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN AC SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).  
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION ALL THE WAY TO 0 OR 100% MODULATION, 
* WHICH IS NOT POSSIBLE WITH THE HARDWARE.
* 
* THE ILIM/SHDN FUNCTION IS NOT MODELED.
*
*BEGIN MODEL SA18TOOL FOR PSPICE.
*PINS CLKIN CLKOUT +PWM SIGGND SHDN PWRGND OUT VS VCC 
*PINS   1      2     3     5     6     7    8   9  10  
.SUBCKT SA18TOOL_AM 1 2 3 5 6 7 8 9 10 
* R110 & C110 DUPLICATE HARDWARE
R110 3 127 50
C110 127 0 .01U
* SET UP HIGH, LOW AND P-P RAMP VALUES
E124 124 0 123 125 1 
V123 123 0 7 
V125 125 0 3 
* S123 & S125 LIMIT MODULATOR DRIVE TO 0/100%
S123 129 123 127 123 SM1 
S125 125 129 125 127 SM1 
R129 127 129 10K 
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)
* E119 SHOWS ONLY INTEGRATOR VOLTAGE OUTSIDE MODULATION RANGE
E119 128 0 129 127 -1 
R128 128 6 10 
R6 3 0 1meg 
* 130 SERIES PARTS ARE THE NON-INVERTING OUT, 140 ARE INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 130 0 129 125 1 
E140 140 0 123 129 1 
* E141 GENERATES OUTPUT; V(MODULATE)*PWM GAIN [VS/VP-P]
E141 141 0 VALUE={V(140)*V(9)/V(124)} 
* R142 SETS ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R142 141 8 .1375 
* E142 SENSES OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 1 @ VOUT=0 AND 0 @ VOUT=VS
E142 145 0 VALUE={(V(141)-V(8))*V(130)/V(124)} 
* G145 REFLECTS OUTPUT CURRENT INTO VSENSE PINS
G145 212 0 145 0 7.273
V145 212 7 0 
* F145 REFLECTS CURRENT INTO VS PIN
F145 9 0 V145 -1 
* 
R1 1 0 1meg 
R2 2 0 1meg 
R5 5 0 1meg 
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D140 8 9 D1M 
D141 0 8 D1M 
.MODEL D1M D (IS=2.832E-12 M=0.333 N=1.00 RS=0.043 VJ=0.75)
*
D120 127 10 D1N4148 
D121 0 127 D1N4148
.MODEL D1N4148  D(IS=0.1P RS=16 CJO=2P TT=12N BV=100 IBV=0.1P)  
.ENDS
*END OF MODEL SA18TOOL
**********
*       SA50 PWM MODEL FEATURES INCLUDE:
*
*  1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*  2 OUTPUT RESISTANCE AND CAPACITANCE
*  3 ACCURATE RON TEMPERATURE COEFFICIENT
*  4 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*  5 DEADTIME BETWEEN SWITCH ON TIMES
*  6 ACCURATE IQ ON THE VCC LINE
*
*
*       SOME NOTES ON USING SPICE FOR PWM SIMULATION
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 100, INCREASE
*  RELTOL TO 0.003 TO 0.01, INCREASE ABSTOL TO 1E-11 TO
*  1E-9, INCREASE GMIN TO 1E-11 TO 1E-7, INCREASE VNTOL
*  TO 1E-5 TO 1E-4, OR INCREASE CHGTOL TO 1E-11 TO 1E-9.
*  ANY OR ALL OF THESE SIMULATOR OPTIONS MAY BE REQUIRED
*  DEPENDING ON YOUR SIMULATOR. NEWER SIMULATORS USUALLY
*  REQUIRE FEWER OF THEM.
*
*  INITIAL CONVERGANCE CAN BE AFFECTED BY WHETHER THE
*  PWM INPUT IS ABOVE OR BELOW THE HALFWAY VOLTAGE.
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM SIGNAL INPUT TO A FIXED VOLTAGE THAT IS EQUIVALENT
*  TO HALFWAY BETWEEN 50-50 DUTY FACTOR AND 100 PERCENT
*  DUTY FACTOR. RUN A SIMULATION THAT HAS TIME FOR OUTPUT
*  FILTER SETTLING. IF THE OUTPUT VOLTAGE WANDERS AROUND
*  RATHER THAN STAYS SETTLED TO LESS THAN ONE PERCENT YOU
*  SHOULD REDUCE THE TIMESTEP MAX (TMAX) PARAMETER IN THE
*  TRAN LINE. THIS IS THE FOURTH TIME PARAMETER ON THAT
*  LINE AND IS OPTIONAL LIKE THE TSTART PARAMETER (THIRD
*  TIME PARAMETER ON THAT LINE). IF YOU ARE NOT USING
*  TSTART YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL
*  RECOGNIZE TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY
*  SPICE 3 TMAX WILL USUALLY BE IN THE 500 TO 150 NS RANGE.
*  FOR PSPICE TMAX WILL USUALLY BE IN THE 250 TO 50 NS
*  RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, RAMP VCC AND VS UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST 10 MICROSECONDS OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES AND
*  CURRENTS FOR LATER SETTING OF NODESETS. LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*BEGIN MODEL SA50 FOR PSPICE
*PINOUT ORDER IS RSB BOUT +VS AOUT RSA VCC GND IN
*PINOUT           1    2   3    4   5   6   7   8
.SUBCKT SA50_AM 1 2 3 4 5 6 7 8
V1 23 7 0 PULSE 0 1 100N 10N 10N 11.395U 22.222U
E1 14 7 15 24 1
RE2 26 7 1E9
E3 30 7 8 7 1
D5 5 4 D1M
S1 3 45 59 7 SM1
S2 3 9 22 7 SM1
S3 4 47 59 7 SM1
S4 2 21 22 7 SM1
R1 9 4 R1M 0.25
R2 45 2 R1M 0.25
R3 47 5 R1M 0.25
R4 21 1 R1M 0.25
S5 16 13 14 7 SM5
R25 29 7 1
S7 50 42 32 22 SM7
V2 31 7 10
S8 50 29 22 32 SM8
R13 23 7 1E9
R14 7 12 1E9
EQ1 48 7 VALUE = {V(12)*V(23)}
V8 32 7 2.5
R36 30 15 1E3
I1 3 7 0.011
D1 4 3 D1M
R5 48 24 51.575E3
D6 1 2 D1M
D7 2 3 D1M
I2 6 7 0.0026
C4 3 34 75E-12
C5 3 37 75E-12
C6 4 35 75E-12
C7 2 33 75E-12
C8 24 7 317.4E-12
R10 34 4 2.8
R12 35 5 2.8
R18 37 2 2.8
R20 33 1 2.8
R37 15 13 143E9
C15 8 7 10E-12
E2 7 28 26 13 -1
V11 26 7 4.5
D4 19 48 D4M
R15 19 24 981.427E3
R16 48 24 50E12
R39 28 59 10E3
Q1 8 25 12 QPU
C10 51 7 2000E-12
R27 50 51 10
I4 25 12 10E-9
R17 8 7 10E6
R19 13 7 10
R28 31 42 1
V13 16 7 5
E13 53 7 42 31 1
R29 53 54 300
C11 54 7 1E-6
G2 7 3 54 7 14
E14 12 7 6 7 1
R42 7 14 1E9
R30 3 7 6700
R31 6 7 1795
R45 54 7 1E9
C13 59 7 23.3E-12
R46 13 22 10E3
C14 22 7 23.3E-12
D2 22 13 D2M
R35 16 7 1E9
D3 59 28 D2M
.MODEL R1M RES (TC1=7.374E-3 TC2=2.598E-5)
.MODEL QPU PNP (BF=100 NE=1.5 EG=1.11
+ IS=1.5E-15 NC=1.7 FC=0.5 CJC=1E-12)
.MODEL SM1 VSWITCH RON=0.01 ROFF=1E6 VON=2.55 VOFF=2.0
.MODEL SM5 VSWITCH RON=1 ROFF=1E3 VON=0.001 VOFF=0
.MODEL SM7 VSWITCH RON=1 ROFF=1E5 VON=0.1 VOFF=0
.MODEL SM8 VSWITCH RON=1 ROFF=1E5 VON=0.1 VOFF=0
.MODEL D1M D (IS=4.5E-14 M=0.333 N=1.00 RS=0.112 VJ=0.75)
.MODEL D4M D (CJO=1E-12 IS=1.68E-08 M=0.333 N=1.89 RS=0.452 VJ=0.75)
.MODEL D2M D (IS=1.68E-08 M=0.333 N=1.89 RS=0.452 VJ=0.75)
.ENDS
*END OF MODEL SA50
*************
*     SA50TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUTS
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 6 PIN NUMBERS CORRESPOND TO THE HARDWARE
* 7 AN INTERNAL FLAG SHOWS INPUT VOLTAGE OUTSIDE THE MODULATION RANGE
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN AC SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).  
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION ALL THE WAY TO 0 OR 100% MODULATION, 
* WHICH IS NOT POSSIBLE WITH THE HARDWARE.
* 
*BEGIN MODEL SA50TOOL FOR PSPICE.
*PIN ORDER RSENB BOUT VS AOUT RSENSA VCC GND INPUT
*PINOUT      1     2   3   4     5    6   7    8 
.SUBCKT SA50TOOL_AM 1 2 3 4 5 6 7 8 
* DIVIDE VCC BY 3, FIND HIGH, LOW AND P-P RAMP VALUES
R120 6 101 1K 
R121 101 102 1K 
R122 102 0 1K 
E124 124 0 101 102 1 
E123 123 0 101 0 1 
E125 125 0 102 0 1 
* S123 & S125 LIMIT MODULATOR DRIVE TO 0/100%
S123 129 123 8 123 SM1 
S125 125 129 125 8 SM1 
R129 8 129 10K 
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)
* E119 SHOWS ONLY INTEGRATOR VOLTAGE OUTSIDE MODULATION RANGE
E119 128 0 129 8 -1 
* 130 SERIES PARTS ARE THE NON-INVERTING OUT, 140 ARE INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 130 0 129 125 1 
E140 140 0 123 129 1 
* E131 & E141 GENERATE OUTPUTS; V(MODULATE)*PWM GAIN [VS/VP-P]
E141 141 0 VALUE={V(140)*V(3)/V(124)} 
E131 131 0 VALUE={V(130)*V(3)/V(124)} 
* R132 & 142 SET ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R132 131 4 .387 
R142 141 2 .387 
* E132 & E142 SENSE OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 0 @ VOUT=0 AND 1 @ VOUT=VS
E132 135 0 VALUE={(V(131)-V(4))*V(130)/V(124)} 
E142 145 0 VALUE={(V(141)-V(2))*V(140)/V(124)} 
* G135 & G145 REFLECT OUTPUT CURRENT INTO VSENSE PINS
G135 201 0 135 0 -2.584
G145 205 0 145 0 -2.584
V135 201 1 0 
V145 205 5 0 
* F135 & F145 REFLECT CURRENT INTO VS PIN
F135 3 0 V135 1 
F145 3 0 V145 1 
* 
R7 7 0 1meg 
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D130 4 3 D1M 
D131 0 4 D1M 
D140 2 3 D1M 
D141 0 2 D1M 
.MODEL D1M D (IS=2.832E-12 M=0.333 N=1.00 RS=0.043 VJ=0.75)
*
D120 8 6 D1N4148 
D121 0 8 D1N4148
.MODEL D1N4148  D(IS=0.1P RS=16 CJO=2P TT=12N BV=100 IBV=0.1P)  
.ENDS
*END OF MODEL SA50TOOL
**********
*       SA51 PWM MODEL FEATURES INCLUDE:
*
*  1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*  2 OUTPUT RESISTANCE AND CAPACITANCE
*  3 ACCURATE RON TEMPERATURE COEFFICIENT
*  4 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*  5 DEADTIME BETWEEN SWITCH ON TIMES
*  6 ACCURATE IQ ON THE VCC LINE
*  7 DISABLE FUNCTION
*
*
*       SOME NOTES ON USING SPICE FOR PWM SIMULATION
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 100, INCREASE
*  RELTOL TO 0.003 TO 0.01, INCREASE ABSTOL TO 1E-11 TO
*  1E-9, INCREASE GMIN TO 1E-11 TO 1E-7, INCREASE VNTOL
*  TO 1E-5 TO 1E-4, OR INCREASE CHGTOL TO 1E-11 TO 1E-9.
*  ANY OR ALL OF THESE SIMULATOR OPTIONS MAY BE REQUIRED
*  DEPENDING ON YOUR SIMULATOR. NEWER SIMULATORS USUALLY
*  REQUIRE FEWER OF THEM.
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  TO AID TRANSIENT INITIAL CONVERGANCE, YOU MAY WANT
*  TO ADJUST THE INITIAL STATE OF THE INPUT.
*  NOTE THAT BOTH THE FOLLWING STATEMENTS GIVE THE
*  SAME DUTY FACTOR BUT HAVE OPPOSITE INITIAL VALUES.
*
*  VIN XX XX 0 PULSE 0 5 1U 50N 50N 1.5U 2U
*  VIN XX XX 5 PULSE 5 0 1U 50N 50N 0.5U 2U
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM CLOCK INPUT TO A 75 PERCENT DUTY FACTOR AND RUN
*  A SIMULATION THAT HAS TIME FOR OUTPUT FILTER SETTLING.
*  IF THE OUTPUT VOLTAGE WANDERS AROUND RATHER THAN STAY
*  SETTLED TO LESS THAN ONE PERCENT YOU SHOULD REDUCE
*  THE TIMESTEP MAX (TMAX) PARAMETER IN THE TRAN LINE.
*  THIS IS THE FOURTH TIME PARAMETER ON THAT LINE AND IS
*  OPTIONAL LIKE THE TSTART PARAMETER (THIRD TIME
*  PARAMETER ON THAT LINE). IF YOU ARE NOT USING TSTART
*  YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL RECOGNIZE
*  TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY SPICE 3
*  TMAX WILL USUALLY BE IN THE 500 TO 150 NS RANGE. FOR
*  PSPICE TMAX WILL USUALLY BE IN THE 250 TO 50 NS RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, RAMP VCC AND VS UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST 10 MICROSECONDS OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES AND
*  CURRENTS FOR LATER SETTING OF NODESETS. LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*BEGIN MODEL SA51 FOR PSPICE
*PINOUT ORDER IS +VS BOUT VCC DIS GND IN AOUT RSEN
*PINOUT           1    2   3   4   5   6   7    8
.SUBCKT SA51_AM 1 2 3 4 5 6 7 8
E1 14 5 15 30 1
RE2 26 5 1E9
D5 8 7 D1M
S1 1 27 59 5 S1M
S2 1 48 22 5 S1M
S3 7 47 59 5 S1M
S4 2 21 22 5 S1M
S5 19 13 14 5 S5M
R5 30 5 15E3
R1 48 7 R1M 0.25
R2 27 2 R1M 0.25
R3 47 8 R1M 0.25
R4 21 8 R1M 0.25
R25 29 5 1
S7 50 42 32 22 S7M
V2 31 5 10
S8 50 29 22 32 S7M
S9 56 19 45 5 S9M
G1 5 3 10 5 0.36
V14 49 5 5
S10 45 5 4 5 S10M
V8 32 5 2.5
R36 16 15 1E3
R15 24 30 105E3
D1 7 1 D1M
Q1 4 46 3 QPU
C8 30 5 0.01E-6
D6 8 2 D1M
D7 2 1 D1M
Q2 6 25 24 QPU
I2 25 24 10E-9
C4 1 34 75E-12
C5 1 37 75E-12
C6 7 35 75E-12
C7 2 33 75E-12
R16 6 23 3E3
R10 34 7 2.8
R12 35 8 2.8
R18 37 2 2.8
R20 33 8 2.8
R37 15 13 143E9
C15 23 5 10E-12
E2 5 60 26 13 -1
V11 26 5 4.5
I3 3 5 0.0026
C9 30 5 10E-12
E3 16 5 23 5 1
R13 23 5 1E6
R39 28 59 10E3
R14 30 5 1E6
C10 51 5 2000E-12
R27 50 51 10
I1 46 3 1E-6
C12 4 5 10E-12
I4 1 5 0.011
R19 13 5 10
R28 31 42 1
V13 56 5 5
R26 49 45 100
E13 53 5 42 31 1
R29 53 10 300
C11 10 5 1E-6
G2 5 1 10 5 14
E14 24 5 3 5 1
R42 5 14 1E9
R30 1 5 6700
R31 3 5 1795
R45 10 5 1E9
C13 59 5 23.3E-12
R46 13 22 10E3
C14 22 5 23.3E-12
D2 22 13 D2M
R35 19 5 1E9
D3 59 28 D2M
S6 60 28 45 5 S9M
RA1 60 0 1E9
RA3 28 5 10
.MODEL QPU PNP
.MODEL R1M RES (TC1=7.374E-3 TC2=2.598E-5)
.MODEL S1M VSWITCH RON=0.01 ROFF=1E6 VON=2.55 VOFF=2.0
.MODEL S5M VSWITCH RON=1 ROFF=1E3 VON=0.001 VOFF=0
.MODEL S7M VSWITCH RON=1 ROFF=1E5 VON=0.1 VOFF=0
.MODEL S9M VSWITCH RON=0.1 ROFF=1E3 VON=2.91 VOFF=2.5
.MODEL S10M VSWITCH RON=1 ROFF=1E3 VON=1.1 VOFF=1
.MODEL D1M D (IS=4.5E-14 M=0.333 N=1.00 RS=0.112 VJ=0.75)
.MODEL D2M D (IS=1.68E-12 M=0.333 N=1.89 RS=0.452 VJ=0.75)
.ENDS
*END OF MODEL SA51
**********
*       SA60 PWM MODEL FEATURES INCLUDE:
*
*  1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*  2 OUTPUT RESISTANCE AND CAPACITANCE
*  3 ACCURATE RON TEMPERATURE COEFFICIENT
*  4 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*  5 DEADTIME BETWEEN SWITCH ON TIMES
*  6 ACCURATE IQ ON THE VCC LINE
*
*       SOME NOTES ON USING SPICE FOR PWM SIMULATION
*
*  REQUIRES BERKELEY SPICE 3E.3P OR LATER. YOUR SIMULATOR
*  MUST SUPPORT THE BERKELEY STANDARD VOLTAGE CONTROLLED
*  SWITCH ELEMENT (S)
*  OR
*  REQUIRES PSPICE 4.04 OR LATER
*
*  BE PREPARED FOR LONG SIMULATIONS.
*
*  NOTE: BERKELEY SIMULATORS TYPICALLY RUN THESE
*  PWM MODELS ABOUT TWO TO FOUR TIMES FASTER THAN
*  PSPICE TYPE SIMULATORS AS THE BERKELEY SWITCH
*  ELEMENT DOES NOT INVOKE AS BIG A COMPUTATIONAL
*  BURDEN
*
*  IF YOUR SIMULATION RUNS INTO TIMESTEP TOO SMALL
*  PROBLEMS YOU MAY WANT TO INCREASE ITL4 TO 100,
*  RELTOL TO 0.003 TO 0.01, ABSTOL TO 1E-9 TO 1E-11,
*  GMIN TO 1E-7 TO 1E-11, VNTOL TO 1E-4 TO 1E-5,
*  OR CHGTOL TO 1E-9 TO 1E-11.
*
*  A GOOD WAY TO TEST SIMULATION ACCURACY IS TO FIX THE
*  PWM SIGNAL INPUT TO A FIXED VOLTAGE THAT IS EQUIVALENT
*  TO HALFWAY BETWEEN 50-50 DUTY FACTOR AND 100 PERCENT
*  DUTY FACTOR. RUN A SIMULATION THAT HAS TIME FOR OUTPUT
*  FILTER SETTLING. IF THE OUTPUT VOLTAGE WANDERS AROUND
*  RATHER THAN STAYS SETTLED TO LESS THAN ONE PERCENT YOU
*  SHOULD REDUCE THE TIMESTEP MAX (TMAX) PARAMETER IN THE
*  TRAN LINE. THIS IS THE FOURTH TIME PARAMETER ON THAT
*  LINE AND IS OPTIONAL LIKE THE TSTART PARAMETER (THIRD
*  TIME PARAMETER ON THAT LINE). IF YOU ARE NOT USING
*  TSTART YOU MUST SET IT TO ZERO SO THE SIMULATOR WILL
*  RECOGNIZE TMAX AS TMAX RATHER THAN TSTART. FOR BERKELEY
*  SPICE 3 TMAX WILL USUALLY BE IN THE 250 TO 150 NS RANGE.
*  FOR PSPICE TMAX WILL USUALLY BE IN THE 100 TO 50 NS
*  RANGE.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PWM CLOCK
*  PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGENCE
*  FOR THE TRANSIENT ANALYSIS, RAMP VCC AND VS UP FROM
*  ZERO VOLTS TO NORMAL IN THE FIRST MICROSECOND OR SO.
*  THIS WILL NOT ONLY HELP THE TRAN ANALYSIS GET STARTED
*  BUT WILL ALLOW YOU TO SEE THE INITIAL VOLTAGES FOR LATER
*  SETTING OF NODESETS. FURTHER INTO THE ANALYSIS LOOK FOR
*  OUTPUT FILTER INDUCTOR CURRENTS AND CAPACITOR VOLTAGES
*  TO ALLOW SETTING UP INITIAL CONDITIONS ON THOSE PARTS.
*  SETTING INITIAL CONDITIONS CAN ALLOW YOUR OUTPUT FILTER
*  TO GET TO OPERATING CONDITIONS MORE QUICKLY. DON'T
*  FORGET TO USE THE UIC OPTION IN THE TRAN LINE TO FORCE
*  USE OF INITIAL CONDITIONS.
*
*BEGIN MODEL SA60 FOR PSPICE
*PINOUT ORDER IS AGND CF DIS ANAIN GND VCC ISENA AOUT VS BOUT ISENB
*PINOUT            1   2  3    4    6   7    8     9  10  11    12
* NOTE THAT YOUR EXTERNAL CF SHOULD HAVE IC=0 (INITIAL CONDITION)
.SUBCKT SA60_AM 1 2 3 4 6 7 8 9 10 11 12
E1 14 1 15 2 1
D5 8 9 D1M
R25 21 6 1
V2 31 6 10
V14 49 6 5
S3 19 13 14 1 PSW3
V8 32 6 2.5
RV8 32 6 1E9
R36 4 15 1E3
R5 16 24 1E3
D1 9 10 D1M
Q1 3 46 7 QPU
R21 24 25 1.91E3
D6 12 11 D1M
D7 11 10 D1M
E9 16 1 27 1 0.5
RA2 27 0 1E9
R22 2 23 49E3
C4 10 34 150E-12
C5 10 37 150E-12
C6 9 35 150E-12
C7 11 33 150E-12
R10 34 9 1.4
C9 2 1 47.4E-12 IC=0
R12 35 8 1.4
R18 37 11 1.4
R20 33 12 1.4
R1 48 9 RM1 0.16
R2 5 11 RM1 0.16
R3 47 8 RM1 0.16
R4 39 12 RM1 0.16
R37 15 13 143E9
E2 6 60 26 13 -1
RE2 26 0 1E9
V11 26 1 4.5
S4 50 21 22 32 PSW4
R39 28 59 10E3
S5 50 42 32 22 PSW4
C10 51 6 2E-9
R27 50 51 10
I1 46 7 1E-6
C12 3 6 10E-12
S12 23 1 57 24 PSW12
R24 27 23 2.575E3
E11 55 1 23 1 1
V1 55 25 -0.1
R19 13 6 10
V10 57 2 -0.01
CX10 23 1 4E-12
RV10 57 1 1E9
R28 31 42 1
V13 56 6 5
S15 10 48 59 6 PSW15
S16 10 5 22 6 PSW15
S17 9 47 22 6 PSW15
S18 11 39 59 6 PSW15
S19 45 6 3 6 PSW19
R26 49 45 1
E13 53 6 42 31 1
R29 53 54 300
C11 54 6 1E-6
G2 6 10 54 6 28
E14 27 1 7 1 1
R42 1 14 1E9
R30 10 6 9330
R31 7 1 454
R44 55 1 1E9
R45 54 6 1E9
C13 59 6 28E-12
R46 13 22 10E3
C14 22 6 28E-12
D2 22 13 D2M
S1 56 19 45 6 PSW1
S6 60 28 45 6 PSW1
RA1 60 0 1E9
RA3 28 6 10
R35 19 6 1E9
D3 59 28 D2M
.MODEL QPU PNP (BF=100 NE=1.5 EG=1.11
+ IS=1.5E-15 NC=1.7 FC=0.5 CJC=1E-12)
.MODEL RM1 RES (TC1=7.374E-3 TC2=2.598E-5)
.MODEL PSW1 VSWITCH RON=0.01 ROFF=1E3 VON=2.91 VOFF=2.5
.MODEL PSW3 VSWITCH RON=1 ROFF=1E3 VON=0.001 VOFF=0
.MODEL PSW4 VSWITCH RON=1 ROFF=1E5 VON=2 VOFF=0
.MODEL PSW12 VSWITCH RON=10 ROFF=1E6 VON=0.001 VOFF=0
.MODEL PSW15 VSWITCH RON=0.01 ROFF=1E6 VON=2.55 VOFF=2.0
.MODEL PSW19 VSWITCH RON=1 ROFF=1E3 VON=1.5 VOFF=1
.MODEL D1M D (IS=9E-14 M=0.333 N=1.00 RS=0.056 VJ=0.75)
.MODEL D2M D (IS=1.68E-08 M=0.333 N=1.89 RS=0.5 VJ=0.75)
.ENDS
* END MODEL SA60 FOR PSPICE
*************
*     SA60TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUTS
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 6 PIN NUMBERS CORRESPOND TO THE HARDWARE
* 7 A FLAG OUTPUT SHOWS INPUT VOLTAGE OUTSIDE THE MODULATION RANGE
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN AC SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).  
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION ALL THE WAY TO 0 OR 100% MODULATION, 
* WHICH IS NOT POSSIBLE WITH THE HARDWARE.
* 
* THE DISABLE FUNCTION IS NOT MODELED.
*
*BEGIN MODEL SA60TOOL FOR PSPICE.
*PIN ORDER AGND PWM DISABLE ANAIN PGND VCC ISENSA AOUT VS BOUT ISENB
*PINOUT      1   2     3      4     6   7     8     9  10  11    12
.SUBCKT SA60TOOL_AM 1 2 3 4 6 7 8 9 10 11 12
* DIVIDE VCC BY 3, FIND HIGH, LOW AND P-P RAMP VALUES
R120 7 101 1K 
R121 101 102 1K 
R122 102 0 1K 
E124 124 0 101 102 1 
E123 123 0 101 0 1 
E125 125 0 102 0 1 
* S123 & S125 LIMIT MODULATOR DRIVE TO 0/100%
S123 129 123 4 123 SM1 
S125 125 129 125 4 SM1 
R129 4 129 10K 
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)
* E119 SHOWS ONLY INTEGRATOR VOLTAGE OUTSIDE MODULATION RANGE
E119 128 0 129 4 -1 
R128 128 3 10 
R3 3 0 1meg 
* 130 SERIES PARTS ARE THE NON-INVERTING OUT, 140 ARE INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 130 0 129 125 1 
E140 140 0 123 129 1 
* E131 & E141 GENERATE OUTPUTS; V(MODULATE)*PWM GAIN [VS/VP-P]
E141 141 0 VALUE={V(140)*V(10)/V(124)} 
E131 131 0 VALUE={V(130)*V(10)/V(124)}
* R132 & 142 SET ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R132 131 11 .32 
R142 141 9 .32 
* E132 & E142 SENSE OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 0 @ VOUT=0 AND 1 @ VOUT=VS
E132 135 0 VALUE={(V(131)-V(11))*V(130)/V(124)} 
E142 145 0 VALUE={(V(141)-V(9))*V(140)/V(124)} 
* G135 & G145 REFLECT OUTPUT CURRENT INTO VSENSE PINS
G135 208 0 135 0 -3.125 
G145 212 0 145 0 -3.125 
V135 208 8 0 
V145 212 12 0 
* F135 & F145 REFLECT CURRENT INTO VS PIN
F135 10 0 V135 1 
F145 10 0 V145 1 
* 
R1 1 0 1meg 
R2 2 0 1meg 
R4 4 0 1meg 
R6 6 0 1meg 
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D130 11 10 D1M 
D131 0 11 D1M 
D140 9 10 D1M 
D141 0 9 D1M 
.MODEL D1M D (IS=2.832E-12 M=0.333 N=1.00 RS=0.043 VJ=0.75)
*
D120 4 7 D1N4148 
D121 0 4 D1N4148
.MODEL D1N4148  D(IS=0.1P RS=16 CJO=2P TT=12N BV=100 IBV=0.1P)  
.ENDS
*END OF MODEL SA60TOOL
**********
* FREQUENCY DIVIDER
* USE AT VDD = 5 VOLTS  VSS = 0 VOLTS
* INPUT SWING CAN BE AS LITTLE
* AS 0.9 TO 3.7 VOLTS BUT 0 TO 5
* ALLOWS FASTER EXECUTION
* OUTPUT SWING IS 5 VOLTS
*BEGIN MODEL FREQUENCY DIVIDE BY 2
*FOR BERKELEY SPICE AND PSPICE
*PINOUT ORDER IS IN OUT VDD VSS
*PINOUT           1  2   3   4
.SUBCKT FDIV_AM 1 2 3 4
M1 9 11 3 3 FMP
M2 10 12 9 3 FMP
M3 10 12 4 4 FMN
M4 10 11 4 4 FMN
M5 15 16 3 3 FMP
M6 12 17 15 3 FMP
M7 12 17 4 4 FMN
M8 12 16 4 4 FMN
M9 21 2 3 3 FMP
M10 17 16 21 3 FMP
M11 17 16 4 4 FMN
M12 17 2 4 4 FMN
M13 27 11 3 3 FMP
M14 2 17 27 3 FMP
M15 2 17 4 4 FMN
M16 2 11 4 4 FMN
M17 33 1 3 3 FMP
M18 11 10 33 3 FMP
M19 11 10 4 4 FMN
M20 11 1 4 4 FMN
M21 20 12 3 3 FMP
M22 20 12 4 4 FMN
M23 40 11 3 3 FMP
M24 40 11 4 4 FMN
M25 19 1 3 3 FMP
M26 19 1 4 4 FMN
M27 47 19 3 3 FMP
M28 47 40 3 3 FMP
M29 47 20 3 3 FMP
M30 47 19 50 4 FMN
M31 50 40 51 4 FMN
M32 51 20 4 4 FMN
M33 16 47 3 3 FMP
M34 16 47 4 4 FMN
RC1 1 4 1E15
RC2 2 4 1E15
RC3 3 4 1E15
C1 4 16 1E-12
.MODEL FMP PMOS (CBD=4E-12 CBS=4E-12
+ IS=30E-15 KP=2E-3 VTO=-3.0)
.MODEL FMN NMOS (CBD=4E-12 CBS=4E-12
+ IS=30E-15 KP=2E-3 VTO=3.5)
.ENDS
*END OF MODEL FDIV
************
*  REVISION 1 JAN-16-2007 INITIAL RELEASE
* BEGIN PSPICE DERIVED MODEL MSA240 MAIN PWM
*  REQUIRES PSPICE 5.1 OR LATER
*
* !!! NOTE THAT THIS MODEL OF THE MAIN PWM DOES NOT
*     INCLUDE THE CLOCK OSCILLATOR OR DIVIDE BY 2
*     CIRCUITS. THESE ARE INCLUDED IN THE MSAOSC
*     MODEL. THESE FUNCTIONS WERE SEPARATED TO
*     ALLOW FASTER SIMULATION (3-12 X). IF THE
*     OSC/DIV IS SIMULATED BY A SIMPLE SPICE SQUARE
*     WAVE GENERATOR TO FEED THIS MAIN PWM MODEL.
*     THIS GENERATOR SHOULD BE AT THE DESIRED
*     SWITCHING FREQUENCY, HAVE AN AMPLITUDE OF
*     0 TO 5 V, AND A RISE/FALL TIME OF 20-50 NS.
*
*   MODEL FEATURES INCLUDE:
*
*    1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*    2 OUTPUT RESISTANCE AND CAPACITANCE
*    3 ACCURATE CATCH DIODE I V CHARACTERISTIC
*    4 ACCURATE RON TEMPERATURE COEFFICIENT
*    5 SUPPORTS THE ISENSE FUNCTION
*    6 SUPPORTS THE ILIMIT FUNCTION
*    7 SUPPORTS THE SHUTDOWN FUNCTION
*    8 SUPPORTS 5 V REF OUTPUT
*    9 SUPPORTS INTERNAL CLAMPS AT 1.6,3.4 V
*   10 INTERNAL ERROR AMP WITH BODE, SLEW,
*      SWING, OFFSET, AND BIAS CURRENT 
*   11 INCREASING IQ ON THE VCC SUPPLY VS FREQUENCY
*
*
*  MODEL TRACKS THE DATA SHEET OVER THE -40 TO +85 C
*  TEMP RANGE AND IS FUNCTIONAL FROM -55 TO +150 C
*
* BEGIN NOTES
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  IF YOUR SIMULATOR SUPPORTS THE LVLTIM OPTION YOU
*  WILL GET 1.3X TO 1.5X FASTER EXECUTION WITH LVLTIM=1,
*  WHERE THE DEFAULT FOR MOST SIMULATORS IS 2. USING
*  LVLTIM=1 WILL CAUSE ACCURACY PROBLEMS ABOUT 5% OF
*  THE TIME, SO USE THIS WITH CAUTION. IF YOU ARE USING
*  A VERY RECENT SIMULATOR YOU WILL JUST WANT TO USE
*  THE DEFAULT OF 2.
*
*  SOME OLDER SIMULATORS REQUIRE THE OPTION TRTOL
*  BE SET TO 10000 AND ITL4 SET TO AT LEAST 100 AND
*  AS HIGH AS 2000.
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 1000, INCREASE
*  TRTOL TO 10000, INCREASE RELTOL TO 0.003 TO 0.01,
*  INCREASE ABSTOL TO 1E-11 TO 1E-9, INCREASE GMIN TO
*  1E-11 TO 1E-9, INCREASE VNTOL TO 1E-5 OR 1E-4, OR
*  INCREASE CHGTOL TO 1E-11 TO 1E-10. ANY OR ALL OF THESE
*  SIMULATOR OPTIONS MAY BE REQUIRED DEPENDING ON YOUR
*  SIMULATOR. NEWER SIMULATORS USUALLY REQUIRE FEWER OR
*  NONE OF THEM. ITL4 SHOULD BE INCREASED IN STEPS (IE
*  100,300,1000) AS AN OVERSIZED ITL4 WILL SLOW DOWN
*  THE SIMULATION. 
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 2000.
*
*  ACCURACY MAY BE INCREASED AND SIMULATION TIME MAY BE
*  DECREASED WITH THE PROPER SELECTION OF THE TIMESTEP
*  MAXIMUM (TMAX) PARAMETER IN THE TRAN LINE. THIS IS THE
*  FOURTH PARAMETER ON THAT LINE AND IS OPTIONAL LIKE THE
*  TSTART PARAMETER (THIRD TIME PARAMETER ON THAT LINE).
*  IF YOU ARE NOT USING TSTART YOU MUST SET IT TO ZERO SO
*  THE SIMULATOR WILL RECOGNIZE TMAX AS TMAX RATHER THAN
*  TSTART. SPICE USES A DEFAULT OF TSIM/100, YOU WILL
*  WANT TO USE MORE LIKE TSIM/1000 TO TSIM/10000 (START
*  WITH TSIM/4000) BUT NEVER EXCEED ABOUT 50 NANOSECONDS.
*  DO NOT HESITATE TO EXPERIMENT WITH TMAX AS SETTING IT
*  TOO LONG OR SHORT CAN CAUSE EITHER EXECUTION TIMES THAT
*  ARE 20X NORMAL OR EVEN SIMULATION ERRORS.
*
*  INTERNAL LOGIC WILL NOT BE STABILIZED FOR A TIME
*  THAT IS 2 MICROSECONDS PLUS AT LEAST ONE HALF TO
*  ONE CLOCK PERIOD.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PULSE
*  RATE PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, USE THE "UIC" SPECIFIER
*  TO SKIP THAT STEP. IF YOU DO THIS ALSO SPECIFY DELAYED
*  OUTPUT IN THE TRANSIENT ANALYSIS SO THAT YOUR SCOPE
*  AUTO-SCALING WILL NOT BE CONFUSED BY THE VALUES AT
*  TIME ZERO.
*
* END NOTES
*PINOUT ORDER 5OUT EA- EA+ EAOUT +IN RRAMP GND VCC ISENA AOUT VS BOUT ISENB ILIMB ILIMA
*PINOUT ORDER  19   16  15   17   13   61   58  29   40   35  30  49    54    7     10
.SUBCKT MSA240 19 16 15 17 13 61 58 29 40 35 30 49 54 7 10
R17 77 80 0.125 TC=8E-3,9E-5
R18 81 78 0.125 TC=8E-3,9E-5
R21 87 90 0.125 TC=8E-3,9E-5
R22 91 88 0.125 TC=8E-3,9E-5
R12 66 67 5100
D2 66 68 DD
C1 69 58 2200P
R14 69 61 5360
E4 67 58 61 69 -300
D3 70 66 DD
V33 68 58 4.3
V34 70 58 0.7
R16 71 72 5100
D4 71 73 DD
E5 72 58 69 74 300
D5 75 71 DD
V35 73 58 4.3
V36 75 58 0.7
M1 30 76 77 77 MOB
M2 78 79 40 40 MOB
V38 80 35 0
V39 35 81 0
C2 76 30 5E-11
C3 79 78 5E-11
C4 76 77 2E-10
C5 79 40 2E-10
R19 76 82 100
R20 79 83 100
E6 82 77 84 58 2
E7 83 40 85 58 2
M3 30 86 87 87 MOB
M4 88 89 54 54 MOB
V42 90 49 0
V43 49 91 0
C6 86 30 5E-11
C7 89 88 5E-11
C8 86 87 2E-10
C9 89 54 2E-10
R23 86 92 100
R24 89 93 100
E8 92 87 94 58 2
E9 93 54 95 58 2
R28 84 71 1E4
R29 85 96 1E4
R30 95 71 1E4
R31 94 96 1E4
M6 84 65 58 58 MOC
M7 85 65 58 58 MOC
M8 94 65 58 58 MOC
M9 95 65 58 58 MOC
R32 96 97 5100
D6 96 98 DD
E10 97 58 69 74 -300
D7 99 96 DD
V50 98 58 4.3
V51 99 58 0.7
D8 77 30 DBD
D9 87 30 DBD
D10 54 88 DBD
D11 40 78 DBD
R52 100 142 7.96E3
R53 101 142 7.96E3
R54 102 103 3E3
R55 102 104 3E3
I3 102 58 1.05E-5
R56 58 102 9.5E5
C16 100 101 3.33E-12
G2 105 106 101 100 -1.26E-4
Q6 142 107 108 QON
Q7 142 109 110 QON
Q8 58 111 112 QOP
Q9 58 109 113 QOP
R57 111 110 5.95
R58 112 114 5.95
R59 114 108 5.95
R60 113 107 5.95
I4 142 107 7.22E-5
I5 111 58 7.22E-5
G3 105 106 102 58 7.06E-8
G4 109 106 106 105 -7.96
C17 105 109 13E-12
D12 106 105 DD
D13 105 106 DD
R61 106 105 1E5
R62 17 114 20
C18 102 58 5E-13
R80 106 109 1E3
Q10 115 116 114 QLP
D14 107 117 DL
D15 115 111 DL
V57 118 119 0.71
V58 120 121 0.71
D16 109 119 DD
D17 120 109 DD
C44 16 106 3E-12
C45 15 106 3E-12
E15 106 58 142 58 0.5
I9 29 58 3.27E-5
R99 122 108 1E3
R100 116 112 1E3
Q11 117 122 114 QLN
D18 17 142 DD
D19 58 17 DD
E16 118 0 142 0 1
E17 121 0 58 0 1
Q12 100 16 103 QI1
Q13 101 15 104 QI2
E18 123 58 124 125 -1000
R105 126 127 5100
D20 124 123 DD
E19 128 58 126 124 -1000
D21 128 126 DD
R106 124 129 5100
V59 127 58 1.6
V60 129 58 3.4
R107 130 131 5100
D22 130 132 DD
E20 131 58 133 134 -300
D23 135 130 DD
V63 132 58 4.3
V64 135 58 0.7
R108 136 137 5100
D24 136 138 DD
E21 137 58 133 139 -1E3
D25 140 136 DD
V65 138 58 4.3
V66 140 58 0.7
M75 141 130 58 58 MCNO
M76 141 136 58 58 MCNO
R109 142 141 5100
V67 133 58 0.2
V69 142 0 5
C46 74 58 0.01E-6
R111 74 126 1E3
R112 58 17 1E8
R138 134 7 1E3
R139 139 10 1E3
C54 134 58 0.01E-6
C55 139 58 0.01E-6
R140 65 58 100E3
R141 143 58 101E3
M138 65 144 142 142 MP
M139 65 143 142 142 MP
M140 143 65 142 142 MP
M141 143 66 142 142 MP
V78 145 58 0 PULSE 5 0 1U 1U 1U 1U 200
M142 143 145 142 142 MP
C56 65 58 1E-12
C57 143 58 1E-12
R142 144 141 1E3
C58 144 58 100E-12
D26 58 49 DCO
D27 58 35 DCO
R143 142 19 3
C59 19 58 1E-6
I11 29 58 3E-3
C72 146 147 100E-9
R287 148 149 0.1
R288 150 146 10
R289 149 151 1E4
R290 148 152 1E4
C73 151 152 3E-9
G5 29 58 153 154 18.5
E60 149 58 142 58 1
E61 147 58 58 58 1
M143 150 66 148 148 MP W=500U
M144 150 66 147 147 MN W=500U
R291 151 153 1E4
R292 152 154 1E4
C74 153 154 3E-9
R295 125 13 1E3 
C75 125 58 0.01E-6
RG1 133 0 1E11
.MODEL DCO D RS=0.01 IS=1E-13 CJO=50E-12 TT=10N
.MODEL DD D(CJO=0.1E-12 IS=1E-17)
.MODEL DL D(CJO=3E-12 IS=1E-13)
.MODEL QI1 NPN (BF=4.20E02 IS=8E-16)
.MODEL QI2 NPN (BF=3.00E02 IS=8.52E-16)
.MODEL QOP PNP (BF=1.45E+03 IS=1E-14)
.MODEL QON NPN (BF=1.45E+03 IS=1E-14)
.MODEL QLN NPN (BF=100 IS=1E-14)
.MODEL QLP PNP (BF=100 IS=1E-14)
.MODEL MN NMOS CBD=4P CBS=4P
+ IS=30F KP=2M UO=600 VTO=3
.MODEL MP PMOS CBD=4P CBS=4P
+ IS=30F KP=2M UO=600 VTO=-3
.MODEL MCNO NMOS KP=20000U VTO=2
.MODEL MOB NMOS KP=10 VTO=3
.MODEL MOC NMOS KP=0.1 VTO=2
.MODEL DBD D RS=0.013 IS=5.866E-13 CJO=100E-12 TT=50N
.ENDS
* END PSPICE DERIVED MODEL MSA240 MAIN PWM

*************
* REVISION 1 JAN-15-2007 INITIAL RELEASE
*   MSA240TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUTS
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 6 PIN NUMBERS CORRESPOND TO THE HARDWARE
* 7 A FLAG OUTPUT SHOWS INPUT VOLTAGE OUTSIDE THE MODULATION RANGE
* PIN 10 IS USED FOR THE FLAG, IMPEDANCE IS 10 OHMS
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION TO 5 OR 95% MODULATION, WITH NO REGARD
* TO SWITCHING FREQUENCY. IF DESIRED, V116 CAN BE CHANGED FROM .1V TO
* .14V TO LIMIT LINEAR OPERATON TO 7 OR 93%.
*
* THE ILIM/SHDN FUNCTION IS NOT MODELED.
*
* IF CONVERGENCE PROBLEMS ARE EXPERIENCED SETTING ITL4=250 WILL HELP. SETTING ITL1=1000
* AND ITL2=1000 MAY ALSO HELP.
*
*BEGIN MODEL MSA240TOOL FOR PSPICE.
*PINS 5VOUT EA- EA+ EAOUT +IN RRAMP GND VCC ISENSA AOUT VS
*PINS 19   16  15   17   13   1    2   29   40    35  30
*PINS CONT BOUT ISENSB ILIMB ILIMASD
*PINS CONT 49   54     7     10
.SUBCKT MSA240TOOL 19 16 15 17 13 1 2 29 40 35 30 49 54 7 10
* R110 & C110 DUPLICATE HARDWARE
R110 13 127 1E3
C110 127 2 .01U
* V123 AND V125 SET RAMP PEAKS, E124 IS P-P RAMP
V123 123 2 3.5
V125 125 2 1.5
E124 124 0 123 125 1
* S123 & S125 LIMIT MODULATOR DRIVE
S123 129 121 127 121 SM1
S125 122 129 122 127 SM1
R129 127 129 10K
* E119 SHOWS ONLY INTEGRATOR VOLTAGE OUTSIDE MODULATION RANGE
E119 128 2 129 127 -1
R128 128 10 10
* 130 SERIES PARTS ARE THE NON-INVERTING OUT, 140 ARE INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 130 0 129 125 1
E140 140 0 123 129 1
* E131 & E141 GENERATE OUTPUTS; V(MODULATE)*PWM GAIN [VS/VP-P]
E141 141 2 VALUE={V(140)*V(104)/V(124)}
E131 131 2 VALUE={V(130)*V(104)/V(124)}
* R132 & 142 SET ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R132 131 49 .15
R142 141 35 .15
* FIND ACTUAL SUPPLY VOLTAGE WHEN MODULE GROUND PIN IS NOT SPICE GROUND
E109 104 0 30 2 1
* E132 & E142 SENSE OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 0 @ VOUT=0 AND 1 @ VOUT=VS
E132 135 2 VALUE={(V(131)-V(49))*V(130)/V(124)}
E142 145 2 VALUE={(V(141)-V(35))*V(140)/V(124)}
* G135 & G145 REFLECT OUTPUT CURRENT INTO VSENSE PINS
G135 138 0 135 2 -6.667
G145 148 0 145 2 -6.667
V135 138 40 0
V145 148 54 0
* F135 & F145 REFLECT CURRENT INTO VS PIN
F135 30 0 V135 1
F145 30 0 V145 1
R101 1 0 1MEG
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D130 49 30 D1M
D131 2 49 D1M
D140 35 30 D1M
D141 2 35 D1M
D120 127 105 1N4148
D121 2 127 1N4148
* V105 RUNS ERROR AMP AND 5VOUT
V105 105 2 5
R105 19 105 3
C101 19 2 1E-6
* SET MAX MODULATION LESS THAT 100 PERCENT .1 IS 95 .14 IS 93
V116 116 2 .1
E106 121 2 123 116 1
E107 122 2 125 117 1
E108 117 2 116 2 -1
R103 29 0 1MEG
R102 7 0 1MEG
* ERROR AMP
R205 209 212 3E+3
R206 208 212 3E+3
R207 105 210 7.96E+3
R208 105 211 7.96E+3
R209 212 2 9.5E5
R210 206 200 100E+3
R211 207 200 1000
I203 212 2 1.05E-5
C202 212 2 5E-13
C203 210 211 3.33E-12
G202 206 200 211 210 1.26E-4
G203 206 200 212 200 7.06E-8
G204 200 207 200 206 7.96
D202 206 200 DD
D203 200 206 DD
C204 206 207 1.3E-11
E203 218 0 105 0 1
E204 219 0 2 0 1
D204 207 216 DD
D205 217 207 DD
D206 223 225 DL
D207 226 224 DL
V202 218 216 .71
V203 217 219 .71
I204 218 223 7.22E-05
I205 224 219 7.22E-05
Q206 105 223 229 QON
Q208 225 227 231 QLN
Q209 218 207 222 QON
Q210 2 224 230 QOP
Q211 226 228 231 QLP
Q212 219 207 221 QOP
R212 227 229 1E3
R213 228 230 1E3
R214 231 230 5.95
R216 231 17 20
R217 222 224 5.95
R218 223 221 5.95
Q213 210 15 208 QI1
Q214 211 16 209 QI2
R219 229 231 5.95
E205 200 219 105 219 .5
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)
.MODEL DD D(CJO=0.1PF IS=1E-17)
.MODEL DL D(CJO=3PF IS=1E-13)
.MODEL QI1 NPN (BF=4.20E-02 IS=8E-16)
.MODEL QI2 NPN (BF=3.00E-02 IS=8.52E-16)
.MODEL QOP PNP (BF=1.45E+03 IS=1E-14)
.MODEL QON NPN (BF=1.45E+03 IS=1E-14)
.MODEL QLN NPN (BF=100 IS=1E-14)
.MODEL QLP PNP (BF=100 IS=1E-14)
.MODEL 1N4148 D (
+ IS=1E-013 RS=16 CJO=2E-012 TT=1.2E-008 BV=100
+ IBV=1E-013)
.MODEL D1M D (IS=2.832E-12 M=0.333 N=1.61 RS=0.043 VJ=0.75)
.ENDS
*END OF MODEL MSA240TOOL
******************

*  REVISION 1 JAN-16-2007 INITIAL RELEASE
* BEGIN PSPICE DERIVED MODEL MSA260 MAIN PWM
*  REQUIRES PSPICE 5.1 OR LATER
*
* !!! NOTE THAT THIS MODEL OF THE MAIN PWM DOES NOT
*     INCLUDE THE CLOCK OSCILLATOR OR DIVIDE BY 2
*     CIRCUITS. THESE ARE INCLUDED IN THE MSAOSC
*     MODEL. THESE FUNCTIONS WERE SEPARATED TO
*     ALLOW FASTER SIMULATION (3-12 X). IF THE
*     OSC/DIV IS SIMULATED BY A SIMPLE SPICE SQUARE
*     WAVE GENERATOR TO FEED THIS MAIN PWM MODEL.
*     THIS GENERATOR SHOULD BE AT THE DESIRED
*     SWITCHING FREQUENCY, HAVE AN AMPLITUDE OF
*     0 TO 5 V, AND A RISE/FALL TIME OF 20-50 NS.
*
*   MODEL FEATURES INCLUDE:
*
*    1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*    2 OUTPUT RESISTANCE AND CAPACITANCE
*    3 ACCURATE CATCH DIODE I V CHARACTERISTIC
*    4 ACCURATE RON TEMPERATURE COEFFICIENT
*    5 SUPPORTS THE ISENSE FUNCTION
*    6 SUPPORTS THE ILIMIT FUNCTION
*    7 SUPPORTS THE SHUTDOWN FUNCTION
*    8 SUPPORTS 5 V REF OUTPUT
*    9 SUPPORTS INTERNAL CLAMPS AT 1.6,3.4 V
*   10 INTERNAL ERROR AMP WITH BODE, SLEW,
*      SWING, OFFSET, AND BIAS CURRENT 
*   11 INCREASING IQ ON THE VCC SUPPLY VS FREQUENCY
*
*
*  MODEL TRACKS THE DATA SHEET OVER THE -40 TO +85 C
*  TEMP RANGE AND IS FUNCTIONAL FROM -55 TO +150 C
*
* BEGIN NOTES
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  IF YOUR SIMULATOR SUPPORTS THE LVLTIM OPTION YOU
*  WILL GET 1.3X TO 1.5X FASTER EXECUTION WITH LVLTIM=1,
*  WHERE THE DEFAULT FOR MOST SIMULATORS IS 2. USING
*  LVLTIM=1 WILL CAUSE ACCURACY PROBLEMS ABOUT 5% OF
*  THE TIME, SO USE THIS WITH CAUTION. IF YOU ARE USING
*  A VERY RECENT SIMULATOR YOU WILL JUST WANT TO USE
*  THE DEFAULT OF 2.
*
*  SOME OLDER SIMULATORS REQUIRE THE OPTION TRTOL
*  BE SET TO 10000 AND ITL4 SET TO AT LEAST 100 AND
*  AS HIGH AS 2000.
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 1000, INCREASE
*  TRTOL TO 10000, INCREASE RELTOL TO 0.003 TO 0.01,
*  INCREASE ABSTOL TO 1E-11 TO 1E-9, INCREASE GMIN TO
*  1E-11 TO 1E-9, INCREASE VNTOL TO 1E-5 OR 1E-4, OR
*  INCREASE CHGTOL TO 1E-11 TO 1E-10. ANY OR ALL OF THESE
*  SIMULATOR OPTIONS MAY BE REQUIRED DEPENDING ON YOUR
*  SIMULATOR. NEWER SIMULATORS USUALLY REQUIRE FEWER OR
*  NONE OF THEM. ITL4 SHOULD BE INCREASED IN STEPS (IE
*  100,300,1000) AS AN OVERSIZED ITL4 WILL SLOW DOWN
*  THE SIMULATION. 
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 2000.
*
*  ACCURACY MAY BE INCREASED AND SIMULATION TIME MAY BE
*  DECREASED WITH THE PROPER SELECTION OF THE TIMESTEP
*  MAXIMUM (TMAX) PARAMETER IN THE TRAN LINE. THIS IS THE
*  FOURTH PARAMETER ON THAT LINE AND IS OPTIONAL LIKE THE
*  TSTART PARAMETER (THIRD TIME PARAMETER ON THAT LINE).
*  IF YOU ARE NOT USING TSTART YOU MUST SET IT TO ZERO SO
*  THE SIMULATOR WILL RECOGNIZE TMAX AS TMAX RATHER THAN
*  TSTART. SPICE USES A DEFAULT OF TSIM/100, YOU WILL
*  WANT TO USE MORE LIKE TSIM/1000 TO TSIM/10000 (START
*  WITH TSIM/4000) BUT NEVER EXCEED ABOUT 50 NANOSECONDS.
*  DO NOT HESITATE TO EXPERIMENT WITH TMAX AS SETTING IT
*  TOO LONG OR SHORT CAN CAUSE EITHER EXECUTION TIMES THAT
*  ARE 20X NORMAL OR EVEN SIMULATION ERRORS.
*
*  INTERNAL LOGIC WILL NOT BE STABILIZED FOR A TIME
*  THAT IS 2 MICROSECONDS PLUS AT LEAST ONE HALF TO
*  ONE CLOCK PERIOD.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PULSE
*  RATE PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, USE THE "UIC" SPECIFIER
*  TO SKIP THAT STEP. IF YOU DO THIS ALSO SPECIFY DELAYED
*  OUTPUT IN THE TRANSIENT ANALYSIS SO THAT YOUR SCOPE
*  AUTO-SCALING WILL NOT BE CONFUSED BY THE VALUES AT
*  TIME ZERO.
*
* END NOTES
*PINOUT ORDER 5OUT EA- EA+ EAOUT +IN RRAMP GND VCC ISENA AOUT VS BOUT ISENB ILIMB ILIMA
*PINOUT ORDER  19   16  15   17   13   61   58  29   40   35  30  49    54    7     10
.SUBCKT MSA260 19 16 15 17 13 61 58 29 40 35 30 49 54 7 10
R17 77 80 0.120 TC=2.4E-3,2E-5
R18 81 78 0.120 TC=2.4E-3,2E-5
R21 87 90 0.120 TC=2.4E-3,2E-5
R22 91 88 0.120 TC=2.4E-3,2E-5
R12 66 67 5100
D2 66 68 DD
C1 69 58 2200P
R14 69 61 5360
E4 67 58 61 69 -300
D3 70 66 DD
V33 68 58 4.3
V34 70 58 0.7
R16 71 72 5100
D4 71 73 DD
E5 72 58 69 74 300
D5 75 71 DD
V35 73 58 4.3
V36 75 58 0.7
M1 30 76 77 77 MOB
M2 78 79 40 40 MOB
V38 80 35 1.9
V39 35 81 1.9
C2 76 30 5E-11
C3 79 78 5E-11
C4 76 77 2E-10
C5 79 40 2E-10
R19 76 82 100
R20 79 83 100
E6 82 77 84 58 2
E7 83 40 85 58 2
M3 30 86 87 87 MOB
M4 88 89 54 54 MOB
V42 90 49 1.9
V43 49 91 1.9
C6 86 30 5E-11
C7 89 88 5E-11
C8 86 87 2E-10
C9 89 54 2E-10
R23 86 92 100
R24 89 93 100
E8 92 87 94 58 2
E9 93 54 95 58 2
R28 84 71 1E4
R29 85 96 1E4
R30 95 71 1E4
R31 94 96 1E4
M6 84 65 58 58 MOC
M7 85 65 58 58 MOC
M8 94 65 58 58 MOC
M9 95 65 58 58 MOC
R32 96 97 5100
D6 96 98 DD
E10 97 58 69 74 -300
D7 99 96 DD
V50 98 58 4.3
V51 99 58 0.7
D8 77 30 DBD
D9 87 30 DBD
D10 54 88 DBD
D11 40 78 DBD
R52 100 142 7.96E3
R53 101 142 7.96E3
R54 102 103 3E3
R55 102 104 3E3
I3 102 58 1.05E-5
R56 58 102 9.5E5
C16 100 101 3.33E-12
G2 105 106 101 100 -1.26E-4
Q6 142 107 108 QON
Q7 142 109 110 QON
Q8 58 111 112 QOP
Q9 58 109 113 QOP
R57 111 110 5.95
R58 112 114 5.95
R59 114 108 5.95
R60 113 107 5.95
I4 142 107 7.22E-5
I5 111 58 7.22E-5
G3 105 106 102 58 7.06E-8
G4 109 106 106 105 -7.96
C17 105 109 13E-12
D12 106 105 DD
D13 105 106 DD
R61 106 105 1E5
R62 17 114 20
C18 102 58 5E-13
R80 106 109 1E3
Q10 115 116 114 QLP
D14 107 117 DL
D15 115 111 DL
V57 118 119 0.71
V58 120 121 0.71
D16 109 119 DD
D17 120 109 DD
C44 16 106 3E-12
C45 15 106 3E-12
E15 106 58 142 58 0.5
I9 29 58 3.27E-5
R99 122 108 1E3
R100 116 112 1E3
Q11 117 122 114 QLN
D18 17 142 DD
D19 58 17 DD
E16 118 0 142 0 1
E17 121 0 58 0 1
Q12 100 16 103 QI1
Q13 101 15 104 QI2
E18 123 58 124 125 -1000
R105 126 127 5100
D20 124 123 DD
E19 128 58 126 124 -1000
D21 128 126 DD
R106 124 129 5100
V59 127 58 1.6
V60 129 58 3.4
R107 130 131 5100
D22 130 132 DD
E20 131 58 133 134 -300
D23 135 130 DD
V63 132 58 4.3
V64 135 58 0.7
R108 136 137 5100
D24 136 138 DD
E21 137 58 133 139 -1E3
D25 140 136 DD
V65 138 58 4.3
V66 140 58 0.7
M75 141 130 58 58 MCNO
M76 141 136 58 58 MCNO
R109 142 141 5100
V67 133 58 0.2
V69 142 0 5
C46 74 58 0.01E-6
R111 74 126 1E3
R112 58 17 1E8
R138 134 7 1E3
R139 139 10 1E3
C54 134 58 0.01E-6
C55 139 58 0.01E-6
R140 65 58 100E3
R141 143 58 101E3
M138 65 144 142 142 MP
M139 65 143 142 142 MP
M140 143 65 142 142 MP
M141 143 66 142 142 MP
V78 145 58 0 PULSE 5 0 1U 1U 1U 1U 200
M142 143 145 142 142 MP
C56 65 58 1E-12
C57 143 58 1E-12
R142 144 141 1E3
C58 144 58 100E-12
D26 58 49 DCO
D27 58 35 DCO
R143 142 19 3
C59 19 58 1E-6
I11 29 58 3E-3
C72 146 147 100E-9
R287 148 149 0.1
R288 150 146 10
R289 149 151 1E4
R290 148 152 1E4
C73 151 152 3E-9
G5 29 58 153 154 18.5
E60 149 58 142 58 1
E61 147 58 58 58 1
M143 150 66 148 148 MP W=500U
M144 150 66 147 147 MN W=500U
R291 151 153 1E4
R292 152 154 1E4
C74 153 154 3E-9
R295 125 13 1E3 
C75 125 58 0.01E-6
RG1 133 0 1E11
.MODEL DCO D RS=0.01 IS=1E-13 CJO=50E-12 TT=10N
.MODEL DD D(CJO=0.1E-12 IS=1E-17)
.MODEL DL D(CJO=3E-12 IS=1E-13)
.MODEL QI1 NPN (BF=4.20E02 IS=8E-16)
.MODEL QI2 NPN (BF=3.00E02 IS=8.52E-16)
.MODEL QOP PNP (BF=1.45E+03 IS=1E-14)
.MODEL QON NPN (BF=1.45E+03 IS=1E-14)
.MODEL QLN NPN (BF=100 IS=1E-14)
.MODEL QLP PNP (BF=100 IS=1E-14)
.MODEL MN NMOS CBD=4P CBS=4P
+ IS=30F KP=2M UO=600 VTO=3
.MODEL MP PMOS CBD=4P CBS=4P
+ IS=30F KP=2M UO=600 VTO=-3
.MODEL MCNO NMOS KP=20000U VTO=2
.MODEL MOB NMOS KP=10 VTO=3
.MODEL MOC NMOS KP=0.1 VTO=2
.MODEL DBD D RS=0.005 IS=4.742E-13 CJO=100E-12 TT=50N
.ENDS
* END PSPICE DERIVED MODEL MSA260 MAIN PWM

*************
* REVISION 1 JAN-15-2007 INITIAL RELEASE
*   MSA260TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUTS
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 6 PIN NUMBERS CORRESPOND TO THE HARDWARE
* 7 A FLAG OUTPUT SHOWS INPUT VOLTAGE OUTSIDE THE MODULATION RANGE
* PIN 10 IS USED FOR THE FLAG, IMPEDANCE IS 10 OHMS
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION TO 5 OR 95% MODULATION, WITH NO REGARD
* TO SWITCHING FREQUENCY. IF DESIRED, V116 CAN BE CHANGED FROM .1V TO
* .14V TO LIMIT LINEAR OPERATON TO 7 OR 93%.
*
* THE ILIM/SHDN FUNCTION IS NOT MODELED.
*
* IF CONVERGENCE PROBLEMS ARE EXPERIENCED SETTING ITL4=250 WILL HELP. SETTING ITL1=1000
* AND ITL2=1000 MAY ALSO HELP.
*
*BEGIN MODEL MSA260TOOL FOR PSPICE.
*PINS 5VOUT EA- EA+ EAOUT +IN RRAMP GND VCC ISENSA AOUT VS
*PINS 19   16  15   17   13   1    2   29   40    35  30
*PINS CONT BOUT ISENSB ILIMB ILIMASD
*PINS CONT 49   54     7     10
.SUBCKT MSA260TOOL 19 16 15 17 13 1 2 29 40 35 30 49 54 7 10
* R110 & C110 DUPLICATE HARDWARE
R110 13 127 1E3
C110 127 2 .01U
* V123 AND V125 SET RAMP PEAKS, E124 IS P-P RAMP
V123 123 2 3.5
V125 125 2 1.5
E124 124 0 123 125 1
* S123 & S125 LIMIT MODULATOR DRIVE
S123 129 121 127 121 SM1
S125 122 129 122 127 SM1
R129 127 129 10K
* E119 SHOWS ONLY INTEGRATOR VOLTAGE OUTSIDE MODULATION RANGE
E119 128 2 129 127 -1
R128 128 10 10
* 130 SERIES PARTS ARE THE NON-INVERTING OUT, 140 ARE INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 130 0 129 125 1
E140 140 0 123 129 1
* E131 & E141 GENERATE OUTPUTS; V(MODULATE)*PWM GAIN [VS/VP-P]
E141 141 2 VALUE={V(140)*V(104)/V(124)}
E131 131 2 VALUE={V(130)*V(104)/V(124)}
* R132 & 142 SET ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R132 131 49 .125
R142 141 35 .125
* FIND ACTUAL SUPPLY VOLTAGE WHEN MODULE GROUND PIN IS NOT SPICE GROUND
E109 104 0 30 2 1
* E132 & E142 SENSE OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 0 @ VOUT=0 AND 1 @ VOUT=VS
E132 135 2 VALUE={(V(131)-V(49))*V(130)/V(124)}
E142 145 2 VALUE={(V(141)-V(35))*V(140)/V(124)}
* G135 & G145 REFLECT OUTPUT CURRENT INTO VSENSE PINS
G135 138 0 135 2 -8
G145 148 0 145 2 -8
V135 138 40 0
V145 148 54 0
* F135 & F145 REFLECT CURRENT INTO VS PIN
F135 30 0 V135 1
F145 30 0 V145 1
R101 1 0 1MEG
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D130 49 30 D1M
D131 2 49 D1M
D140 35 30 D1M
D141 2 35 D1M
D120 127 105 1N4148
D121 2 127 1N4148
* V105 RUNS ERROR AMP AND 5VOUT
V105 105 2 5
R105 19 105 3
C101 19 2 1E-6
* SET MAX MODULATION LESS THAT 100 PERCENT .1 IS 95 .14 IS 93
V116 116 2 .1
E106 121 2 123 116 1
E107 122 2 125 117 1
E108 117 2 116 2 -1
R103 29 0 1MEG
R102 7 0 1MEG
* ERROR AMP
R205 209 212 3E+3
R206 208 212 3E+3
R207 105 210 7.96E+3
R208 105 211 7.96E+3
R209 212 2 9.5E5
R210 206 200 100E+3
R211 207 200 1000
I203 212 2 1.05E-5
C202 212 2 5E-13
C203 210 211 3.33E-12
G202 206 200 211 210 1.26E-4
G203 206 200 212 200 7.06E-8
G204 200 207 200 206 7.96
D202 206 200 DD
D203 200 206 DD
C204 206 207 1.3E-11
E203 218 0 105 0 1
E204 219 0 2 0 1
D204 207 216 DD
D205 217 207 DD
D206 223 225 DL
D207 226 224 DL
V202 218 216 .71
V203 217 219 .71
I204 218 223 7.22E-05
I205 224 219 7.22E-05
Q206 105 223 229 QON
Q208 225 227 231 QLN
Q209 218 207 222 QON
Q210 2 224 230 QOP
Q211 226 228 231 QLP
Q212 219 207 221 QOP
R212 227 229 1E3
R213 228 230 1E3
R214 231 230 5.95
R216 231 17 20
R217 222 224 5.95
R218 223 221 5.95
Q213 210 15 208 QI1
Q214 211 16 209 QI2
R219 229 231 5.95
E205 200 219 105 219 .5
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)
.MODEL DD D(CJO=0.1PF IS=1E-17)
.MODEL DL D(CJO=3PF IS=1E-13)
.MODEL QI1 NPN (BF=4.20E-02 IS=8E-16)
.MODEL QI2 NPN (BF=3.00E-02 IS=8.52E-16)
.MODEL QOP PNP (BF=1.45E+03 IS=1E-14)
.MODEL QON NPN (BF=1.45E+03 IS=1E-14)
.MODEL QLN NPN (BF=100 IS=1E-14)
.MODEL QLP PNP (BF=100 IS=1E-14)
.MODEL 1N4148 D (
+ IS=1E-013 RS=16 CJO=2E-012 TT=1.2E-008 BV=100
+ IBV=1E-013)
.MODEL D1M D (IS=2.832E-12 M=0.333 N=1.61 RS=0.043 VJ=0.75)
.ENDS
*END OF MODEL MSA260TOOL
******************

* REVISION 1 JAN-15-2007 INITIAL RELEASE
* BEGIN MODEL MSA240 MSA260 OSC
*
* PLEASE SEE THE NOTES CONTAINED IN THE MSA240 AND
* MSA260 MODEL FILES.
*
* !!! NOTE THAT THIS MODEL OF THE MSA240 AND MSA260
*     CLOCK OSCILLATOR AND DIVIDER IS OPTIONAL AND
*     MAY BE USED WITH THE MSA240 AND MSA260 MAIN
*     PWM MODELS.
*
*   SIMULATION WILL BE 3 TO 12 TIMES FASTER IF YOU
*   DO NOT USE THE OSC/DIV MODEL BUT REPLACE IT
*   WITH A SIMPLE SPICE SQUARE WAVE GENERATOR TO
*   FEED THE MAIN PWM MODEL. THIS GENERATOR SHOULD
*   BE AT THE DESIRED SWITCHING FREQUENCY, HAVE AN
*   AMPLITUDE OF 0 TO 5 V, AND A RISE/FALL TIME OF
*   20-50 NS. SPICE ANAYSIS OPTIONS WILL ALSO BE
*   MORE RELAXED IF THIS OSC/DIV MODEL IS REPLACED
*   WITH A GENERATOR.
*
*   MODEL FEATURES INCLUDE:
*
*    1 OSC FREQUENCY SET BY ROSC
*    2 HAS FREQUENCY DIVIDER AVAILABLE
*    3 DIVIDER OUTPUT SWING AND RISE/FALL
*      TIMES ARE ACCURATE
*   MODEL OSCILLATOR DOES NOT HAVE A FREQUENCY
*   TEMPERATURE COEFFFICIENT
*
*  TEMP RANGE AND IS FUNCTIONAL FROM -55 TO +150 C
*
* BEGIN NOTES
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  BECAUSE THE OSCILLATOR MUST SWITCH AT PRECISE VOLTAGES
*  ON A RAPIDLY CHANGING VOLTAGE, YOU WILL OFTEN HAVE TO
*  SET THE SPICE TRANSIENT ANALYSIS OPTION TMAX.
*
*  ACCURACY MAY BE INCREASED AND SIMULATION TIME MAY BE
*  DECREASED WITH THE PROPER SELECTION OF THE TIMESTEP
*  MAXIMUM (TMAX) PARAMETER IN THE TRAN LINE. THIS IS THE
*  FOURTH PARAMETER ON THAT LINE AND IS OPTIONAL LIKE THE
*  TSTART PARAMETER (THIRD TIME PARAMETER ON THAT LINE).
*  IF YOU ARE NOT USING TSTART YOU MUST SET IT TO ZERO SO
*  THE SIMULATOR WILL RECOGNIZE TMAX AS TMAX RATHER THAN
*  TSTART. SPICE USES A DEFAULT OF TSIM/100, YOU WILL
*  WANT TO USE MORE LIKE TSIM/1000 TO TSIM/10000 (START
*  WITH TSIM/4000) BUT NEVER EXCEED ABOUT 50 NANOSECONDS.
*  DO NOT HESITATE TO EXPERIMENT WITH TMAX AS SETTING IT
*  TOO LONG OR SHORT CAN CAUSE EITHER EXECUTION TIMES THAT
*  ARE 20X NORMAL OR EVEN SIMULATION ERRORS.
*
*  YOU CAN VERIFY WHEN YOU HAVE THE ANALYSIS OPTIONS IN A
*  GOOD RANGE BY WATCHING THE CLKOUT PIN FOR 100 CYCLES
*  OR SO AND OBSERVING THAT IT IS REPEATABLE FROM CYCLE
*  TO CYCLE.
*
*  INTERNAL LOGIC WILL NOT BE STABILIZED FOR A TIME
*  THAT IS 2 MICROSECONDS PLUS AT LEAST ONE HALF TO
*  ONE CLOCK PERIOD.
*
* END NOTES
* PINOUT ORDER RROSC CLKOUT CLKIN GND CLK/2OUT +5
* PINOUT ORDER   1      2     3    4     5      6
.SUBCKT MSAOSC 1 2 3 4 5 6
 M77 2 7 6 6 MCPO
 M78 2 7 4 4 MCNO
 E22 8 9 10 11 1
 E23 9 4 6 4 0.5
 R113 0 9 1E9
 R114 0 9 1E9
 C47 7 12 1.8E-12
 R115 7 8 1E3
 E24 12 4 2 4 1
 R116 12 7 1E5
 M79 10 13 14 14 MCI
 M80 15 16 14 14 MCI
 I10 14 4 50E-6
 M81 15 15 17 17 MCP
 M82 10 10 17 17 MCP
 R117 15 10 1E7
 V74 17 6 1.5
 M83 18 15 17 17 MCP
 M84 11 10 17 17 MCP
 M85 18 18 19 19 MCN
 M86 18 11 19 19 MCC
 M87 11 18 19 19 MCC
 M88 11 11 19 19 MCN
 M89 19 19 4 4 MCN
 R118 13 6 1E4
 R119 4 13 1E4
 C48 13 4 220E-12
 R120 2 13 7500
 C49 16 4 2200E-12
 R123 1 16 2550
 M90 20 21 4 4 MN
 M91 20 22 4 4 MN
 M92 20 21 23 24 MP
 M93 23 22 24 24 MP
 M94 21 25 4 4 MN
 M95 21 20 4 4 MN
 M96 21 25 26 24 MP
 M97 26 20 24 24 MP
 M98 25 27 4 4 MN
 M99 25 28 4 4 MN
 M100 25 27 29 24 MP
 M101 29 28 24 24 MP
 M102 27 28 4 4 MN
 M103 27 30 4 4 MN
 M104 27 28 31 24 MP
 M105 31 30 24 24 MP
 M106 32 27 4 4 MN
 M107 32 20 4 4 MN
 M108 32 27 33 24 MP
 M109 33 20 24 24 MP
 M110 34 22 24 24 MP
 M111 34 22 4 4 MN
 M112 35 20 24 24 MP
 M113 35 20 4 4 MN
 M114 36 25 24 24 MP
 M115 36 25 4 4 MN
 M116 28 37 24 24 MP
 M117 28 37 4 4 MN
 M118 37 34 24 24 MP
 M119 37 35 24 24 MP
 M120 37 36 24 24 MP
 M121 37 34 38 4 MN
 M122 38 35 39 4 MN
 M123 39 36 4 4 MN
 C51 28 4 1E-12
 M124 40 32 24 24 MPO
 M125 41 32 4 4 MNO
 R125 5 40 60
 R126 41 5 20
 R127 4 5 1E5
 C52 5 4 3E-12
 R128 3 22 1E3
 C53 4 22 47E-12
 M126 16 42 4 4 MCNO
 V76 42 4 5 PULSE 5 0 1U 1U 1U 100 200
 M127 22 42 4 4 MCNO
 R129 30 32 1E4
 M128 30 42 4 4 MCNO
 V77 24 4 0 PULSE 0 5 0 1U 1U 100 200
 R131 4 22 1E9
.MODEL MCI NMOS KP=8600U VTO=2
.MODEL MCC NMOS KP=300U VTO=2
.MODEL MCN NMOS KP=200U VTO=2
.MODEL MCP PMOS KP=200U VTO=-2
.MODEL MCNO NMOS KP=20000U VTO=2
.MODEL MCPO PMOS KP=20000U VTO=-2
.MODEL MN NMOS CBD=4P CBS=4P
+ IS=30F KP=2M UO=600 VTO=3
.MODEL MP PMOS CBD=4P CBS=4P
+ IS=30F KP=2M UO=600 VTO=-3
.MODEL MNO NMOS CBD=4P CBS=4P
+ IS=30F KP=12M UO=600 VTO=3
.MODEL MPO PMOS CBD=4P CBS=4P
+ IS=30F KP=8M UO=600 VTO=-3
.ENDS
* END MODEL MSA240 MSA260 OSC

* BEGIN MODEL SA305 FOR PSPICE-DERIVED SIMULATORS
*
*  REQUIRES PSPICE 4.04 OR LATER
*
*   MODEL FEATURES INCLUDE:
*
*    1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*    2 OUTPUT RESISTANCE AND CAPACITANCE
*    3 ACCURATE CATCH DIODE I V CHARACTERISTIC
*    4 ACCURATE RON TEMPERATURE COEFFICIENT
*    5 CURRENT LIMIT FOR UPPER SWITCHES
*    6 CURRENT MONITOR ON UPPER SWITCHES
*    7 SHORT CIRCUIT DETECTION
*    8 FAULT LATCH WITH FAULT OUTPUT
*    9 DISABLE INPUT
*   10 OFF INPUT
*   11 SEPARATE SMALL SIGNAL AND POWER GROUNDS
*   12 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*
*   NOTE: THERMAL SHUTDOWN/WARNING IS NOT MODELED
*
* SOME NOTES ON USING SPICE FOR PULSE SIMULATION
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  MODEL TRACKS THE DATA SHEET OVER THE -40 TO +85 C
*  TEMP RANGE AND IS FUNCTIONAL FROM -55 TO +150 C
*
*  TO MAKE SURE THE INTERNAL FAULT FLOP STARTS OUT RESET,
*  PUT A PULSE SOURCE ON THE DISABLE PIN WITH A DC VALUE
*  OF 5 VOLTS THAT IS INITIALLY AT 5 VOLTS AND THEN DROPS
*  TO 0 VOLTS AFTER A COUPLE OF MICROSECONDS.
*
*  IF YOUR SIMULATOR SUPPORTS THE LVLTIM OPTION YOU
*  WILL GET 1.3X TO 1.5X FASTER EXECUTION WITH LVLTIM=1,
*  WHERE THE DEFAULT FOR MOST SIMULATORS IS 2. USING
*  LVLTIM=1 WILL CAUSE ACCURACY PROBLEMS ABOUT 5% OF
*  THE TIME, SO USE THIS WITH CAUTION. IF YOU ARE USING
*  A VERY RECENT SIMULATOR YOU WILL JUST WANT TO USE
*  THE DEFAULT OF 2.
*
*  SOME OLDER SIMULATORS REQUIRE THE OPTION TRTOL
*  BE SET TO 10000 AND ITL4 SET TO AT LEAST 100 AND
*  AS HIGH AS 2000.
*
*  THIS MODEL IS LARGE ENOUGH THAT MOST DOS SIMULATORS
*  WILL RUN OUT OF MEMORY.
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 1000, INCREASE
*  TRTOL TO 10000, INCREASE RELTOL TO 0.003 TO 0.01,
*  INCREASE ABSTOL TO 1E-11 TO 1E-9, INCREASE GMIN TO
*  1E-11 TO 1E-7, INCREASE VNTOL TO 1E-5 TO 1E-4, OR
*  INCREASE CHGTOL TO 1E-11 TO 1E-9. ANY OR ALL OF THESE
*  SIMULATOR OPTIONS MAY BE REQUIRED DEPENDING ON YOUR
*  SIMULATOR. NEWER SIMULATORS USUALLY REQUIRE FEWER OR
*  NONE OF THEM.
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 500.
*
*  ACCURACY MAY BE INCREASED AND SIMULATION TIME MAY BE
*  DECREASED WITH THE PROPER SELECTION OF THE TIMESTEP
*  MAXIMUM (TMAX) PARAMETER IN THE TRAN LINE. THIS IS THE
*  FOURTH PARAMETER ON THAT LINE AND IS OPTIONAL LIKE THE
*  TSTART PARAMETER (THIRD TIME PARAMETER ON THAT LINE).
*  IF YOU ARE NOT USING TSTART YOU MUST SET IT TO ZERO SO
*  THE SIMULATOR WILL RECOGNIZE TMAX AS TMAX RATHER THAN
*  TSTART. SPICE USES A DEFAULT OF TSTOP/100, YOU WILL
*  WANT TO USE MORE LIKE TSTOP/1000 TO TSTOP/10000 (START
*  WITH TSTOP/4000) BUT NEVER EXCEED ABOUT 50 NANOSECONDS.
*  DO NOT HESITATE TO EXPERIMENT WITH TMAX AS SETTING IT
*  TOO LONG OR SHORT CAN CAUSE EITHER EXECUTION TIMES THAT
*  ARE 20X NORMAL OR EVEN SIMULATION ERRORS.
*
*  THE DRIVE INPUTS HAVE HYSTERESIS WHICH SLOWS THE
*  SIMULATION A BIT. RUNNING THE INPUTS WITH A LARGE
*  SWING (IE 0 TO 5 VOLTS) AND/OR A SHORT RISETIME
*  (10 NS) WILL SPEED THE SIMULATION ON SOME OLDER
*  SIMULATORS BY AS MUCH AS 1.7X AS COMPARED TO FOR
*  INSTANCE 0.8 TO 1.8 VOLTS WITH 100 NS RISETIME.
*  THIS WILL VARY WITH TOTAL TSIM AND THE OPTIMUM
*  RISETIME MAY INCREASE FOR LONG TSIM. ON MIDDLE-
*  AGE AND NEWER SIMULATORS THE ABOVE SIMULATION
*  TIME RATIO AVERAGES 1.24X.
*
*  THE USABLE RANGE FOR RESISTANCE TO GROUND FROM EACH
*  OF THE GROUND PINS IS 1 MICRO-OHM TO 100 MILLOHMS.
*  IF YOU ARE NOT SURE WHAT YOUR RESISTANCES ARE USE
*  1 MILLI-OHM FOR BOTH.
*
*  IGNORE ANY WARNINGS CONCERNING X1.R280
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PULSE
*  RATE PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, USE THE "UIC" SPECIFIER
*  TO SKIP THAT STEP. AT THE SAME TIME YOU WILL WANT TO
*  PUT A PULSE SOURCE ON THE DISABLE PIN THAT IS INITIALLY
*  AT 5 VOLTS AND THEN DROPS TO 0 VOLTS AFTER A COUPLE OF
*  MICROSECONDS.
*
* PINOUT ORDER PGND OUTC IMONB IMONC LOC HIC FLT OFF VPWR
*                1    2    3     4    5   7   8    9  10
*              SGND HIB OUTB LOB LOA HIA VDD DIS IMONA OUTA
*               11   12  13   14  15  16  17  19   20   22
*
.SUBCKT SA305 1 2 3 4 5 7 8 9 10 11 12 13 14 15 16 17 19 20 22
R84 49 50 1.01E6
M31 51 19 11 11 NL
C39 50 11 165E-15
E27 52 11 43 11 -1
R85 11 52 1E9
V27 53 52 5
R86 11 53 1E9
R87 11 43 1E9
E28 54 11 42 11 -1
R88 11 54 1E9
V29 55 54 5
R89 11 55 1E9
R90 11 42 1E9
M32 51 48 11 11 NL
R91 51 17 1E6
M33 56 57 11 11 NL
M34 56 49 11 11 NL
R92 56 17 1E6
M35 56 58 11 11 NL
M36 59 60 11 11 NL
M37 59 61 11 11 NL
R93 59 17 1E6
M38 59 51 11 11 NL
M39 58 19 11 11 NL
M40 58 48 11 11 NL
R94 58 17 1E6
E29 62 11 51 11 -1
R95 11 49 1E9
R96 11 51 1E9
E30 63 11 58 11 -1
R97 11 61 1E9
R98 11 58 1E9
R101 61 64 1.01E6
C40 64 11 165E-15
M41 57 65 11 11 NL
M42 57 66 11 11 NL
R104 57 17 1E6
M43 60 67 11 11 NL
M44 60 68 11 11 NL
R105 60 17 1E6
M45 65 49 11 11 NL
M46 65 67 11 11 NL
R106 65 17 1E6
M47 68 61 11 11 NL
M48 68 66 11 11 NL
R107 68 17 1E6
V32 49 62 5
V33 61 63 5
R108 11 62 1E9
R109 11 63 1E9
M49 67 64 11 11 NL
M50 66 50 11 11 NL
R110 66 17 1E6
R111 67 17 1E6
S1 10 69 56 11 SWU
V34 69 70 0
R112 22 70 R1M 0.315
D1 22 10 DPC
C41 71 22 120E-12
R113 71 10 0.1
S2 22 72 59 11 SWL
V35 72 73 0
R114 1 73 R1M 0.23
D2 1 22 DNC
C42 74 1 60E-12
R115 74 22 0.1
F1 75 11 V34 240.6E-6
M51 20 75 17 17 PM
M52 75 75 17 17 PM
R117 75 17 1E8
M53 76 77 11 11 NL
M54 76 77 17 17 PM
M55 78 78 11 11 NL
M56 79 78 11 11 NL
M57 79 75 17 17 PM
I1 0 78 3E-3
M58 80 76 17 17 PM
M59 80 76 11 11 NL
E31 77 79 27 11 -0.07
C43 79 11 5E-12
E32 81 11 56 11 -1
R125 11 82 1E9
R126 11 56 1E9
V41 82 81 5
R127 11 81 1E9
E33 83 11 59 11 -1
R128 11 84 1E9
R129 11 59 1E9
V42 84 83 5
R130 11 83 1E9
M64 85 86 11 11 NL
M65 85 82 11 11 NL
R131 85 17 1E6
M66 87 88 11 11 NL
M67 87 84 11 11 NL
R132 87 17 1E6
M68 88 89 11 11 NL
M69 88 89 17 17 PM
M70 86 88 17 17 PM
M71 86 88 11 11 NL
R133 22 89 104E3
D35 89 17 DD
D36 89 90 DD
R134 90 1 104E3
M78 91 92 93 93 NT L=3U W=3U
M79 93 92 11 11 NT L=3U W=3U
M80 94 92 95 95 PT L=3U W=3U
M81 91 92 94 94 PT L=3U W=3U
M82 42 91 11 11 NT L=3U W=3U
M83 95 91 93 93 NT L=3U W=0.4U
M84 42 91 95 95 PT L=3U W=3U
M85 11 91 94 94 PT L=3U W=2U
C48 91 42 1E-13
M86 96 97 98 98 NT L=3U W=3U
M87 98 97 11 11 NT L=3U W=3U
M88 99 97 95 95 PT L=3U W=3U
M89 96 97 99 99 PT L=3U W=3U
M90 43 96 11 11 NT L=3U W=3U
M91 95 96 98 98 NT L=3U W=0.4U
M92 43 96 95 95 PT L=3U W=3U
M93 11 96 99 99 PT L=3U W=2U
C49 96 43 1E-13
M94 51 53 11 11 NL
M95 58 55 11 11 NL
M96 33 9 11 11 NL
M97 34 9 11 11 NL
R150 80 35 10E6
M98 35 9 11 11 NL
R151 33 87 10E6
R152 34 85 10E6
E36 100 92 27 11 -0.2
E37 101 97 27 11 -0.2
V48 95 11 5
R156 102 103 1.01E6
M99 104 19 11 11 NL
C50 103 11 165E-15
E38 105 11 45 11 -1
R157 11 105 1E9
V50 106 105 5
R158 11 106 1E9
R159 11 45 1E9
E39 107 11 44 11 -1
R160 11 107 1E9
V52 108 107 5
R161 11 108 1E9
R162 11 44 1E9
M100 104 48 11 11 NL
R163 104 17 1E6
M101 109 110 11 11 NL
M102 109 102 11 11 NL
R164 109 17 1E6
M103 109 111 11 11 NL
M104 112 113 11 11 NL
M105 112 114 11 11 NL
R165 112 17 1E6
M106 112 104 11 11 NL
M107 111 19 11 11 NL
M108 111 48 11 11 NL
R166 111 17 1E6
E40 115 11 104 11 -1
R167 11 102 1E9
R168 11 104 1E9
E41 116 11 111 11 -1
R169 11 114 1E9
R170 11 111 1E9
R171 114 117 1.01E6
C51 117 11 165E-15
M109 110 118 11 11 NL
M110 110 119 11 11 NL
R172 110 17 1E6
M111 113 120 11 11 NL
M112 113 121 11 11 NL
R173 113 17 1E6
M113 118 102 11 11 NL
M114 118 120 11 11 NL
R174 118 17 1E6
M115 121 114 11 11 NL
M116 121 119 11 11 NL
R175 121 17 1E6
V54 102 115 5
V55 114 116 5
R176 11 115 1E9
R177 11 116 1E9
M117 120 117 11 11 NL
M118 119 103 11 11 NL
R178 119 17 1E6
R179 120 17 1E6
S5 10 122 109 11 SWU
V56 122 123 0
R180 2 123 R1M 0.315
D38 2 10 DPC
C52 124 2 120E-12
R181 124 10 0.1
S6 2 125 112 11 SWL
V57 125 126 0
R182 1 126 R1M 0.23
D39 1 2 DNC
C53 127 1 60E-12
R183 127 2 0.1
F2 128 11 V56 261.5E-6
M119 4 128 17 17 PM
M120 128 128 17 17 PM
R185 128 17 1E8
M121 129 130 11 11 NL
M122 129 130 17 17 PM
M123 131 131 11 11 NL
M124 132 131 11 11 NL
M125 132 128 17 17 PM
I37 0 131 3E-3
M126 133 129 17 17 PM
M127 133 129 11 11 NL
E42 130 132 27 11 -0.07
C54 132 11 5E-12
E43 134 11 109 11 -1
R188 11 135 1E9
R189 11 109 1E9
V61 135 134 5
R190 11 134 1E9
E44 136 11 112 11 -1
R191 11 137 1E9
R192 11 112 1E9
V62 137 136 5
R193 11 136 1E9
M128 138 139 11 11 NL
M129 138 135 11 11 NL
R194 138 17 1E6
M130 140 141 11 11 NL
M131 140 137 11 11 NL
R195 140 17 1E6
M132 141 142 11 11 NL
M133 141 142 17 17 PM
M134 139 141 17 17 PM
M135 139 141 11 11 NL
R196 2 142 104E3
D40 142 17 DD
D41 142 143 DD
R197 143 1 104E3
M136 144 145 146 146 NT L=3U W=3U
M137 146 145 11 11 NT L=3U W=3U
M138 147 145 148 148 PT L=3U W=3U
M139 144 145 147 147 PT L=3U W=3U
M140 44 144 11 11 NT L=3U W=3U
M141 148 144 146 146 NT L=3U W=0.4U
M142 44 144 148 148 PT L=3U W=3U
M143 11 144 147 147 PT L=3U W=2U
C55 144 44 1E-13
M144 149 150 151 151 NT L=3U W=3U
M145 151 150 11 11 NT L=3U W=3U
M146 152 150 148 148 PT L=3U W=3U
M147 149 150 152 152 PT L=3U W=3U
M148 45 149 11 11 NT L=3U W=3U
M149 148 149 151 151 NT L=3U W=0.4U
M150 45 149 148 148 PT L=3U W=3U
M151 11 149 152 152 PT L=3U W=2U
C56 149 45 1E-13
M152 104 106 11 11 NL
M153 111 108 11 11 NL
M154 39 9 11 11 NL
M155 40 9 11 11 NL
R201 133 41 10E6
M156 41 9 11 11 NL
R202 39 140 10E6
R203 40 138 10E6
E45 153 145 27 11 -0.2
E46 154 150 27 11 -0.2
V66 148 11 5
R207 155 156 1.01E6
M157 157 19 11 11 NL
C57 156 11 165E-15
E47 158 11 47 11 -1
R208 11 158 1E9
V68 159 158 5
R209 11 159 1E9
R210 11 47 1E9
E48 160 11 46 11 -1
R211 11 160 1E9
V70 161 160 5
R212 11 161 1E9
R213 11 46 1E9
M158 157 48 11 11 NL
R214 157 17 1E6
M159 162 163 11 11 NL
M160 162 155 11 11 NL
R215 162 17 1E6
M161 162 164 11 11 NL
M162 165 166 11 11 NL
M163 165 167 11 11 NL
R216 165 17 1E6
M164 165 157 11 11 NL
M165 164 19 11 11 NL
M166 164 48 11 11 NL
R217 164 17 1E6
E49 168 11 157 11 -1
R218 11 155 1E9
R219 11 157 1E9
E50 169 11 164 11 -1
R220 11 167 1E9
R221 11 164 1E9
R222 167 170 1.01E6
C58 170 11 165E-15
M167 163 171 11 11 NL
M168 163 172 11 11 NL
R223 163 17 1E6
M169 166 173 11 11 NL
M170 166 174 11 11 NL
R224 166 17 1E6
M171 171 155 11 11 NL
M172 171 173 11 11 NL
R225 171 17 1E6
M173 174 167 11 11 NL
M174 174 172 11 11 NL
R226 174 17 1E6
V72 155 168 5
V73 167 169 5
R227 11 168 1E9
R228 11 169 1E9
M175 173 170 11 11 NL
M176 172 156 11 11 NL
R229 172 17 1E6
R230 173 17 1E6
S9 10 175 162 11 SWU
V74 175 176 0
R231 13 176 R1M 0.315
D43 13 10 DPC
C59 177 13 120E-12
R232 177 10 0.1
S10 13 178 165 11 SWL
V75 178 179 0
R233 1 179 R1M 0.23
D44 1 13 DNC
C60 180 1 60E-12
R234 180 13 0.1
F3 181 11 V74 291.0E-6
M177 3 181 17 17 PM
M178 181 181 17 17 PM
R236 181 17 1E8
M179 182 183 11 11 NL
M180 182 183 17 17 PM
M181 184 184 11 11 NL
M182 185 184 11 11 NL
M183 185 181 17 17 PM
I39 0 184 3E-3
M184 186 182 17 17 PM
M185 186 182 11 11 NL
E51 183 185 27 11 -0.07
C61 185 11 5E-12
E52 187 11 162 11 -1
R239 11 188 1E9
R240 11 162 1E9
V79 188 187 5
R241 11 187 1E9
E53 189 11 165 11 -1
R242 11 190 1E9
R243 11 165 1E9
V80 190 189 5
R244 11 189 1E9
M186 191 192 11 11 NL
M187 191 188 11 11 NL
R245 191 17 1E6
M188 193 194 11 11 NL
M189 193 190 11 11 NL
R246 193 17 1E6
M190 194 195 11 11 NL
M191 194 195 17 17 PM
M192 192 194 17 17 PM
M193 192 194 11 11 NL
R247 13 195 104E3
D45 195 17 DD
D46 195 196 DD
R248 196 1 104E3
M194 197 198 199 199 NT L=3U W=3U
M195 199 198 11 11 NT L=3U W=3U
M196 200 198 201 201 PT L=3U W=3U
M197 197 198 200 200 PT L=3U W=3U
M198 46 197 11 11 NT L=3U W=3U
M199 201 197 199 199 NT L=3U W=0.4U
M200 46 197 201 201 PT L=3U W=3U
M201 11 197 200 200 PT L=3U W=2U
C62 197 46 1E-13
M202 202 203 204 204 NT L=3U W=3U
M203 204 203 11 11 NT L=3U W=3U
M204 205 203 201 201 PT L=3U W=3U
M205 202 203 205 205 PT L=3U W=3U
M206 47 202 11 11 NT L=3U W=3U
M207 201 202 204 204 NT L=3U W=0.4U
M208 47 202 201 201 PT L=3U W=3U
M209 11 202 205 205 PT L=3U W=2U
C63 202 47 1E-13
M210 157 159 11 11 NL
M211 164 161 11 11 NL
M212 36 9 11 11 NL
M213 37 9 11 11 NL
R252 186 38 10E6
M214 38 9 11 11 NL
R253 36 193 10E6
R254 37 191 10E6
E54 206 198 27 11 -0.2
E55 207 203 27 11 -0.2
V84 201 11 5
M215 48 19 208 208 NL
M216 48 209 208 208 NL
R258 48 17 1E6
M217 209 48 208 208 NL
M218 209 33 208 208 NL
R259 209 17 0.99E6
C64 17 48 0.1E-12
C65 17 209 0.1E-12
M219 209 34 208 208 NL
M220 209 35 208 208 NL
M221 210 211 208 208 NL
M222 210 211 17 17 PM
D48 212 208 DD
V87 212 27 0.655
R260 208 27 1.01E6
I41 208 212 1E-3
R261 208 212 1.01E6
E56 211 213 27 208 -0.07
C66 213 208 5E-12
R262 10 213 100E3
R263 213 1 27.25E3
M223 214 215 208 208 NL
M224 214 215 216 216 PM
E57 215 217 27 208 -0.07
C67 217 208 5E-12
R264 17 217 100E3
R265 217 208 133E3
V88 216 208 5
M225 209 210 208 208 NL
M226 209 214 208 208 NL
M227 8 209 208 208 NL
M228 8 209 17 17 PM
R266 208 27 1.01E6
M229 209 36 208 208 NL
M230 209 37 208 208 NL
M231 209 38 208 208 NL
M232 209 39 208 208 NL
M233 209 40 208 208 NL
M234 209 41 208 208 NL
D49 30 218 DVC
D50 30 218 DZC
D51 218 17 DZC
R268 15 218 21E3
D52 30 100 DVC
D53 30 100 DZC
D54 100 17 DZC
R269 218 100 2.4E3
D55 30 219 DVC
D56 30 219 DZC
D57 219 17 DZC
R270 16 219 21E3
D58 30 101 DVC
D59 30 101 DZC
D60 101 17 DZC
R271 219 101 2.4E3
D61 30 220 DVC
D62 30 220 DZC
D63 220 17 DZC
R272 5 220 21E3
D64 30 153 DVC
D65 30 153 DZC
D66 153 17 DZC
R273 220 153 2.4E3
D67 30 221 DVC
D68 30 221 DZC
D69 221 17 DZC
R274 7 221 21E3
D70 30 154 DVC
D71 30 154 DZC
D72 154 17 DZC
R275 221 154 2.4E3
D73 30 222 DVC
D74 30 222 DZC
D75 222 17 DZC
R276 14 222 21E3
D76 30 206 DVC
D77 30 206 DZC
D78 206 17 DZC
R277 222 206 2.4E3
D79 30 223 DVC
D80 30 223 DZC
D81 223 17 DZC
R278 12 223 21E3
D82 30 207 DVC
D83 30 207 DZC
D84 207 17 DZC
R279 223 207 2.4E3
D85 30 4 DVC
D86 30 4 DZC
D87 4 17 DZC
D88 30 20 DVC
D89 30 20 DZC
D90 20 17 DZC
D91 30 3 DVC
D92 30 3 DZC
D93 3 17 DZC
D94 30 8 DVC
D95 30 8 DZC
D96 8 17 DZC
R280 11 30 1N
I42 17 11 4E-3
I43 10 1 4.6E-3
R284 10 1 52.65E3
G1 10 1 27 208 -13.8E-3
S14 224 225 42 11 SWI
S15 225 226 43 11 SWI
C71 227 226 3.45E-9
R286 224 228 0.1
R287 225 227 10
R288 228 229 1E4
R289 224 230 1E4
C72 229 230 10E-12
G3 10 1 229 230 10
E59 228 0 10 0 1
E60 226 0 1 0 1
S16 231 232 46 11 SWI
S17 232 233 47 11 SWI
C73 234 233 3.45E-9
R290 231 235 0.1
R291 232 234 10
R292 235 236 1E4
R293 231 237 1E4
C74 236 237 10E-12
G4 10 1 236 237 10
E61 235 0 10 0 1
E62 233 0 1 0 1
S18 238 239 44 11 SWI
S19 239 240 45 11 SWI
C75 241 240 3.45E-9
R294 238 242 0.1
R295 239 241 10
R296 242 243 1E4
R297 238 244 1E4
C76 243 244 10E-12
G5 10 1 243 244 10
E63 242 0 10 0 1
E64 240 0 1 0 1
G6 75 11 245 11 6.85E-6
G7 181 11 246 11 6.75E-6
G8 128 11 247 11 9.25E-6
D97 11 245 DZR
R298 245 248 1E4
E65 248 11 56 11 1
D98 11 246 DZR
R299 246 249 1E4
E66 249 11 162 11 1
D99 11 247 DZR
R300 247 250 1E4
E67 250 11 109 11 1
R301 91 95 1E6
R302 11 91 1E6
R303 96 95 1E6
R304 11 96 1E6
R305 144 148 1E6
R306 11 144 1E6
R307 149 148 1E6
R308 11 149 1E6
R309 197 201 1E6
R310 11 197 1E6
R311 11 202 1E6
R312 202 201 1E6
R313 94 95 1E5
R314 11 93 1E5
R315 99 95 1E5
R316 11 98 1E5
R317 147 148 1E5
R318 11 146 1E5
R319 152 148 1E5
R320 11 151 1E5
R321 200 201 1E5
R322 11 199 1E5
R323 205 201 1E5
R324 11 204 1E5
E68 251 0 11 0 1
R325 208 251 1
C77 208 0 0.2E-6
R326 0 11 1E9
R327 11 78 1E12
R328 11 131 1E12
R329 11 184 1E12
.MODEL R1M RES TC1=3.082E-3 TC2=8.123E-6
.MODEL DVC D RS=0.01 CJO=0.1P TT=1N
.MODEL DZC D RS=0.01 CJO=0.1P TT=1N BV=10.3 IBV=1E-3
.MODEL DZR D RS=0.01 CJO=0.1P TT=1N BV=4.02 IBV=0.1E-3
.MODEL NT NMOS VTO=0.35 KP=200U
.MODEL PT PMOS VTO=-1.8 KP=50U
.MODEL NL NMOS VTO=1 KP=200U
.MODEL SWU VSWITCH RON=0.01 ROFF=1E5 VON=2.7 VOFF=2.3
.MODEL SWL VSWITCH RON=0.01 ROFF=1E5 VON=2.7 VOFF=2.3
.MODEL PM PMOS VTO=-1 KP=200U
.MODEL DD D
.MODEL SWI VSWITCH RON=0.01 ROFF=1E6 VON=2.7 VOFF=2.3
.MODEL DNC D RS=0.103 CJO=1P TT=10N IS=7.527E-13
.MODEL DPC D RS=0.108 CJO=1P TT=10N IS=8.573E-13
.ENDS
* END MODEL SA305

***************
* REVISION 1 31 AUGUST 2006 INITIAL RELEASE
* BEGIN SA56 MODEL FOR PSPICE-DERIVED SIMULATORS
*  REQUIRES PSPICE 5.1 OR LATER
*
*   MODEL FEATURES INCLUDE:
*
*    1 PULSE BY PULSE TIME DOMAIN PERFORMANCE
*    2 OUTPUT RESISTANCE AND CAPACITANCE
*    3 ACCURATE CATCH DIODE I V CHARACTERISTIC
*    4 ACCURATE RON TEMPERATURE COEFFICIENT
*    5 ACCURATE DEAD TIME BETWEEN OUTPUTS
*    6 SUPPORTS ALL FOUR MODES OF OPERATION
*    7 SUPPORTS THE ISEN/ILIM FUNCTION
*    8 SUPPORTS THE DISABLE PIN
*    9 SUPPORTS THE DIRECTION PIN
*   10 SUPPORTS THE PWM PIN
*   11 SUPPORTS THE CPWM PIN / INTERNAL OSCILLATOR
*   12 ACCURATE OSCILLATOR FREQUENCY VS CPWM
*   13 VREF OUTPUT PIN WITH OUTPUT IMPEDANCE,
*      ASYMMETRICAL DRIVE, AND TEMP COEFFICIENT
*   14 SEPARATE SMALL SIGNAL AND POWER GROUNDS
*   15 INCREASING IQ ON THE VS SUPPLY VS FREQUENCY
*
*   NOTE: THERMAL SHUTDOWN/WARNING IS NOT MODELED
*   NOTE: SHORT CIRCUIT PROTECTION IS NOT MODELED
*
*  MODEL TRACKS THE DATA SHEET OVER THE -40 TO +85 C
*  TEMP RANGE AND IS FUNCTIONAL FROM -55 TO +150 C
*
* BEGIN NOTES
*
*  BE PREPARED FOR LONG SIMULATIONS
*
*  IF YOUR SIMULATOR SUPPORTS THE LVLTIM OPTION YOU
*  WILL GET 1.3X TO 1.5X FASTER EXECUTION WITH LVLTIM=1,
*  WHERE THE DEFAULT FOR MOST SIMULATORS IS 2. USING
*  LVLTIM=1 WILL CAUSE ACCURACY PROBLEMS ABOUT 5% OF
*  THE TIME, SO USE THIS WITH CAUTION. IF YOU ARE USING
*  A VERY RECENT SIMULATOR YOU WILL JUST WANT TO USE
*  THE DEFAULT OF 2.
*
*  SOME OLDER SIMULATORS REQUIRE THE OPTION TRTOL
*  BE SET TO 10000 AND ITL4 SET TO AT LEAST 100 AND
*  AS HIGH AS 2000.
*
*  THIS MODEL IS LARGE ENOUGH THAT MOST DOS SIMULATORS
*  WILL RUN OUT OF MEMORY.
*
*  IF YOUR SIMULATION STOPS DUE TO "TIMESTEP TOO SMALL"
*  ERRORS YOU MAY WANT TO INCREASE ITL4 TO 1000, INCREASE
*  TRTOL TO 10000, INCREASE RELTOL TO 0.003 TO 0.01,
*  INCREASE ABSTOL TO 1E-11 TO 1E-9, INCREASE GMIN TO
*  1E-11 TO 1E-9, INCREASE VNTOL TO 1E-5 OR 1E-4, OR
*  INCREASE CHGTOL TO 1E-11 TO 1E-10. ANY OR ALL OF THESE
*  SIMULATOR OPTIONS MAY BE REQUIRED DEPENDING ON YOUR
*  SIMULATOR. NEWER SIMULATORS USUALLY REQUIRE FEWER OR
*  NONE OF THEM.
*
*  TO AID THE INITIAL DC CONVERGANCE SET ITL1 TO 2000.
*
*  ACCURACY MAY BE INCREASED AND SIMULATION TIME MAY BE
*  DECREASED WITH THE PROPER SELECTION OF THE TIMESTEP
*  MAXIMUM (TMAX) PARAMETER IN THE TRAN LINE. THIS IS THE
*  FOURTH PARAMETER ON THAT LINE AND IS OPTIONAL LIKE THE
*  TSTART PARAMETER (THIRD TIME PARAMETER ON THAT LINE).
*  IF YOU ARE NOT USING TSTART YOU MUST SET IT TO ZERO SO
*  THE SIMULATOR WILL RECOGNIZE TMAX AS TMAX RATHER THAN
*  TSTART. SPICE USES A DEFAULT OF TSIM/100, YOU WILL
*  WANT TO USE MORE LIKE TSIM/1000 TO TSIM/10000 (START
*  WITH TSIM/4000) BUT NEVER EXCEED ABOUT 50 NANOSECONDS.
*  DO NOT HESITATE TO EXPERIMENT WITH TMAX AS SETTING IT
*  TOO LONG OR SHORT CAN CAUSE EITHER EXECUTION TIMES THAT
*  ARE 20X NORMAL OR EVEN SIMULATION ERRORS.
*
*  ONE GUIDE TO KNOWING IF TMAX IS SMALL ENOUGH IF YOU
*  ARE USING THE INTERNAL OSCILLATOR IS TO WATCH THE
*  CPWM PIN. IT SHOULD BE A TRIANGLE BETWEEN VERY CLOSE
*  TO 1 AND VERY CLOSE TO 4 VOLTS. IF THE AMPLITUDE IS
*  WRONG OR NOT REPEATABLE FROM CYCLE TO CYCLE YOU NEED
*  TO REDUCE TMAX AND/OR TSTEP. BE CAREFUL YOU ARE NOT
*  SEEING ALIASING IN YOUR SCOPE DISPLAY FROM TSTEP
*  TOO LARGE.
*
*  IF YOU ARE USING THE INTERNAL OSCILLATOR YOU MAY SPEED
*  UP YOUR ANALYSIS BY AS MUCH AS 4:1 BY USING YOUR OWN
*  EXTERNAL TRIANGLE GENERATOR TO DRIVE THE CPWM PIN. IF
*  THE AMPLITUDE IS SET VLOW=1.01 VOLT AND VHIGH=3.99
*  VOLT, THE INTERNAL OSCILLATOR SUPPORT CIRCUITS WILL
*  NOT TOGGLE, REDUCING THE COMPUTATIONAL BURDEN AND
*  USUALLY ALLOWING YOU TO USE A LONGER TSTEP AND/OR
*  TMAX WITHOUT LOSING AS MUCH ACCURACY AS YOU WOULD
*  OTHERWISE.
*
*  IF YOU ARE USING THE INTERNAL OSCILLATOR OR AN
*  EXTERNAL TRIANGLE ON THE CPWM PIN, NOTE THAT THE
*  INTERNAL LOGIC WILL NOT BE STABILIZED FOR A TIME
*  THAT IS 1.5 MICROSECONDS PLUS AT LEAST 1/2 OF
*  THE CLOCK PERIOD.
*
*  TO MAKE SURE THE INTERNAL I LIMIT FLOP STARTS OUT
*  RESET, PUT A PULSE SOURCE ON THE DISABLE PIN WITH
*  A DC VALUE OF 5 VOLTS, INITIAL V OF 5 VOLTS,
*  PULSED V OF 0 VOLTS, DELAY OF 0.3 MICROSECONDS,
*  RISE AND FALL TIMES OF 0.1 MICROSECONDS, A VERY
*  LONG DURATION (1000 SECONDS), AND A VERY LONG
*  PERIOD (2000 SECONDS).
*
*  THE USABLE RANGE FOR RESISTANCE TO GROUND FROM THE
*  POWER GROUND PIN IS ZERO TO 100 MILLOHMS. NORMALLY
*  YOU WILL WANT TO JUST CONNECT THE POWER GROUND PIN
*  DIRECTLY TO SPICE GROUND.
*
*  THE SIGNAL GROUND PIN SHOULD ALWAYS BE CONNECTED
*  DIRECTLY TO SPICE GROUND.
*
*  THE MODEL WILL CURRENT LIMIT ON A CYCLE BY CYCLE
*  BASIS IF EITHER OF TWO CONDITIONS ARE MET. THE
*  FIRST IS A VOLTAGE OF MORE THAN 2.75 VOLTS ON
*  THE ISEN/ILIM PIN. THE SECOND IS IF MORE THAN
*  12.5 AMPS FLOW IN EITHER OF THE TOP SIDE FETS.
*
*  BECAUSE THE SPICE OUTPUT DATA IS A SAMPLED SYSTEM,
*  ALIASING CAN TAKE PLACE. IF THE WAVEFORM YOU ARE
*  LOOKING AT IS REPETATIVE BUT SEEMS TO HAVE INADEQUATE
*  P-P AMPLITUDE, YOU MAY WANT TO SAMPLE THE DATA MORE
*  OFTEN OR CHANGE THE RATIONALITY BETWEEN THE PULSE
*  RATE PERIOD AND YOUR SAMPLING PERIOD.
*
*  IF YOUR SIMULATION CANNOT GET PAST INITIAL CONVERGANCE
*  FOR THE TRANSIENT ANALYSIS, USE THE "UIC" SPECIFIER
*  TO SKIP THAT STEP.
*
* END NOTES
*
* PINOUT BOUT   BOUT ISENS AGND CPWM VDD VREF DIR PWM DIS VS AOUT PGND
* PINOUT ORDER    2    8    10   12   14   15  16  17  18 20  21   23
.SUBCKT SA56 2 8 10 12 14 15 16 17 18 20 21 23
M2 46 47 23 23 NS
M1 48 49 20 20 PS
R1 50 48 R1M 0.396
R2 46 21 R1M 0.329
D1 21 20 DCU
D2 23 21 DCL
E1 51 20 36 10 -1
M3 52 53 10 10 NL
R8 52 14 1E6
M16 54 55 10 10 NL
M17 54 56 10 10 NL
R22 54 14 1E6
M18 54 57 10 10 NL
M21 36 58 10 10 NL
M22 36 52 10 10 NL
R24 36 14 1E6
M23 36 59 10 10 NL
M24 56 53 10 10 NL
R25 56 14 1E6
M25 55 60 10 10 NL
M26 55 61 10 10 NL
R26 55 14 1E6
M27 58 62 10 10 NL
M28 58 63 10 10 NL
R27 58 14 1E6
M29 62 59 10 10 NL
M30 62 61 10 10 NL
R28 62 14 1E6
M31 60 57 10 10 NL
M32 60 63 10 10 NL
R29 60 14 1E6
M33 63 64 10 10 NL
M34 61 65 10 10 NL
R30 61 14 1E6
R31 63 14 1E6
M35 52 66 10 10 NL
M36 56 67 10 10 NL
M37 68 57 14 14 PZ
M38 68 57 10 10 NZ
C3 69 10 1.3E-12
R32 68 69 1E5
M39 65 69 14 14 PZ
M40 65 69 10 10 NZ
M41 67 70 10 10 NL
R33 67 14 1E6
M42 66 41 10 10 NL
R34 66 14 1E6
M43 57 52 10 10 NL
R35 57 14 1E6
M44 59 56 10 10 NL
R36 59 14 1E6
M45 71 59 14 14 PZ
M46 71 59 10 10 NZ
C4 72 10 1.3E-12
R37 71 72 1E5
M47 64 72 14 14 PZ
M48 64 72 10 10 NZ
R38 53 14 1E6
M49 53 40 10 10 NL
R39 49 51 75
C5 20 49 100E-12
C6 47 23 100E-12
C7 49 48 30E-12
C8 46 47 30E-12
E2 73 23 54 10 1
R40 47 73 75
D3 10 36 DZB
D4 10 54 DZB
R41 10 41 1E6
M51 41 74 14 14 M3P
M52 41 75 14 14 M3P
M56 70 41 10 10 M3N
R43 70 14 1E6
R44 10 74 1E6
M58 74 76 14 14 M3P
M59 74 31 14 14 M3P
R45 10 75 1E6
M60 75 30 14 14 M3P
M61 75 33 14 14 M3P
M62 75 34 14 14 M3P
M63 77 78 23 23 NS
M64 79 80 20 20 PS
R46 81 79 R1M 0.396
R47 77 2 R1M 0.329
D5 2 20 DCU
D6 23 2 DCL
E3 82 20 37 10 -1
M65 83 84 10 10 NL
R49 83 14 1E6
M66 85 86 10 10 NL
M67 85 87 10 10 NL
R50 85 14 1E6
M68 85 88 10 10 NL
M69 37 89 10 10 NL
M70 37 83 10 10 NL
R51 37 14 1E6
M71 37 90 10 10 NL
M72 87 84 10 10 NL
R52 87 14 1E6
M73 86 91 10 10 NL
M74 86 92 10 10 NL
R53 86 14 1E6
M75 89 93 10 10 NL
M76 89 94 10 10 NL
R54 89 14 1E6
M77 93 90 10 10 NL
M78 93 92 10 10 NL
R55 93 14 1E6
M79 91 88 10 10 NL
M80 91 94 10 10 NL
R56 91 14 1E6
M81 94 95 10 10 NL
M82 92 96 10 10 NL
R57 92 14 1E6
R58 94 14 1E6
M83 83 97 10 10 NL
M84 87 98 10 10 NL
M85 99 88 14 14 PZ
M86 99 88 10 10 NZ
C9 100 10 1.3E-12
R59 99 100 1E5
M87 96 100 14 14 PZ
M88 96 100 10 10 NZ
M89 98 101 10 10 NL
R60 98 14 1E6
M90 97 42 10 10 NL
R61 97 14 1E6
M91 88 83 10 10 NL
R62 88 14 1E6
M92 90 87 10 10 NL
R63 90 14 1E6
M93 102 90 14 14 PZ
M94 102 90 10 10 NZ
C10 103 10 1.3E-12
R64 102 103 1E5
M95 95 103 14 14 PZ
M96 95 103 10 10 NZ
R65 84 14 1E6
M97 84 40 10 10 NL
R66 80 82 75
C11 20 80 100E-12
C12 78 23 100E-12
C13 80 79 30E-12
C14 77 78 30E-12
E4 104 23 85 10 1
R67 78 104 75
D7 10 37 DZB
D8 10 85 DZB
R68 10 42 1E6
M98 42 105 14 14 M3P
M99 42 106 14 14 M3P
M100 101 42 10 10 M3N
R69 101 14 1E6
R70 10 105 1E6
M101 105 107 14 14 M3P
M102 105 31 14 14 M3P
R71 10 106 1E6
M103 106 30 14 14 M3P
M104 106 32 14 14 M3P
M105 106 34 14 14 M3P
M106 107 108 14 14 MCP
M107 107 108 10 10 MCN
E5 109 110 111 112 -1
E6 110 10 14 10 0.5
R72 0 110 1E9
R73 0 110 1E9
C15 108 113 1.8E-12
R74 108 109 1E3
E7 113 10 107 10 1
R75 113 108 1E5
M108 111 114 115 115 MCI
M109 116 12 115 115 MCI
I2 115 10 50E-6
M110 116 116 117 117 MCP
M111 111 111 117 117 MCP
R76 116 111 1E7
V13 117 14 1.5
M112 118 116 117 117 MCP
M113 112 111 117 117 MCP
M114 118 118 119 119 MCN
M115 118 112 119 119 MCC
M116 112 118 119 119 MCC
M117 112 112 119 119 MCN
M118 119 119 10 10 MCN
C16 120 10 29E-12
M119 121 122 123 123 MCP
M120 121 122 124 124 MCN
C17 122 125 1E-12
E8 125 10 121 10 1
R77 125 122 1E5
V14 123 10 4
V15 124 10 1
V16 126 10 0 PULSE 0 5 0 0.1U 0.1U 1U 1000
G2 120 10 127 128 -162.3E-6
R78 121 127 1E3
M121 120 126 10 10 MND
V17 128 10 2.5
E9 129 128 120 121 1E4
D9 130 122 DZO
D10 130 128 DZO
R79 122 129 1E4
C18 122 128 1E-12
C20 127 10 1E-12
R80 120 12 10
M124 76 107 10 10 M3N
R82 76 14 1E6
M125 131 132 133 133 NTC
M126 133 132 10 10 NTC
M127 134 132 135 135 PTC
M128 131 132 134 134 PTC
M129 135 131 133 133 NTC
M130 10 131 134 134 PTC W=9M
E11 12 132 27 10 -0.05
R83 131 135 1E6
R84 10 131 1E6
R85 134 135 1E5
R86 10 133 1E5
C22 131 0 3E-12
D51 10 135 DZR
R90 136 135 1E3
E12 136 10 14 10 1.25
R91 10 136 1E9
M131 31 131 137 137 MCP
M132 31 131 10 10 MCN
C23 31 10 1E-12
E13 137 10 14 10 1
M133 30 31 137 137 MCP
M134 30 31 10 10 MCN
C24 30 10 1E-12
M135 138 139 140 140 NT L=3U W=3U
M136 140 139 10 10 NT L=3U W=3U
M137 141 139 142 142 PT L=3U W=3U
M138 138 139 141 141 PT L=3U W=3U
M139 32 138 10 10 NT L=3U W=3U
M140 142 138 140 140 NT L=3U W=0.4U
M141 32 138 142 142 PT L=3U W=3U
M142 10 138 141 141 PT L=3U W=2U
C25 138 32 1E-13
E14 44 139 27 10 -0.2
V50 142 10 5
R92 138 142 1E6
R93 10 138 1E6
R94 141 142 1E5
R95 10 140 1E5
M143 33 32 10 10 M3N
R96 33 14 1E6
M144 15 143 14 14 MCP
E15 143 10 144 145 -120
R97 15 145 1E4
R98 145 10 12727
V51 146 10 1.396
R100 144 10 1E9
D52 147 10 DD
V52 147 27 0.655
I4 10 147 1E-3
R101 10 147 1E6
R102 10 27 1E6
R103 10 27 1E6
E16 146 148 27 10 0.2
E17 148 144 149 10 -5E-3
V53 14 149 5
C27 15 10 1E-11
R104 143 14 1E9
R105 10 148 1E9
R106 149 10 1E9
M145 150 151 152 152 NT L=3U W=3U
M146 152 151 10 10 NT L=3U W=3U
M147 153 151 154 154 PT L=3U W=3U
M148 150 151 153 153 PT L=3U W=3U
M149 34 150 10 10 NT L=3U W=3U
M150 154 150 152 152 NT L=3U W=0.4U
M151 34 150 154 154 PT L=3U W=3U
M152 10 150 153 153 PT L=3U W=2U
C28 150 34 1E-13
E18 35 151 27 10 -0.2
V55 154 10 5
R107 150 154 1E6
R108 10 150 1E6
R109 153 154 1E5
R110 10 152 1E5
R111 114 35 12.5E3
C29 114 10 8.16E-12
F2 155 10 V58 -241.1E-6
M153 8 155 156 156 PM
M154 155 155 156 156 PM
R118 155 156 1E8
M155 157 155 156 156 PM
G7 155 10 36 10 10.60E-6
F3 158 10 V59 -250.0E-6
M162 8 158 156 156 PM
M163 158 158 156 156 PM
R329 158 156 1E8
M164 157 158 156 156 PM
G8 158 10 37 10 14.79E-6
M165 159 160 10 10 NL
M166 159 160 14 14 PM
M169 161 159 14 14 PM
M170 161 159 10 10 NL
E33 160 162 27 10 -0.07
C45 162 10 5E-12
V58 21 50 0
V59 2 81 0
C46 159 10 3E-12
C48 156 155 5E-12
C49 156 158 5E-12
M171 163 41 14 14 M4P
M172 163 41 10 10 M4N
M173 164 41 14 14 M4P
C50 164 10 2E-12
M174 165 164 14 14 M4P
M175 166 164 167 167 M3N
M176 167 164 10 10 M3N
M177 14 166 167 10 M5
M178 164 41 168 10 M5
M179 166 164 165 14 MP
M180 10 166 165 14 MP
M181 169 166 10 10 M4N
M182 169 163 10 10 M4N
M183 169 163 170 14 MP
M184 170 166 14 14 M4P
I7 10 171 250E-6
R333 163 14 1E11
R334 10 163 1E11
R335 164 14 1E11
R336 10 164 1E11
R337 10 168 1E11
R338 165 14 1E11
R339 166 165 1E11
R340 167 166 1E11
R341 10 167 1E11
R342 170 14 1E11
R343 169 170 1E11
M185 171 171 10 10 M4N
M186 171 171 10 10 M4N
M187 168 171 10 10 M4N
C51 169 10 0.5E-12
C52 10 166 0.1E-12
M188 172 42 14 14 M4P
M189 172 42 10 10 M4N
M190 173 42 14 14 M4P
C53 173 10 2E-12
M191 174 173 14 14 M4P
M192 175 173 176 176 M3N
M193 176 173 10 10 M3N
M194 14 175 176 10 M5
M195 173 42 177 10 M5
M196 175 173 174 14 MP
M197 10 175 174 14 MP
M198 178 175 10 10 M4N
M199 178 172 10 10 M4N
M200 178 172 179 14 MP
M201 179 175 14 14 M4P
I8 10 180 250E-6
R344 172 14 1E11
R345 10 172 1E11
R346 173 14 1E11
R347 10 173 1E11
R348 10 177 1E11
R349 174 14 1E11
R350 175 174 1E11
R351 176 175 1E11
R352 10 176 1E11
R353 179 14 1E11
R354 178 179 1E11
M202 180 180 10 10 M4N
M203 180 180 10 10 M4N
M204 177 180 10 10 M4N
C54 178 10 0.5E-12
C55 10 175 0.1E-12
M205 181 43 14 14 M4P
M206 181 43 10 10 M4N
M207 182 43 14 14 M4P
C56 182 10 2E-12
M208 183 182 14 14 M4P
M209 184 182 185 185 M3N
M210 185 182 10 10 M3N
M211 14 184 185 10 M5
M212 182 43 186 10 M5
M213 184 182 183 14 MP
M214 10 184 183 14 MP
M215 187 184 10 10 M4N
M216 187 181 10 10 M4N
M217 187 181 188 14 MP
M218 188 184 14 14 M4P
I9 10 189 250E-6
R355 181 14 1E11
R356 10 181 1E11
R357 182 14 1E11
R358 10 182 1E11
R359 10 186 1E11
R360 183 14 1E11
R361 184 183 1E11
R362 185 184 1E11
R363 10 185 1E11
R364 188 14 1E11
R365 187 188 1E11
M219 189 189 10 10 M4N
M220 189 189 10 10 M4N
M221 186 189 10 10 M4N
C57 187 10 0.5E-12
C58 10 184 0.1E-12
M222 190 169 10 10 NL
M223 190 178 10 10 NL
R366 190 14 1E6
M224 190 187 10 10 NL
M225 191 190 10 10 M3N
R367 191 14 1E6
R368 192 14 1E6
R369 193 14 0.99E6
C59 14 192 0.1E-12
C60 14 193 0.1E-12
M230 194 193 10 10 NL
M231 194 193 14 14 PM
R372 195 161 40E3
C63 195 10 5E-12
V60 196 10 0 PULSE 0 5 0.2U 0.1U 0.1U 1U 1000
M241 40 196 10 10 NL
M242 40 194 10 10 NL
R375 40 14 1E6
M243 40 38 10 10 NL
M245 197 198 199 199 NT L=3U W=3U
M246 199 198 10 10 NT L=3U W=3U
M247 200 198 201 201 PT L=3U W=3U
M248 197 198 200 200 PT L=3U W=3U
M249 38 197 10 10 NT L=3U W=3U
M250 201 197 199 199 NT L=3U W=0.4U
M251 38 197 201 201 PT L=3U W=3U
M252 10 197 200 200 PT L=3U W=2U
C64 197 38 1E-13
E34 45 198 27 10 -0.2
V62 201 10 5
R377 197 201 1E6
R378 10 197 1E6
R379 200 201 1E5
R380 10 199 1E5
M254 202 203 10 10 NL
M255 202 203 14 14 PM
M258 204 202 14 14 PM
M259 204 202 10 10 NL
E35 203 205 27 10 -0.07
C65 205 10 5E-12
C66 202 10 3E-12
V64 8 205 0.25
V65 157 162 0.25
V66 156 10 20
R382 10 157 880
R383 206 204 40E3
C67 206 10 5E-12
C72 207 208 3.45E-9
R385 209 210 1
R386 211 207 10
R387 210 212 1E4
R388 209 213 1E4
C73 212 213 500E-12
G9 20 23 212 213 26.5
E61 208 0 10 0 1
M261 211 214 209 209 MDP
M262 211 42 208 208 MDN
I11 20 23 2.5E-3
R395 23 20 4800
V67 210 208 4
V68 214 42 1
M263 215 216 10 10 NL
M264 215 216 14 14 PM
E67 216 217 27 10 -0.07
C77 217 10 5E-12
R397 20 217 100E3
R398 217 23 27.25E3
M265 218 219 10 10 NL
M266 218 219 220 220 PM
E68 219 221 27 10 -0.07
C78 221 10 5E-12
R399 14 221 100E3
R400 221 10 133E3
V89 220 10 5
M267 40 215 10 10 NL
M268 40 218 10 10 NL
I12 14 10 3E-3
R401 10 14 1E4
G10 14 10 27 10 -15.2E-3
G11 20 23 27 10 -5E-3
M269 43 38 10 10 M3N
R404 43 14 1E6
Q1 192 191 10 QE
Q2 193 192 10 QE
Q4 192 193 10 QE
Q5 192 196 10 QE
Q6 193 222 10 QF
Q7 193 223 10 QF
D53 206 224 DD
D54 224 223 DD
D55 225 222 DD
D56 195 225 DD
D68 10 226 DVC
D69 10 226 DZC
D70 226 14 DZC
R406 17 226 21E3
D71 10 35 DVC
D72 10 35 DZC
D73 35 14 DZC
R407 226 35 2.4E3
D74 10 227 DVC
D75 10 227 DZC
D76 227 14 DZC
R408 16 227 21E3
D77 10 44 DVC
D78 10 44 DZC
D79 44 14 DZC
R409 227 44 2.4E3
D80 10 228 DVC
D81 10 228 DZC
D82 228 14 DZC
R410 18 228 21E3
D83 10 45 DVC
D84 10 45 DZC
D85 45 14 DZC
R411 228 45 2.4E3
D89 10 12 DVC
D90 10 12 DZC
D91 12 14 DZC
D92 10 8 DVC
D93 10 8 DZC
D94 8 14 DZC
D95 10 15 DVC
D96 10 15 DZC
D97 15 14 DZC
D98 10 14 DVC
D99 10 14 DZC
C80 17 10 5E-12
C81 16 10 5E-12
C82 18 10 5E-12
.MODEL R1M RES TC1=3.5E-3
.MODEL QE NPN RB=10E6 RBM=10E6
.MODEL QF NPN RB=20E6 RBM=20E6
.MODEL NF NMOS VTO=4 KP=200U
.MODEL DS D RS=0.05 CJO=500E-12
+ TT=1E-9 IS=8.573E-9
.MODEL NL NMOS VTO=1 KP=200U
.MODEL PZ PMOS VTO=-2 KP=200U
.MODEL NZ NMOS VTO=2 KP=200U
.MODEL NS NMOS VTO=2 KP=16 RS=0.01
.MODEL PS PMOS VTO=-2 KP=16 RS=0.01
.MODEL DCU D RS=0.108 CJO=120E-12
+ IS=8.573E-13
.MODEL DCL D RS=0.103 CJO=60E-12
+ IS=8.527E-13
.MODEL DZB D BV=4.1 IBV=5E-6 CJO=0.1E-12 RS=1
.MODEL M3N NMOS KP=200U VTO=3
.MODEL M3P PMOS KP=200U VTO=-3
.MODEL MCI NMOS KP=8.6E-3 VTO=2
.MODEL MCC NMOS KP=2000U VTO=2
.MODEL MCN NMOS KP=200U VTO=2
.MODEL MCP PMOS KP=200U VTO=-2
.MODEL DZO D BV=3 IBV=1E-3 RS=1 CJO=0.1P
.MODEL MND NMOS KP=2M VTO=2 RD=1E3
.MODEL NTC NMOS VTO=0 KP=200U
.MODEL PTC PMOS VTO=-3 KP=200U
.MODEL DZR D BV=4.65 IBV=0.5E-3 RS=250
.MODEL DD D
.MODEL NT NMOS VTO=0.35 KP=200U
.MODEL PT PMOS VTO=-1.8 KP=50U
.MODEL DZV D BV=1.3754 IBV=0.5E-3 RS=1
.MODEL M3 NMOS KP=10M VTO=2
.MODEL PM PMOS VTO=-1 KP=200U
.MODEL M5 NMOS KP=200U VTO=1.8
.MODEL M4N NMOS KP=200U VTO=1.8
.MODEL MP PMOS KP=200U VTO=-1.8
.MODEL M4P PMOS KP=200U VTO=-1.8
.MODEL MDN NMOS KP=2 VTO=2
.MODEL MDP PMOS KP=2 VTO=-2
.MODEL DVC D RS=0.01 CJO=0.1P TT=1N
.MODEL DZC D RS=0.01 CJO=0.1P TT=1N BV=10.3 IBV=1E-3
.ENDS
* END SA56 MODEL
**************

*************
*  REVISION 1 30 AUGUST 2006 INITIAL RELEASE
*     SA56TOOL STATE AVERAGE PWM MODEL FEATURES INCLUDE:
* 1 AVERAGE VALUE, TIME AND FREQUENCY DOMAIN PERFORMANCE IN ANALOG MODE
* 2 OUTPUT RESISTANCE FOR 100 DEGREE C JUNCTIONS
* 3 CURRENT SENSE PIN OUTPUT
* 4 VS LOADING DUE TO OUTPUT CURRENT ONLY
* 5 CURRENT IN PGND PIN DUE TO OUPTPUT CURRENT ONLY
* 6 SYMBOL COMPATABILITY WITH THE PULSE BY PULSE MODEL
* 7 PIN NUMBERS CORRESPOND TO THE HARDWARE
*
* WITH NO SWITCHING, THIS MODEL RUNS MANY TIMES FASTER THAN THE PULSE
* BY PULSE MODEL AND IT CAN RUN AN AC SWEEP, MAKING SIMULATION OF
* FEEDBACK LOOPS QUICK (RAISE OR ELIMINATE STEP CEILING).  
*
* BEWARE: LACK OF SWITCHING ELIMINATES SOME DISTORTION ELEMENTS FOUND
* IN THE PULSE BY PULSE MODEL AND THE HARDWARE. ALSO, LACK OF DEAD
* TIME ALLOWS LINEAR OPERATION ALL THE WAY TO 0 OR 100% MODULATION, 
* WHICH IS NOT POSSIBLE WITH THE HARDWARE.
* 
* NOT MODELED: ILIMIT, DISABLE, SHORT CIRCUIT, TEMPERATURE FUNCTIONS.
*
*BEGIN MODEL SA56TOOL FOR PSPICE.
*PINS BOUT ISENS AGND CPWM VDD VREF DIR PWM DISABLE VS AOUT PGND 
*PINS   2    8    10   12   14  15   16  17    18   20  21   23
.SUBCKT SA56TOOL 2 8 10 12 14 15 16 17 18 20 21 23
* SET UP HIGH, LOW AND P-P RAMP VALUES
V123 123 0 4    
V125 125 0 1    
E124 124 0 123 125  1   
* S123 & S125 LIMIT MODULATOR DRIVE TO 0/100%
S123 129 123 17 123  SM1
S125 125 129 125 17  SM1
R129 17 129  10K
.MODEL SM1 VSWITCH (RON=1 ROFF=100MEG VON=.001 VOFF=-.001)      
* 130 SERIES PARTS ARE THE INVERTING OUT, 140 ARE NON-INVERTING
* E130 & E140 GIVE MODULATION VOLTAGES; 0=0 OUT, VP-P=VS OUT
E130 140 0 129 125  1   
E140 130 0 123 129  1   
* E131 & E141 GENERATE OUTPUTS; V(MODULATE)*PWM GAIN [VS/VP-P]
E141 141 0  VALUE={V(140)*V(20)/V(124)}  
E131 131 0  VALUE={V(130)*V(20)/V(124)}  
* R132 & 142 SET ZOUT (ABOUT 100DEGREES C) AND MEASURE IOUT
R132 131 21  .45
R142 141 2  .45 
* E134 & E144 PROVIDE 1V/A OF OUTPUT CURRENT
E134 138 0 131 21 2.2222
E144 148 0 141 2 2.2222
* E132 & E142 SENSE OUTPUT CURRENT & MULTIPLY BY FRACTION OF MODULATION
* FRACTION IS 0 @ VOUT=0 AND 1 @ VOUT=VS
E132 135 0  VALUE={V(138)*V(130)/ V(124)}       
E142 145 0  VALUE={V(148)*V(140)/ V(124)}
* G135 & G145 REFLECT OUTPUT CURRENT INTO VSENSE PINS
G135 139 0 135 0  -1
G145 149 0 145 0  -1
V135 23 139 0    
V145 23 149 0    
* F135 & F145 REFLECT CURRENT INTO VS PIN
F135 20 0  V135 -1
F145 20 0  V145 -1
* E133 & E143 OUTPUT CURRENT GAIN TO 5V/A + DIODE DROP
E133 136 0  VALUE={(V(138)*5+.65)} 
E143 146 0  VALUE={(V(148)*5+.65)} 
* G136 & G146 SCALE DOWN RECTIFIED CURRENT SENSE, REFLECT TO ISENSE PIN
D133 136 137  D1N4148   
D143 146 147  D1N4148   
R148 137 0  10k 
R149 147 0  10k 
G136 8 0 137 0  -48.22E-6       
G146 8 0 147 0  -50E-6       
I100 0 8 51.5E-6
* CATCH DIODES-FILTER/LOAD PHASE SHIFT CAN MAKE CURRENT FLOW BACKWARDS
D130 21 20  D1M  
D131 0 21  D1M  
D140 2 20  D1M   
D141 0 2  D1M   
.MODEL D1M D (IS=4.5E-14 M=0.333 N=1.00 RS=0.112 VJ=0.75)       
D120 17 14  D1N4148     
D121 0 17  D1N4148      
.MODEL D1N4148  D(IS=0.1P RS=16 CJO=2P TT=12N BV=100 IBV=0.1P)  
* VREF OUTPUT
V115 150 0 3.06 
R115 15 0  21K  
D115 150 15  D1M
R112 12 0  1meg 
R118 18 0  1meg 
R116 16 0  1meg 
R110 10 0  1meg  
.ENDS
*END OF MODEL SA56TOOL
****************  

