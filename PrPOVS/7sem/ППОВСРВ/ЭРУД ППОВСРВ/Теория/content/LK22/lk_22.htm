<!-- (C) 2010 Nesterenkov Sergey, BSUIR -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//RU">
<HTML>
<HEAD>
<LINK rel=stylesheet href="../../../Оболочка/css/style2.css" type=text/css>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1251">
<META HTTP-EQUIV="Content-Language" CONTENT="ru">
<title>Теория по дисциплине &quot;Программирование проблемно-ориентированных вычислительных средств реального времени&quot;</title>
<base target="_top">

<base target="_self">
<style type="text/css">
body,td,th { font-family: Times New Roman, Times, serif; }
p {margin-left: 5%; margin-right: 5%; }
</style></HEAD>

</HEAD><BODY>
<div class="Header_Style">
<table width="100%" border="0" cellpadding="0" cellspacing="3" background="../../../Оболочка/images/background.jpg">
  <tr> 
    <td width="13%" rowspan=3 align="center" ><img src="../../../Оболочка/images/logo_new.jpg" width=117 align="middle"></td>
  <tr> 
    <td width="70%" colspan=2 align="center" valign="middle"> <H1 align="center" >&nbsp;</H1>
      <H1 align="center" >Электронный ресурс по учебной дисциплине<BR>
        "Программирование проблемно-ориентированных вычислительных средств реального времени"<BR> 
        для специальности: </H1>
<p>1-40 02 02 "Электронные вычислительные средства"
</p></td>
    <td width="12%" rowspan=3 align="center" ><img src="../../images/theory.jpg" width="146" height="85"></td>
  <Tr>
    <td align=center colspan=2><var class="Header_Style"><A HREF="../../../index.htm">Оглавление</A> | <A HREF="../../../Программа/ППОВСРВ_программа_2017.htm" >Программа</A> | <a href="../../../Теория/theory.htm">Теория</a> | <a href="../../../Практика/practice.htm">Практика</a> | <A HREF="../../../Контроль_знаний/test.htm">Контроль знаний</A> | <A HREF="../../../Об авторах/author.htm">Об авторах</A></var></var> </td>
  <tr>
</table></div>



<!--start-->
	<div class="mainTitle" align="center">
	  <h1>Лекция № 3.22</h1>
</div>
	<div>
	  <h3 align="center"><strong>Раздел 3.  Программирование различных задач цифровой обработки сигналов на  проблемно-ориентированных процессорах</strong></h3>
      <p><strong>3.3&nbsp;&nbsp;&nbsp; Использование проблемно-ориентированных  процессоров для усреднения сигналов (4 часа)</strong> <br>
        <strong><em>Лекция № 3.22</em></strong><br>
        Программная реализация алгоритма  усреднения методом скользящего среднего с простым и взвешенным сглаживанием для  проблемно-ориентированных процессоров семейства TMS320.<br>
        Когерентное и некогерентное усреднение.<br>
      Особенности усреднения сигналов в  частотной области. </p>
</div>

<div align="center">
    <p>
	<input type="button" class="buttonManage" value="&nbsp;Назад&nbsp;" onClick="document.location.href ='../LK21/lk_21.htm'" />
	<input type="button" class="buttonManage" value="&nbsp;Перечень тем лекций&nbsp;" onClick="document.location.href ='../../theory.htm'" />
	<input type="button" class="buttonManage" value="&nbsp;Вперед&nbsp;" onClick="document.location.href ='../LK23/lk_23.htm'" />
    </p>
</div>

<!-- (C) 2017 Shemarov Alexander, BSUIR begin-->  

<div class="Text_Style"><h1>Использование проблемно-ориентированных процессоров для усреднения сигналов<br>
Программная реализация алгоритма  усреднения методом скользящего среднего с простым сглаживанием для  проблемно-ориентированных процессоров</h1></div>
<div class="Text_Style">
  <h2>Усреднение методом скользящего среднего с простым сглаживанием </h2>
</div>

<div class="Text_Style">
  <p>Рассмотренные выше экспоненциальное и  линейное усреднения обладают своими достоинствами и недостатками. Линейное  усреднение обладает большой инерционностью, но позволяет получать высокую  точность усреднения. Экспоненциальное же усреднение обладает гораздо меньшей  инерционностью, но это преимущество достигается за счет значительного  уменьшения точности усреднения. Для объединения достоинств линейного и  экспоненциального усреднений был разработан &nbsp;вид усреднения во временной области, который позволяет  существенно уменьшить инерционность усреднения без существенной потери  точности. Такое усреднение называется усреднением с использованием скользящего  среднего. Такое название принято в ряде источников. Интеграция полезных качеств  двух усреднений достигается за счет значительного увеличения количества  операций необходимых для вычисления значения текущего среднего в условиях  априорной неопределенности величины следующего отсчета анализируемой выборки. <br>
Этот метод обеспечивает подавление шума  путем определения среднего значения сигнала в окне наблюдения размером M &ndash;  отсчетов анализируемой временной последовательности. <br>
Закон функционирования устройства  использующего усреднение методом скользящего среднего описывается следующей  формулой:</p>
  <table align="center" width="80%" border="0" cellspacing="0" cellpadding="0">
    <tr>
          <td width="10%" valign="top">&nbsp;</td>
          <td width="70%" valign="center" align="center"><img src="../../images/for030306.png" width="578" height="242"></td>
          <td width="10%" valign="center" align="right">(3.3.6)</td>
    </tr>
  </table>

  <p>Полезной особенностью устройства  усреднения методом скользящего среднего является то, что оно позволяет изменять  степень подавления шума путем изменения размера окна наблюдения M. Если размер окна наблюдения M=1, входные отсчеты не ослабляются, предыдущие  отсчеты среднего не учитываются, и никакого усреднения не происходит. <br>
В этом случае изменения входной  последовательности передаются непосредственно на выход. Когда M увеличивается, входные отсчеты ослабляются  пропорционально размера окна наблюдения. Чем больше M,  тем сильнее подавляется шум и тем медленнее устройство реагирует на изменения  входного сигнала.<br>
Используя предыдущий усредненный отсчет  можно значительно упростить вычисление текущего усредненного отсчета по  следующей формуле:</p>
  <table align="center" width="80%" border="0" cellspacing="0" cellpadding="0">
    <tr>
          <td width="10%" valign="top">&nbsp;</td>
          <td width="70%" valign="center" align="center"><img src="../../images/for030307.png" width="432" height="71"></td>
          <td width="10%" valign="center" align="right">(3.3.7)</td>
    </tr>
  </table>
</div>
<div class="Text_Style">
  <h2>Алгоритм усреднения методом скользящего среднего с простым сглаживанием</h2></div>

<div class="Text_Style">
  <p>&nbsp;Алгоритмусреднения методом скользящего среднего с простым сглаживанием представлен на рисунке 3.3.8. Усреднение осуществляется группами по M отсчетов в окне наблюдения. Для устранения влияния переходного процесса расширяем входную выборку в начале на размер окна наблюдения и заполняем ее величиной нулевого (начального) отсчета.</p>
  <p>&nbsp;</p>

<h3 align="center"><a name="Рис3.3.8"></a><img src="../../images/Ris22_1.gif" width="276" height="1152"></h3>
<h3 align="center">Рисунок 3.3.8 &ndash;Алгоритм усреднения методом скользящего среднего с простым сглаживанием</h3>
</div> 

	<div class="Text_Style">
	  <h2>Программная реализация усреднения методом скользящего среднего с простым сглаживанием</h2>
</div>
	<div class="Text_Style">
	<p>Пример программы  усреднения случайного сигнала методом скользящего среднего с простым сглаживанием.</p>
	<blockquote>
	  <blockquote>
      <pre>
				.mmregs 
				.def	_c_int00		; Определяем переменную, которая будет в дальнейшем использоваться как глобальная в других файлах
				.text					; Начинаем сегмент кода
				
Bufer_size		.equ	1024
Supervision_Win .equ	10				 ; Окно наблюдения
KOEF_BETA		.equ	32768/Supervision_Win	
		
_c_int00:	 	; Метка начала программы
				ld		#GPRN_Start, DP
				stm		#Stack_Array, SP

		;		Заполнение предварительного буфера
				dld		GPRN_Start, A		
				stm		#Pre_Random_Array, AR1
				rpt		#(Supervision_Win-1)
				stl		A, *AR1+
				stl		A, First_AVE

		;		Формирование случайного процесса 
		;		Количество отсчетов равно Bufer_size
			
				stm		#Bufer_size-1, BRC	

				call	Random_M_Seq

		;		Усреднение случайного процесса м формирование усредненного сигнала
		;		Линейное усреднение осуществляется блоками по Supervision_Win отсчетов		

				stm		#Pre_Random_Array, AR2				
				stm		#Random_Array, AR3
				stm		#First_AVE, AR4
				stm		#BETA, AR5
				stm		#AVE_Random_Array, AR6
				ssbx	sxm
				ssbx	frct
				rsbx	ovm

		;		Выполнение округления. Размер блока равен Supervision_Win 
				stm		#Bufer_size-1, BRC
				
				rptb	end_block_m2	

		;		Вычисление очередного значения последовательности округленной методом скользящего среднего		
				ld		*AR4, 16, A
				mac		*AR3+, *AR5, A
				mas		*AR2+, *AR5, A

		;		Округление среднего текущего значения 	
				xc		2, AGEQ
				add		#0x8000, A
				xc		2, ALT
				sub		#0x8000, A
				sth		A, *AR4
				
		;		Запись текущего усредненного значения последовательности		
	
end_block_m2:	sth		A, *AR6+

				nop

; Подпрограмма для генерирования псевдослучайных чисел
; AR1 - адрес массива элементов в памяти
; BRC - количество элементов массива
Random_M_Seq:	rsbx	sxm
				rptb	end_block
				
				ld		A, 3, B
				xor		B, A
				ld  	A, -16, B
				and 	#0x000F, B
				xor		B, -1, A
end_block:		stl		A, *AR1+

				ret
				
				nop
				nop
				
				
						
						
				.align
				.data

BETA				.word		KOEF_BETA			; Beta
First_AVE			.word		0					; Искусственно сформированное начальное среднее
GPRN_Start			.long		0x000A7256
Pre_Random_Array	.space		Supervision_Win*16
Random_Array		.space		Bufer_size*16
AVE_Random_Array	.space		Bufer_size*16
Stack_Array			.bes		128*16

				.end								
	    </pre>
      </blockquote>
	  </blockquote>
</div>
<div class="Text_Style"> <p>Результаты усреднения случайного процесса методом скользящего среднего с простым сглаживанием представлены на рисункe 3.3.9 (длина окна наблюдения 10 отсчетов).  </p></div>

<div>
<h3 align="center"><a name="Рис3.3.2а"></a><img src="../../images/Ris22_1usr.jpg" width="90%"></h3>
<h3 align="center">Рисунок 3.3.9 &ndash; Усреднение случайного процесса методом скользящего среднего с простым сглаживанием</h3>
</div> 




<div class="Text_Style">
  <h1> Программная реализация алгоритма усреднения методом скользящего среднего со взвешенным сглаживанием для проблемно-ориентированных процессоров </h1></div>
<div class="Text_Style">
  <h2>Усреднение методом скользящего среднего со взвешенным сглаживанием </h2>
</div>

<div class="Text_Style">
<p>Дальнейшим развитием усреднения методом скользящего  среднего является цифровой нерекурсивный фильтр или фильтр с конечной  импульсной характеристикой. Такой метод усреднения иногда еще называют усреднением методом скользящего среднего со взвешенным сглаживанием. Введя коэффициенты h(i) в формулу 3.3.6 получим  следующее выражение, которое может быть использовано для реализации процесса  усреднения.<br>
Закон функционирования устройства использующего  экспоненциальное усреднение описывается формулой 3.3.8.</p>

      <table align="center" width="80%" border="0" cellspacing="0" cellpadding="0">
    <tr>
          <td width="10%" valign="top">&nbsp;</td>
          <td width="70%" valign="center" align="center"><img src="../../images/for030308.png" width="578" height="362"></td>
          <td width="10%" valign="center" align="right">(3.3.8)</td>
    </tr><br>
  </table>  

<p>Существует  большое количество различных систем формирования коэффициентов h(i).<br>
Одними  из наиболее удачных систем для практического использования является, например, системы  коэффициентов Хэмминга, Кайзера, Спенсера и др. </p>
<table align="center" border="1" cellspacing="0" cellpadding="0">
  <tr>
    <td width="213" valign="top"><p>Система    Спенсера </p></td>
    <td width="213" valign="top"><p>M = 8 </p></td>
    <td width="213" valign="top"><p>M = 11</p></td>
  </tr>
  <tr>
    <td width="213" valign="top"><p>h(10) </p></td>
    <td width="213" valign="top"><p>&nbsp;</p></td>
    <td width="213" valign="bottom"><p>-0,00488</p></td>
  </tr>
  <tr>
    <td width="213" valign="top"><p>h(9) </p></td>
    <td width="213" valign="top"><p>&nbsp;</p></td>
    <td width="213" valign="bottom"><p>-0,01463</p></td>
  </tr>
  <tr>
    <td width="213" valign="top"><p>h(8) </p></td>
    <td width="213" valign="top"><p>&nbsp;</p></td>
    <td width="213" valign="bottom"><p>-0,02439</p></td>
  </tr>
  <tr>
    <td width="213" valign="top"><p>h(7) </p></td>
    <td width="213" valign="top"><p>-0,01523; </p></td>
    <td width="213" valign="bottom"><p>-0,02439</p></td>
  </tr>
  <tr>
    <td width="213" valign="top"><p>h(6) </p></td>
    <td width="213" valign="top"><p>-0,03046 </p></td>
    <td width="213" valign="bottom"><p>-0,00976</p></td>
  </tr>
  <tr>
    <td width="213" valign="top"><p>h(5) </p></td>
    <td width="213" valign="top"><p>-0,02538 </p></td>
    <td width="213" valign="bottom"><p>0,029268</p></td>
  </tr>
  <tr>
    <td width="213" valign="top"><p>h(4) </p></td>
    <td width="213" valign="top"><p>0,015228 </p></td>
    <td width="213" valign="bottom"><p>0,087805</p></td>
  </tr>
  <tr>
    <td width="213" valign="top"><p>h(3) </p></td>
    <td width="213" valign="top"><p>0,106599 </p></td>
    <td width="213" valign="bottom"><p>0,160976</p></td>
  </tr>
  <tr>
    <td width="213" valign="top"><p>h(2) </p></td>
    <td width="213" valign="top"><p>0,233503 </p></td>
    <td width="213" valign="bottom"><p>0,229268</p></td>
  </tr>
  <tr>
    <td width="213" valign="top"><p>h(1) </p></td>
    <td width="213" valign="top"><p>0,340102 </p></td>
    <td width="213" valign="bottom"><p>0,278049</p></td>
  </tr>
  <tr>
    <td width="213" valign="top"><p>h(0) </p></td>
    <td width="213" valign="top"><p>0,375635 </p></td>
    <td width="213" valign="bottom"><p>0,292683</p></td>
  </tr>
</table>

</div>

<div class="Text_Style">
<h2>Алгоритм усреднения методом скользящего среднего со взвешенным сглаживанием</h2></div>

<div class="Text_Style">
  <p>&nbsp;Алгоритм усреднения  методом скользящего среднего со взвешенным сглаживанием представлен на рисунке 3.3.10. Усреднение осуществляется по выборке, состоящей из N отсчетов и M коэффициентов h(i).</p>

<h3 align="center"><a name="Рис3.3.<h5>1</h5>"></a><img src="../../images/ris22_2.gif" width="540" height="1334"></h3>
<h3 align="center">Рисунок 3.3.10 &ndash; Алгоритм усреднения  методом скользящего среднего со взвешенным сглаживанием </h3>
</div> 


	<div class="Text_Style">
	  <h2>Программная реализация усреднения  методом скользящего среднего со взвешенным сглаживанием</h2>
</div>
	<div class="Text_Style">
	<p>Пример программы  усреднения случайного сигнала   методом скользящего среднего со взвешенным сглаживанием.</p>
	<blockquote>
	  <blockquote>
	    <pre>
         		.mmregs 
				.def	_c_int00		; Определяем переменную, которая будет в дальнейшем использоваться как глобальная в других файлах
				.text					; Начинаем сегмент кода
				
Bufer_size			.equ	1024
Supervision_Win 	.equ	11			; Количество коэффициентов
		
_c_int00:	 	                        ; Метка начала программы
				ld		#GPRN_Start, DP
				stm		#Stack_Array, SP

										;		Заполнение предварительного буфера, используемого для ускорения завершения переходного процесса
				dld		GPRN_Start, A		
				stm		#Pre_Random_Array, AR1
				rpt		#(Supervision_Win-2)
				stl		A, *AR1+

										;		Формирование случайного процесса  
										;		Количество отсчетов равно Bufer_size
			
				stm		#Bufer_size-1, BRC	

				call	Random_M_Seq

										;		Усреднение случайного процесса и формирование усредненного сигнала
										;		Взвешенное усреднение осуществляется блоками по Supervision_Win отсчетов		

				stm		#Supervision_Win, AR0				
				stm		#Random_Array, AR3
				stm		#KOEF_USR, AR4
				stm		#AVE_Random_Array, AR5
				ssbx	sxm
				ssbx	frct
				rsbx	ovm

										;		Выполнение округления. Размер блока оэффициентов равен Supervision_Win 
				stm		#Bufer_size-1, BRC
				
				rptb	end_block_m2	

										;		Вычисление очередного значения последовательности округленной величины методом скользящего среднего со взвешиванием		
				xor		A, A 
				rpt		#(Supervision_Win-1)
				mac		*AR4+, *AR3-, A

										;		Округление среднего текущего значения 	
				xc		2, AGEQ
				add		#0x7FFF, A
				xc		2, ALT
				sub		#0x7FFF, A
				
				ld		*AR4-0, B 
				ld		*AR3+0, B
				ld		*AR3+,  B

										;		Запись текущего усредненного значения последовательности		
	
end_block_m2:	sth		A, *AR5+

				nop

; Подпрограмма для генерирования псевдослучайных чисел
; AR1 - адрес массива элементов в памяти
; BRC - количество элементов массива
Random_M_Seq:	rsbx	sxm
				rptb	end_block
				
				ld		A, 3, B
				xor		B, A
				ld 	 	A, -16, B
				and 	#0x000F, B
				xor		B, -1, A
end_block:		stl		A, *AR1+

				ret
				
				nop
				nop
						
				.align
				.data

GPRN_Start				.long		0x00078901
KOEF_USR				.word		0x2577, 0x2397, 0x1D59, 0x149B, 0x0B3D
                		.word		0x03BF, 0xFEC0, 0xFCE1, 0xFCE1, 0xFE20, 0xFF60 
Pre_Random_Array		.space	   	(Supervision_Win-1)*16
Random_Array		  	.space		Bufer_size*16
AVE_Random_Array		.space		Bufer_size*16
Stack_Array			  	.bes		128*16

				.end
        
        </pre>
	   
      </blockquote>
	  </blockquote>
</div>


<div class="Text_Style"> <p>Результаты усреднения случайного  сигнала методом скользящего методом со взвешенным сглаживанием представлены на рисункe 3.3.10 (длина выборки коэффициентов 11 отсчетов по Спенсеру). </p>
</div>

<div>
<h3 align="center"><a name="Рис3.3.10"></a><img src="../../images/Ris22_2usr.jpg" width="90%"></h3>
<h3 align="center">Рисунок 3.3.10 &ndash;Усреднение случайного процесса методом скользящего среднего со взвешенным сглаживанием</h3>
</div> 

<div class="Text_Style">
  <h2> Когерентное и некогерентное усреднение</h2>
</div>
<div class="Text_Style">
<p>
КОГЕРЕНТНОЕ УСРЕДНЕНИЕ<br>
В процессе когерентного усреднения (известного также как линейное, преддетекторное, или векторное усреднение), ключевую роль играет временная сетка, используемая для дискретизации исходного сигнала: мы накапливаем множество последовательностей отсчетов смеси сигнала с шумом, причем необходимо,  чтобы начальная фаза сигнала во всех этих последовательностях была одна и та же. 
  Например, когда мы усредняем синусоиду, смешанную с шумом, для когерентного усреднения необходимо, чтобы начальная фаза синусоиды была одинаковой во всех последовательностях отсчетов. Когда это требование выполняется,  усреднение синусоиды дает ее истинные отсчеты. Шум, однако, отличается в каждой последовательности, участвующей в усреднении, и результат его усреднения равен нулю (предполагается, что отсчеты шума некоррелированы друг с другом и с частотой дискретизации, если какой-то компонент шума коррелируется с частотой дискретизации,  после усреднения он останется). Смысл этого в том, что когерентное усреднение уменьшает дисперсию шума, сохраняя, в то же время, неизменными отсчеты сигнала, которые синхронны, или когерентны, относительно начала интервала накопления. При когерентном усреднении можно действительно улучшить отношение сигнал/шум. </p>
<p>НЕКОГЕРЕНТНОЕ УСРЕДНЕНИЕ<br>
 Процесс некогерентного усреднения (известного также как среднеквадратичное, последетекторное, скалярное или видео-усреднение) представляет собой усреднение отсчетов сигнала в случае, когда на временные соотношения дискретизации не накладываются никакие ограничения; т. е. интервалы измерения сигнала никак не синхронизированы с фазой измеряемого сигнала. Если мы усредняем импульсный сигнал, то, в результате мы получим импульсы, которые начинаются в разные моменты в разных наборах отсчетов. Усреднение множества наборов отсчетов размажет импульс по набору отсчетов, или попросту «задавит сигнал». (Так невозможно наблюдать сигнал на осциллографе без внешней или внутренней синхронизации). По этой причине некогерентное усреднение во временной области приносит мало пользы (Термин некогерентное усреднение несколько неудачен, усреднение данных это не более, чем усреднение — мы складываем набор значений данных и делим сумму на количество отсчетов в наборе, некогерентное усреднение следовало бы, вероятно, назвать усреднением данных, полученных некогерентно).  В частотной области, однако, все не так, потому что некогерентное усреднение может увеличить точность измерения относительного уровня сигнала. Действительно, некогерентное усреднение используется во множестве измерительных приборов, таких как анализаторы спектра, анализаторы сетей и анализаторы сигналов. 
  В некоторых аналоговых измерительных приборах сигналы представляются в частотной области с помощью узкополосного фильтра, средняя частота которого пробегает весь исследуемый диапазон частот, и детектора мощности. Эти приборы измеряют мощность сигнала как функцию частоты. Детектор мощности  необходим, поскольку изменение частоты не синхронизировано по времени с  измеряемым сигналом. Следовательно, данные, полученные таким образом в частотной области, представляют только мощность и не содержат никакой информации о фазе сигнала. Хотя в этом случае улучшать входное отношение сигнал/шум уже поздно, некогерентное усреднение может улучшить точность измерения мощности сигнала в присутствии шума, т. е., если спектр мощности сигнала очень зашумлен,  можно уменьшить флуктуации оценок мощности и улучшить точность.  
  
</p>
</div>








<!-- (C) 2017 Shemarov Alexander, BSUIR end-->  

<div align="center">
	<p>
	<input type="button" class="buttonManage" value="&nbsp;Назад&nbsp;" onClick="document.location.href ='../LK21/lk_21.htm'" />
	<input type="button" class="buttonManage" value="&nbsp;Перечень тем лекций&nbsp;" onClick="document.location.href ='../../theory.htm'" />
	<input type="button" class="buttonManage" value="&nbsp;Вперед&nbsp;" onClick="document.location.href ='../LK23/lk_23.htm'" />
    </p>
  
<div class="Text_Style"><br></div>
</div>




<!--end-->
<div class="Header_Style">
<table width="100%" border="0" cellpadding="0" cellspacing="3" bordercolor="#316AC5" background="../../../Оболочка/images/background.jpg">
	<Tr>
    <td align=center colspan=2><var class="Header_Style"><A HREF="../../../index.htm">Оглавление</A> | <A HREF="../../../Программа/ППОВСРВ_программа_2017.htm" >Программа</A> | <a href="../../../Теория/theory.htm">Теория</a> | <a href="../../../Практика/practice.htm">Практика</a> |<A HREF="../../../Контроль_знаний/test.htm">Контроль знаний</A> | <A HREF="../../../Об авторах/author.htm">Об авторах</A></var></var> </td>
  <Tr>
   <td align=center><a href="https://www.bsuir.by/" title="Официальный сайт БГУИР" target="_blank">(С) БГУИР</a></td>
  </tr>
</table></div>

</BODY></HTML>